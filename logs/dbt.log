[0m14:18:24.310965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108822850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088234d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10882bc10>]}


============================== 14:18:24.314376 | ee74c8ea-386d-4742-a6f7-1f10ed5a9a47 ==============================
[0m14:18:24.314376 [info ] [MainThread]: Running with dbt=1.6.7
[0m14:18:24.314709 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:18:24.315000 [info ] [MainThread]: dbt version: 1.6.7
[0m14:18:24.315170 [info ] [MainThread]: python version: 3.11.4
[0m14:18:24.315322 [info ] [MainThread]: python path: /Users/olaisaac/dbt-env/bin/python3.11
[0m14:18:24.315462 [info ] [MainThread]: os info: macOS-14.1-arm64-arm-64bit
[0m14:18:24.535731 [info ] [MainThread]: Using profiles dir at /Users/olaisaac/.dbt
[0m14:18:24.535982 [info ] [MainThread]: Using profiles.yml file at /Users/olaisaac/.dbt/profiles.yml
[0m14:18:24.536125 [info ] [MainThread]: Using dbt_project.yml file at /Users/olaisaac/projects/mrr-playbook/dbt_project.yml
[0m14:18:24.536533 [info ] [MainThread]: adapter type: bigquery
[0m14:18:24.536662 [info ] [MainThread]: adapter version: 1.6.8
[0m14:18:24.538698 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m14:18:24.538876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'ee74c8ea-386d-4742-a6f7-1f10ed5a9a47', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10927c490>]}
[0m14:18:24.539090 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m14:18:24.539232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'ee74c8ea-386d-4742-a6f7-1f10ed5a9a47', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10927d690>]}
[0m14:18:24.547162 [info ] [MainThread]: Configuration:
[0m14:18:24.547363 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m14:18:24.547491 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m14:18:24.547616 [info ] [MainThread]: Required dependencies:
[0m14:18:24.547804 [debug] [MainThread]: Executing "git --help"
[0m14:18:24.562191 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m14:18:24.562749 [debug] [MainThread]: STDERR: "b''"
[0m14:18:24.562926 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m14:18:24.563084 [info ] [MainThread]: Connection:
[0m14:18:24.563286 [info ] [MainThread]:   method: oauth
[0m14:18:24.563406 [info ] [MainThread]:   database: production-environment-306717
[0m14:18:24.563523 [info ] [MainThread]:   execution_project: production-environment-306717
[0m14:18:24.563636 [info ] [MainThread]:   schema: general_explorations
[0m14:18:24.563750 [info ] [MainThread]:   location: US
[0m14:18:24.563861 [info ] [MainThread]:   priority: interactive
[0m14:18:24.563974 [info ] [MainThread]:   maximum_bytes_billed: None
[0m14:18:24.564087 [info ] [MainThread]:   impersonate_service_account: None
[0m14:18:24.564197 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m14:18:24.564308 [info ] [MainThread]:   job_retries: 1
[0m14:18:24.564419 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m14:18:24.564528 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m14:18:24.564637 [info ] [MainThread]:   keyfile: None
[0m14:18:24.564744 [info ] [MainThread]:   timeout_seconds: 300
[0m14:18:24.564850 [info ] [MainThread]:   refresh_token: None
[0m14:18:24.564957 [info ] [MainThread]:   client_id: None
[0m14:18:24.565066 [info ] [MainThread]:   token_uri: None
[0m14:18:24.565170 [info ] [MainThread]:   dataproc_region: None
[0m14:18:24.565276 [info ] [MainThread]:   dataproc_cluster_name: None
[0m14:18:24.565384 [info ] [MainThread]:   gcs_bucket: None
[0m14:18:24.565490 [info ] [MainThread]:   dataproc_batch: None
[0m14:18:24.565694 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m14:18:24.570065 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m14:18:24.570645 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:18:25.136000 [debug] [MainThread]: On debug: select 1 as id
[0m14:18:26.115162 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:83a5890e-c104-4306-b8bc-dcc5cbc131a1&page=queryresults
[0m14:18:26.832792 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m14:18:26.834341 [info ] [MainThread]: [32mAll checks passed![0m
[0m14:18:26.835879 [debug] [MainThread]: Command `dbt debug` succeeded at 14:18:26.835599 after 2.56 seconds
[0m14:18:26.836703 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m14:18:26.837570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10882bf90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10880f2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10813d810>]}
[0m14:18:26.838656 [debug] [MainThread]: Flushing usage events
[0m14:22:47.045141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f5a850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f59c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f63550>]}


============================== 14:22:47.048083 | 36056b83-3095-4def-920e-4fa5d93f1851 ==============================
[0m14:22:47.048083 [info ] [MainThread]: Running with dbt=1.6.7
[0m14:22:47.048403 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:22:47.051967 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m14:22:47.052216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '36056b83-3095-4def-920e-4fa5d93f1851', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f63a50>]}
[0m14:22:47.052444 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m14:22:47.052617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '36056b83-3095-4def-920e-4fa5d93f1851', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f81c10>]}
[0m14:22:47.077895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '36056b83-3095-4def-920e-4fa5d93f1851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f49b10>]}
[0m14:22:47.078698 [debug] [MainThread]: Set downloads directory='/var/folders/5k/gd4vyqv53w170k5mm228ct9w0000gn/T/dbt-downloads-2epxuttq'
[0m14:22:47.078953 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m14:22:47.455655 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m14:22:47.459816 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m14:22:47.554300 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m14:22:47.565406 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m14:22:47.959690 [info ] [MainThread]: Installed from version 0.8.0
[0m14:22:47.960052 [info ] [MainThread]: Updated version available: 1.1.1
[0m14:22:47.960336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '36056b83-3095-4def-920e-4fa5d93f1851', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f63a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f632d0>]}
[0m14:22:47.960629 [info ] [MainThread]: 
[0m14:22:47.960847 [info ] [MainThread]: Updates available for packages: ['dbt-labs/dbt_utils']                 
Update your versions in packages.yml, then run dbt deps
[0m14:22:47.961775 [debug] [MainThread]: Command `dbt deps` succeeded at 14:22:47.961666 after 0.94 seconds
[0m14:22:47.962063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100917510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100992190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100aee910>]}
[0m14:22:47.962335 [debug] [MainThread]: Flushing usage events
[0m14:23:15.799722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104da2850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dab2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104daba90>]}


============================== 14:23:15.802842 | 569fdebb-2f76-4139-86d3-e7796306d017 ==============================
[0m14:23:15.802842 [info ] [MainThread]: Running with dbt=1.6.7
[0m14:23:15.803256 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:23:15.807422 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m14:23:15.807688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '569fdebb-2f76-4139-86d3-e7796306d017', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dcbe10>]}
[0m14:23:15.807931 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m14:23:15.808123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '569fdebb-2f76-4139-86d3-e7796306d017', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dcb8d0>]}
[0m14:23:15.823959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '569fdebb-2f76-4139-86d3-e7796306d017', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dee010>]}
[0m14:23:15.824869 [debug] [MainThread]: Set downloads directory='/var/folders/5k/gd4vyqv53w170k5mm228ct9w0000gn/T/dbt-downloads-lrofm2uc'
[0m14:23:15.825166 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m14:23:15.921492 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m14:23:15.922477 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m14:23:16.012648 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m14:23:16.021439 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m14:23:16.373192 [info ] [MainThread]: Installed from version 1.1.1
[0m14:23:16.373556 [info ] [MainThread]: Up to date!
[0m14:23:16.373861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '569fdebb-2f76-4139-86d3-e7796306d017', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d8e650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d8e450>]}
[0m14:23:16.374721 [debug] [MainThread]: Command `dbt deps` succeeded at 14:23:16.374636 after 0.63 seconds
[0m14:23:16.374960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10075f510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100936950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100936890>]}
[0m14:23:16.375211 [debug] [MainThread]: Flushing usage events
[0m14:23:42.855039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105516850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055176d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10551fe10>]}


============================== 14:23:42.857821 | 5ec1d842-7edd-4275-b20b-987364923609 ==============================
[0m14:23:42.857821 [info ] [MainThread]: Running with dbt=1.6.7
[0m14:23:42.858125 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'profiles_dir': '/Users/olaisaac/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt seed', 'send_anonymous_usage_stats': 'True'}
[0m14:23:43.089199 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m14:23:43.089484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '5ec1d842-7edd-4275-b20b-987364923609', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f92410>]}
[0m14:23:43.089720 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m14:23:43.089895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '5ec1d842-7edd-4275-b20b-987364923609', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f19590>]}
[0m14:23:43.109594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5ec1d842-7edd-4275-b20b-987364923609', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f90550>]}
[0m14:23:43.116556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5ec1d842-7edd-4275-b20b-987364923609', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fba110>]}
[0m14:23:43.117194 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m14:23:43.130554 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m14:23:43.131240 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m14:23:43.131454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5ec1d842-7edd-4275-b20b-987364923609', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f45850>]}
[0m14:23:43.579773 [error] [MainThread]: Encountered an error:
Compilation Error in model mrr (models/mrr.sql)
  macro 'dbt_macro__default__surrogate_key' takes not more than 1 argument(s)
  
  > in macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model mrr (models/mrr.sql)
[0m14:23:43.580163 [debug] [MainThread]: Command `dbt seed` failed at 14:23:43.580105 after 0.74 seconds
[0m14:23:43.580362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10551fad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062b9cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105514710>]}
[0m14:23:43.580544 [debug] [MainThread]: Flushing usage events
[0m14:25:32.260501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cfe850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cffdd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d07f90>]}


============================== 14:25:32.263398 | 9f13afec-3c86-426f-be9d-5c5cc8b7795d ==============================
[0m14:25:32.263398 [info ] [MainThread]: Running with dbt=1.6.7
[0m14:25:32.263719 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'debug': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt seed', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:25:32.496551 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m14:25:32.496839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '9f13afec-3c86-426f-be9d-5c5cc8b7795d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108feb5d0>]}
[0m14:25:32.497070 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m14:25:32.497246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '9f13afec-3c86-426f-be9d-5c5cc8b7795d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10978bdd0>]}
[0m14:25:32.516738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9f13afec-3c86-426f-be9d-5c5cc8b7795d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a079d0>]}
[0m14:25:32.523679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9f13afec-3c86-426f-be9d-5c5cc8b7795d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a07b90>]}
[0m14:25:32.524317 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m14:25:32.537200 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m14:25:32.537722 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m14:25:32.537918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '9f13afec-3c86-426f-be9d-5c5cc8b7795d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099edad0>]}
[0m14:25:32.983585 [error] [MainThread]: Encountered an error:
Compilation Error in model mrr (models/mrr.sql)
  macro 'dbt_macro__default__surrogate_key' takes not more than 1 argument(s)
  
  > in macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model mrr (models/mrr.sql)
[0m14:25:32.983956 [debug] [MainThread]: Command `dbt seed` failed at 14:25:32.983906 after 0.74 seconds
[0m14:25:32.984137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d14490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a02f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10972c590>]}
[0m14:25:32.984312 [debug] [MainThread]: Flushing usage events
[0m14:27:18.978771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10788ccd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107897310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078979d0>]}


============================== 14:27:18.981968 | 3635730a-3d1b-4c8e-b4fe-0fccfc8c0375 ==============================
[0m14:27:18.981968 [info ] [MainThread]: Running with dbt=1.6.7
[0m14:27:18.982318 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt seed', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:27:19.214743 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m14:27:19.215026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '3635730a-3d1b-4c8e-b4fe-0fccfc8c0375', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104fe390>]}
[0m14:27:19.215263 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m14:27:19.215445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '3635730a-3d1b-4c8e-b4fe-0fccfc8c0375', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104fe690>]}
[0m14:27:19.235015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3635730a-3d1b-4c8e-b4fe-0fccfc8c0375', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104ffed0>]}
[0m14:27:19.241806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3635730a-3d1b-4c8e-b4fe-0fccfc8c0375', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104ffed0>]}
[0m14:27:19.242389 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m14:27:19.255594 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m14:27:19.256128 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m14:27:19.256327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '3635730a-3d1b-4c8e-b4fe-0fccfc8c0375', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104be190>]}
[0m14:27:19.703164 [error] [MainThread]: Encountered an error:
Compilation Error in model mrr (models/mrr.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The acme.mrr model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model mrr (models/mrr.sql)
[0m14:27:19.703567 [debug] [MainThread]: Command `dbt seed` failed at 14:27:19.703517 after 0.78 seconds
[0m14:27:19.703759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107897690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a76f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10787bd90>]}
[0m14:27:19.703936 [debug] [MainThread]: Flushing usage events
[0m14:28:21.776255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10470d3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104727610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104727d90>]}


============================== 14:28:21.779180 | b85d08b4-1283-4091-831a-30697960fd5b ==============================
[0m14:28:21.779180 [info ] [MainThread]: Running with dbt=1.6.7
[0m14:28:21.779486 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt seed', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:28:22.005935 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m14:28:22.006215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'b85d08b4-1283-4091-831a-30697960fd5b', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105159e10>]}
[0m14:28:22.006443 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m14:28:22.006614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'b85d08b4-1283-4091-831a-30697960fd5b', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051d8490>]}
[0m14:28:22.011979 [error] [MainThread]: Encountered an error:
Runtime Error
  at path []: Additional properties are not allowed ('surrogate_key_treat_nulls_as_empty_strings' was unexpected)

Error encountered in /Users/olaisaac/projects/mrr-playbook/dbt_project.yml
[0m14:28:22.012318 [debug] [MainThread]: Command `dbt seed` failed at 14:28:22.012264 after 0.25 seconds
[0m14:28:22.012476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104727f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1002b2950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10517add0>]}
[0m14:28:22.012626 [debug] [MainThread]: Flushing usage events
[0m14:29:12.452360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10899a410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089988d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089b1010>]}


============================== 14:29:12.455127 | a2ee02c7-8adf-45d6-9632-65586248c835 ==============================
[0m14:29:12.455127 [info ] [MainThread]: Running with dbt=1.6.7
[0m14:29:12.455429 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'profiles_dir': '/Users/olaisaac/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt seed', 'send_anonymous_usage_stats': 'True'}
[0m14:29:12.685481 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m14:29:12.685774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'a2ee02c7-8adf-45d6-9632-65586248c835', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10939f490>]}
[0m14:29:12.686005 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m14:29:12.686180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'a2ee02c7-8adf-45d6-9632-65586248c835', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109450ed0>]}
[0m14:29:12.705731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a2ee02c7-8adf-45d6-9632-65586248c835', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10942f990>]}
[0m14:29:12.712570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a2ee02c7-8adf-45d6-9632-65586248c835', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10942f990>]}
[0m14:29:12.713176 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m14:29:12.726033 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m14:29:12.726569 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m14:29:12.726807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a2ee02c7-8adf-45d6-9632-65586248c835', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096a8150>]}
[0m14:29:13.175815 [error] [MainThread]: Encountered an error:
Compilation Error in model mrr (models/mrr.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The acme.mrr model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model mrr (models/mrr.sql)
[0m14:29:13.176221 [debug] [MainThread]: Command `dbt seed` failed at 14:29:13.176167 after 0.74 seconds
[0m14:29:13.176415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10452e950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096d2410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109758b50>]}
[0m14:29:13.176598 [debug] [MainThread]: Flushing usage events
[0m14:58:35.211321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a8e850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a97790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a97f10>]}


============================== 14:58:35.214646 | 255c2a76-6cc6-44de-95ee-0fc0d998b2dc ==============================
[0m14:58:35.214646 [info ] [MainThread]: Running with dbt=1.6.7
[0m14:58:35.215029 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt seed', 'send_anonymous_usage_stats': 'True'}
[0m14:58:35.465805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '255c2a76-6cc6-44de-95ee-0fc0d998b2dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b90a90>]}
[0m14:58:35.472554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '255c2a76-6cc6-44de-95ee-0fc0d998b2dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106831650>]}
[0m14:58:35.473131 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m14:58:35.485315 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m14:58:35.485806 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m14:58:35.486016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '255c2a76-6cc6-44de-95ee-0fc0d998b2dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bcb0d0>]}
[0m14:58:35.929752 [error] [MainThread]: Encountered an error:
Compilation Error in model mrr (models/mrr.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The acme.mrr model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model mrr (models/mrr.sql)
[0m14:58:35.930176 [debug] [MainThread]: Command `dbt seed` failed at 14:58:35.930117 after 0.78 seconds
[0m14:58:35.930371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1011b2950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b92f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101135910>]}
[0m14:58:35.930549 [debug] [MainThread]: Flushing usage events
[0m15:00:37.641536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105636850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10563f550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10563fbd0>]}


============================== 15:00:37.644731 | 8c500a60-ac9f-4270-8f4c-8b8dd792d289 ==============================
[0m15:00:37.644731 [info ] [MainThread]: Running with dbt=1.6.7
[0m15:00:37.645078 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt seed', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m15:00:37.912443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8c500a60-ac9f-4270-8f4c-8b8dd792d289', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106064790>]}
[0m15:00:37.919172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8c500a60-ac9f-4270-8f4c-8b8dd792d289', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060da890>]}
[0m15:00:37.919630 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m15:00:37.929305 [error] [MainThread]: Encountered an error:
Runtime Error
  Failed to read package: Runtime Error
    No dbt_project.yml found at expected path /Users/olaisaac/projects/mrr-playbook/dbt_packages/dbt_utils/dbt_project.yml
    Verify that each entry within packages.yml (and their transitive dependencies) contains a file named dbt_project.yml
    

Error encountered in /Users/olaisaac/projects/mrr-playbook/dbt_packages/dbt_utils
[0m15:00:37.929895 [debug] [MainThread]: Command `dbt seed` failed at 15:00:37.929817 after 0.32 seconds
[0m15:00:37.930147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105622dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10564ff50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063300d0>]}
[0m15:00:37.930369 [debug] [MainThread]: Flushing usage events
[0m15:04:36.377698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108986850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108987210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10898f910>]}


============================== 15:04:36.380662 | 8497d64a-8adf-490c-a85d-06e051164e60 ==============================
[0m15:04:36.380662 [info ] [MainThread]: Running with dbt=1.6.7
[0m15:04:36.380970 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt deps', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:04:36.408353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8497d64a-8adf-490c-a85d-06e051164e60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085545d0>]}
[0m15:04:36.409985 [debug] [MainThread]: Set downloads directory='/var/folders/5k/gd4vyqv53w170k5mm228ct9w0000gn/T/dbt-downloads-olcy09oc'
[0m15:04:36.410261 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m15:04:38.663763 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m15:04:38.665319 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m15:04:38.756110 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m15:04:38.765229 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m15:04:39.335435 [info ] [MainThread]: Installed from version 1.1.1
[0m15:04:39.335727 [info ] [MainThread]: Up to date!
[0m15:04:39.335974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '8497d64a-8adf-490c-a85d-06e051164e60', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10899ff50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108986cd0>]}
[0m15:04:39.336749 [debug] [MainThread]: Command `dbt deps` succeeded at 15:04:39.336674 after 2.98 seconds
[0m15:04:39.336972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104343510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10451a950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10451a890>]}
[0m15:04:39.337174 [debug] [MainThread]: Flushing usage events
[0m15:04:44.377210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108736850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108740250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10874d510>]}


============================== 15:04:44.379611 | 6b0d0cc0-63a0-4f0f-8129-9585ab9d2d38 ==============================
[0m15:04:44.379611 [info ] [MainThread]: Running with dbt=1.6.7
[0m15:04:44.379920 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt seed', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:04:44.614787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6b0d0cc0-63a0-4f0f-8129-9585ab9d2d38', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a362d0>]}
[0m15:04:44.621403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6b0d0cc0-63a0-4f0f-8129-9585ab9d2d38', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a362d0>]}
[0m15:04:44.621930 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m15:04:44.633679 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m15:04:44.634222 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m15:04:44.634437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '6b0d0cc0-63a0-4f0f-8129-9585ab9d2d38', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109443c50>]}
[0m15:04:45.069222 [error] [MainThread]: Encountered an error:
Compilation Error in model mrr (models/mrr.sql)
  macro 'dbt_macro__generate_surrogate_key' takes not more than 1 argument(s)
[0m15:04:45.069604 [debug] [MainThread]: Command `dbt seed` failed at 15:04:45.069552 after 0.71 seconds
[0m15:04:45.069793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10424d950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109519cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109570150>]}
[0m15:04:45.069970 [debug] [MainThread]: Flushing usage events
[0m17:13:42.536845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e62850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e6fd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e6fd50>]}


============================== 17:13:42.540022 | 40fc56ef-ab07-4638-abb5-6ff7ce7e71a4 ==============================
[0m17:13:42.540022 [info ] [MainThread]: Running with dbt=1.6.7
[0m17:13:42.540384 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'debug': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:13:42.544485 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m17:13:42.544757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '40fc56ef-ab07-4638-abb5-6ff7ce7e71a4', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e60250>]}
[0m17:13:42.545003 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m17:13:42.545195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '40fc56ef-ab07-4638-abb5-6ff7ce7e71a4', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e98e50>]}
[0m17:13:42.569489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '40fc56ef-ab07-4638-abb5-6ff7ce7e71a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e6c990>]}
[0m17:13:42.570355 [debug] [MainThread]: Set downloads directory='/var/folders/5k/gd4vyqv53w170k5mm228ct9w0000gn/T/dbt-downloads-wpzavrzg'
[0m17:13:42.570641 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m17:13:42.905338 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m17:13:42.908622 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m17:13:43.007955 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m17:13:43.022707 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m17:13:43.570705 [info ] [MainThread]: Installed from version 0.8.0
[0m17:13:43.570985 [info ] [MainThread]: Updated version available: 1.1.1
[0m17:13:43.571246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '40fc56ef-ab07-4638-abb5-6ff7ce7e71a4', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e4d850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e7a410>]}
[0m17:13:43.571536 [info ] [MainThread]: 
[0m17:13:43.571742 [info ] [MainThread]: Updates available for packages: ['dbt-labs/dbt_utils']                 
Update your versions in packages.yml, then run dbt deps
[0m17:13:43.572443 [debug] [MainThread]: Command `dbt deps` succeeded at 17:13:43.572371 after 1.09 seconds
[0m17:13:43.572660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10481f510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049f6910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d74c50>]}
[0m17:13:43.572852 [debug] [MainThread]: Flushing usage events
[0m17:13:51.394830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dee850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106df7a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106df7f90>]}


============================== 17:13:51.397309 | e80f78c4-76a7-43da-be5b-60dd2834a677 ==============================
[0m17:13:51.397309 [info ] [MainThread]: Running with dbt=1.6.7
[0m17:13:51.397623 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt seed', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m17:13:51.631051 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m17:13:51.631346 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'e80f78c4-76a7-43da-be5b-60dd2834a677', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ae02d0>]}
[0m17:13:51.631592 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m17:13:51.631765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'e80f78c4-76a7-43da-be5b-60dd2834a677', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077f18d0>]}
[0m17:13:51.645102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e80f78c4-76a7-43da-be5b-60dd2834a677', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10781d710>]}
[0m17:13:51.651670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e80f78c4-76a7-43da-be5b-60dd2834a677', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107af0b50>]}
[0m17:13:51.652246 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m17:13:51.664540 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m17:13:51.665013 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m17:13:51.665201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e80f78c4-76a7-43da-be5b-60dd2834a677', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107aeb950>]}
[0m17:13:52.127284 [warn ] [MainThread]: 
Warning: the `surrogate_key` macro now takes a single list argument instead of multiple string arguments. Support for multiple string arguments will be deprecated in a future release of dbt-utils. The acme.mrr model triggered this warning. 
[0m17:13:52.173641 [warn ] [MainThread]: [[33mWARNING[0m]: 'subscription_periods' is a seed node, but it is specified in the models section
of models/schema.yml. To fix this error, place the `subscription_periods`
specification under the seeds key instead.
[0m17:13:52.239393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e80f78c4-76a7-43da-be5b-60dd2834a677', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bd4a10>]}
[0m17:13:52.249369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e80f78c4-76a7-43da-be5b-60dd2834a677', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d2a810>]}
[0m17:13:52.249624 [info ] [MainThread]: Found 4 models, 1 seed, 21 tests, 0 sources, 0 exposures, 0 metrics, 582 macros, 0 groups, 0 semantic models
[0m17:13:52.249783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e80f78c4-76a7-43da-be5b-60dd2834a677', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bcb150>]}
[0m17:13:52.250675 [info ] [MainThread]: 
[0m17:13:52.251031 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m17:13:52.251489 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_production-environment-306717'
[0m17:13:52.251665 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:13:53.755297 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_production-environment-306717, now list_production-environment-306717_general_explorations)
[0m17:13:53.756467 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:13:54.192834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e80f78c4-76a7-43da-be5b-60dd2834a677', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b2bfd0>]}
[0m17:13:54.193917 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:13:54.194291 [info ] [MainThread]: 
[0m17:13:54.197761 [debug] [Thread-1 (]: Began running node seed.acme.subscription_periods
[0m17:13:54.198536 [info ] [Thread-1 (]: 1 of 1 START seed file general_explorations.subscription_periods ............... [RUN]
[0m17:13:54.199224 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_production-environment-306717_general_explorations, now seed.acme.subscription_periods)
[0m17:13:54.199555 [debug] [Thread-1 (]: Began compiling node seed.acme.subscription_periods
[0m17:13:54.199973 [debug] [Thread-1 (]: Timing info for seed.acme.subscription_periods (compile): 17:13:54.199782 => 17:13:54.199787
[0m17:13:54.200299 [debug] [Thread-1 (]: Began executing node seed.acme.subscription_periods
[0m17:13:54.230366 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:14:17.017046 [debug] [Thread-1 (]: On seed.acme.subscription_periods: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "seed.acme.subscription_periods"} */

    alter table `production-environment-306717`.`general_explorations`.`subscription_periods` set OPTIONS()
  
[0m17:14:17.348561 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:e5a0bd7d-ff49-48e5-bdee-7a1040080a44&page=queryresults
[0m17:14:17.907949 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.acme.subscription_periods"
[0m17:14:17.928888 [debug] [Thread-1 (]: Timing info for seed.acme.subscription_periods (execute): 17:13:54.200496 => 17:14:17.928691
[0m17:14:17.929706 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e80f78c4-76a7-43da-be5b-60dd2834a677', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ae2450>]}
[0m17:14:17.930205 [info ] [Thread-1 (]: 1 of 1 OK loaded seed file general_explorations.subscription_periods ........... [[32mINSERT 121[0m in 23.73s]
[0m17:14:17.930722 [debug] [Thread-1 (]: Finished running node seed.acme.subscription_periods
[0m17:14:17.932266 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:14:17.932550 [debug] [MainThread]: Connection 'seed.acme.subscription_periods' was properly closed.
[0m17:14:17.932823 [info ] [MainThread]: 
[0m17:14:17.933127 [info ] [MainThread]: Finished running 1 seed in 0 hours 0 minutes and 25.68 seconds (25.68s).
[0m17:14:17.933684 [debug] [MainThread]: Command end result
[0m17:14:17.946474 [info ] [MainThread]: 
[0m17:14:17.946854 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:14:17.947073 [info ] [MainThread]: 
[0m17:14:17.947309 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m17:14:17.947771 [debug] [MainThread]: Command `dbt seed` succeeded at 17:14:17.947702 after 26.57 seconds
[0m17:14:17.948039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106deec90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1027ab510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d03010>]}
[0m17:14:17.948290 [debug] [MainThread]: Flushing usage events
[0m17:14:28.652592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104fbe850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104fc7e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104fc4810>]}


============================== 17:14:28.655016 | 0979a9ff-030f-435f-9def-b613b9788ac4 ==============================
[0m17:14:28.655016 [info ] [MainThread]: Running with dbt=1.6.7
[0m17:14:28.655328 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m17:14:28.866144 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m17:14:28.866418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '0979a9ff-030f-435f-9def-b613b9788ac4', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a4b490>]}
[0m17:14:28.866647 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m17:14:28.866824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '0979a9ff-030f-435f-9def-b613b9788ac4', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a4bd50>]}
[0m17:14:28.884952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0979a9ff-030f-435f-9def-b613b9788ac4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cb2f50>]}
[0m17:14:28.891610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0979a9ff-030f-435f-9def-b613b9788ac4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cc7b10>]}
[0m17:14:28.892055 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m17:14:28.904438 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m17:14:28.944502 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:14:28.944716 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:14:28.948053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0979a9ff-030f-435f-9def-b613b9788ac4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a9ab10>]}
[0m17:14:28.987300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0979a9ff-030f-435f-9def-b613b9788ac4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d2be10>]}
[0m17:14:28.987576 [info ] [MainThread]: Found 4 models, 1 seed, 21 tests, 0 sources, 0 exposures, 0 metrics, 582 macros, 0 groups, 0 semantic models
[0m17:14:28.987737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0979a9ff-030f-435f-9def-b613b9788ac4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10216cb50>]}
[0m17:14:28.988701 [info ] [MainThread]: 
[0m17:14:28.989077 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m17:14:28.989639 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_production-environment-306717'
[0m17:14:28.989836 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:14:30.109115 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_production-environment-306717, now list_production-environment-306717_general_explorations)
[0m17:14:30.110506 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:14:30.582951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0979a9ff-030f-435f-9def-b613b9788ac4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d28a10>]}
[0m17:14:30.584214 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:14:30.584595 [info ] [MainThread]: 
[0m17:14:30.588104 [debug] [Thread-1 (]: Began running node model.acme.util_months
[0m17:14:30.588595 [info ] [Thread-1 (]: 1 of 4 START sql view model general_explorations.util_months ................... [RUN]
[0m17:14:30.589308 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_production-environment-306717_general_explorations, now model.acme.util_months)
[0m17:14:30.589634 [debug] [Thread-1 (]: Began compiling node model.acme.util_months
[0m17:14:30.610860 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:14:30.611292 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


        select 

    datetime_diff(
        cast(date_trunc('month', current_date) as datetime),
        cast('2018-01-01' as datetime),
        month
    )


[0m17:14:33.729574 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:a5affac2-742f-4ea6-b8b3-ede594738e08&page=queryresults
[0m17:14:33.733520 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Found invalid date part argument function call syntax for `current_date`() at [7:34]')
[0m17:14:36.571038 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:a9a1edda-b56b-44cb-a8f4-74de68fc8746&page=queryresults
[0m17:14:36.574178 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:a9a1edda-b56b-44cb-a8f4-74de68fc8746&page=queryresults
[0m17:14:36.577917 [debug] [Thread-1 (]: Timing info for model.acme.util_months (compile): 17:14:30.589860 => 17:14:36.577515
[0m17:14:36.595258 [debug] [Thread-1 (]: Database Error in model util_months (models/utils/util_months.sql)
  Found invalid date part argument function call syntax for `current_date`() at [7:34]
[0m17:14:36.595988 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0979a9ff-030f-435f-9def-b613b9788ac4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e33450>]}
[0m17:14:36.596670 [error] [Thread-1 (]: 1 of 4 ERROR creating sql view model general_explorations.util_months .......... [[31mERROR[0m in 6.01s]
[0m17:14:36.597241 [debug] [Thread-1 (]: Finished running node model.acme.util_months
[0m17:14:36.598162 [debug] [Thread-1 (]: Began running node model.acme.customer_revenue_by_month
[0m17:14:36.598716 [info ] [Thread-1 (]: 2 of 4 SKIP relation general_explorations.customer_revenue_by_month ............ [[33mSKIP[0m]
[0m17:14:36.599145 [debug] [Thread-1 (]: Finished running node model.acme.customer_revenue_by_month
[0m17:14:36.599660 [debug] [Thread-1 (]: Began running node model.acme.customer_churn_month
[0m17:14:36.600144 [info ] [Thread-1 (]: 3 of 4 SKIP relation general_explorations.customer_churn_month ................. [[33mSKIP[0m]
[0m17:14:36.600530 [debug] [Thread-1 (]: Finished running node model.acme.customer_churn_month
[0m17:14:36.601049 [debug] [Thread-1 (]: Began running node model.acme.mrr
[0m17:14:36.601412 [info ] [Thread-1 (]: 4 of 4 SKIP relation general_explorations.mrr .................................. [[33mSKIP[0m]
[0m17:14:36.601769 [debug] [Thread-1 (]: Finished running node model.acme.mrr
[0m17:14:36.603167 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:14:36.603432 [debug] [MainThread]: Connection 'model.acme.util_months' was properly closed.
[0m17:14:36.603720 [info ] [MainThread]: 
[0m17:14:36.603996 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 7.61 seconds (7.61s).
[0m17:14:36.604588 [debug] [MainThread]: Command end result
[0m17:14:36.618831 [info ] [MainThread]: 
[0m17:14:36.619158 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:14:36.619361 [info ] [MainThread]: 
[0m17:14:36.619553 [error] [MainThread]:   Database Error in model util_months (models/utils/util_months.sql)
  Found invalid date part argument function call syntax for `current_date`() at [7:34]
[0m17:14:36.619753 [info ] [MainThread]: 
[0m17:14:36.619966 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=3 TOTAL=4
[0m17:14:36.620404 [debug] [MainThread]: Command `dbt run` failed at 17:14:36.620338 after 7.99 seconds
[0m17:14:36.620688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100b52950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100ad5910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104fabc90>]}
[0m17:14:36.620944 [debug] [MainThread]: Flushing usage events
[0m18:06:26.542770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109506850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109507490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10951cd50>]}


============================== 18:06:26.545677 | a54d6ddc-6329-45fa-9cb3-65193bd7daf8 ==============================
[0m18:06:26.545677 [info ] [MainThread]: Running with dbt=1.6.7
[0m18:06:26.545993 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/olaisaac/.dbt', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:06:26.780796 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:06:26.781089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'a54d6ddc-6329-45fa-9cb3-65193bd7daf8', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f0b490>]}
[0m18:06:26.781332 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:06:26.781509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'a54d6ddc-6329-45fa-9cb3-65193bd7daf8', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f9bd50>]}
[0m18:06:26.800538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a54d6ddc-6329-45fa-9cb3-65193bd7daf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fbd110>]}
[0m18:06:26.807608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a54d6ddc-6329-45fa-9cb3-65193bd7daf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f9bf50>]}
[0m18:06:26.808251 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m18:06:26.822379 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m18:06:26.868619 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:06:26.869011 [debug] [MainThread]: Partial parsing: updated file: acme://models/utils/util_months.sql
[0m18:06:26.936882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a54d6ddc-6329-45fa-9cb3-65193bd7daf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1a9710>]}
[0m18:06:26.946087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a54d6ddc-6329-45fa-9cb3-65193bd7daf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3ca190>]}
[0m18:06:26.946328 [info ] [MainThread]: Found 4 models, 1 seed, 21 tests, 0 sources, 0 exposures, 0 metrics, 582 macros, 0 groups, 0 semantic models
[0m18:06:26.946487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a54d6ddc-6329-45fa-9cb3-65193bd7daf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f0a410>]}
[0m18:06:26.947414 [info ] [MainThread]: 
[0m18:06:26.947767 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:06:26.948337 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_production-environment-306717'
[0m18:06:26.948548 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:06:28.419251 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_production-environment-306717, now list_production-environment-306717_general_explorations)
[0m18:06:28.420612 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:06:28.947063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a54d6ddc-6329-45fa-9cb3-65193bd7daf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f62f90>]}
[0m18:06:28.948262 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:06:28.948642 [info ] [MainThread]: 
[0m18:06:28.952015 [debug] [Thread-1 (]: Began running node model.acme.util_months
[0m18:06:28.952652 [info ] [Thread-1 (]: 1 of 4 START sql view model general_explorations.util_months ................... [RUN]
[0m18:06:28.953425 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_production-environment-306717_general_explorations, now model.acme.util_months)
[0m18:06:28.953766 [debug] [Thread-1 (]: Began compiling node model.acme.util_months
[0m18:06:28.965373 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:06:28.965885 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


        select 

    datetime_diff(
        cast(date_trunc(current_date, month) as datetime),
        cast('2018-01-01' as datetime),
        month
    )


[0m18:06:29.596186 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:05e29bb5-7146-49dc-b0ba-8f1b5d5689d1&page=queryresults
[0m18:06:30.718038 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.util_months"
[0m18:06:30.720941 [debug] [Thread-1 (]: Timing info for model.acme.util_months (compile): 18:06:28.954015 => 18:06:30.720590
[0m18:06:30.721819 [debug] [Thread-1 (]: Began executing node model.acme.util_months
[0m18:06:30.754289 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.util_months"
[0m18:06:30.755569 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


  create or replace view `production-environment-306717`.`general_explorations`.`util_months`
  OPTIONS()
  as 

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
    
    

    )

    select *
    from unioned
    where generated_number <= 70
    order by generated_number



),

all_periods as (

    select (
        

        datetime_add(
            cast( '2018-01-01' as datetime),
        interval row_number() over (order by 1) - 1 month
        )


    ) as date_month
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_month <= date_trunc(current_date, month)

)

select * from filtered

;


[0m18:06:31.273728 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:db4e2a4c-48a3-4592-a4d3-b7e427584124&page=queryresults
[0m18:06:31.912159 [debug] [Thread-1 (]: Timing info for model.acme.util_months (execute): 18:06:30.722533 => 18:06:31.911908
[0m18:06:31.913212 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a54d6ddc-6329-45fa-9cb3-65193bd7daf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a20b150>]}
[0m18:06:31.913895 [info ] [Thread-1 (]: 1 of 4 OK created sql view model general_explorations.util_months .............. [[32mCREATE VIEW (0 processed)[0m in 2.96s]
[0m18:06:31.914537 [debug] [Thread-1 (]: Finished running node model.acme.util_months
[0m18:06:31.915292 [debug] [Thread-1 (]: Began running node model.acme.customer_revenue_by_month
[0m18:06:31.915932 [info ] [Thread-1 (]: 2 of 4 START sql view model general_explorations.customer_revenue_by_month ..... [RUN]
[0m18:06:31.916656 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.util_months, now model.acme.customer_revenue_by_month)
[0m18:06:31.917034 [debug] [Thread-1 (]: Began compiling node model.acme.customer_revenue_by_month
[0m18:06:31.921245 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.customer_revenue_by_month"
[0m18:06:31.922121 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (compile): 18:06:31.917291 => 18:06:31.921949
[0m18:06:31.922446 [debug] [Thread-1 (]: Began executing node model.acme.customer_revenue_by_month
[0m18:06:31.926189 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.customer_revenue_by_month"
[0m18:06:31.926940 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:06:31.927472 [debug] [Thread-1 (]: On model.acme.customer_revenue_by_month: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.customer_revenue_by_month"} */


  create or replace view `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`
  OPTIONS()
  as with subscription_periods as (

    select * from `production-environment-306717`.`general_explorations`.`subscription_periods`

),

months as (

    select * from `production-environment-306717`.`general_explorations`.`util_months`

),

-- determine when a given account had its first and last (or most recent) month
customers as (

    select
        customer_id,
        date_trunc('month', min(start_date)) as date_month_start,
        date_trunc('month', max(end_date)) as date_month_end

    from subscription_periods

    group by 1

),

-- create one record per month between a customer's first and last month
-- (example of a date spine)
customer_months as (

    select
        customers.customer_id,
        months.date_month

    from customers

    inner join months
        -- all months after start date
        on  months.date_month >= customers.date_month_start
        -- and before end date
        and months.date_month < customers.date_month_end

),

-- join the account-month spine to MRR base model, pulling through most recent dates
-- and plan info for month rows that have no invoices (i.e. churns)
joined as (

    select
        customer_months.date_month,
        customer_months.customer_id,
        coalesce(subscription_periods.monthly_amount, 0) as mrr

    from customer_months

    left join subscription_periods
        on customer_months.customer_id = subscription_periods.customer_id
        -- month is after a subscription start date
        and customer_months.date_month >= subscription_periods.start_date
        -- month is before a subscription end date (and handle null case)
        and (customer_months.date_month < subscription_periods.end_date
                or subscription_periods.end_date is null)

),

final as (

    select
        date_month,
        customer_id,
        mrr,

        mrr > 0 as is_active,

        -- calculate first and last months
        min(case when is_active then date_month end) over (
            partition by customer_id
        ) as first_active_month,

        max(case when is_active then date_month end) over (
            partition by customer_id
        ) as last_active_month,

        -- calculate if this record is the first or last month
        first_active_month = date_month as is_first_month,
        last_active_month = date_month as is_last_month

    from joined

)

select * from final;


[0m18:06:32.677124 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:6d732dcf-d5e9-472d-85f3-64c4549db5ec&page=queryresults
[0m18:06:33.222123 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('A valid date part name is required but found min at [23:29]')
[0m18:06:34.194384 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:152869c2-06f1-4ebe-8b36-761b4dc081a4&page=queryresults
[0m18:06:34.963259 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:152869c2-06f1-4ebe-8b36-761b4dc081a4&page=queryresults
[0m18:06:34.965040 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (execute): 18:06:31.922655 => 18:06:34.964574
[0m18:06:34.983962 [debug] [Thread-1 (]: Database Error in model customer_revenue_by_month (models/customer_revenue_by_month.sql)
  A valid date part name is required but found min at [23:29]
  compiled Code at target/run/acme/models/customer_revenue_by_month.sql
[0m18:06:34.984670 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a54d6ddc-6329-45fa-9cb3-65193bd7daf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4c3c90>]}
[0m18:06:34.985379 [error] [Thread-1 (]: 2 of 4 ERROR creating sql view model general_explorations.customer_revenue_by_month  [[31mERROR[0m in 3.07s]
[0m18:06:34.986011 [debug] [Thread-1 (]: Finished running node model.acme.customer_revenue_by_month
[0m18:06:34.986992 [debug] [Thread-1 (]: Began running node model.acme.customer_churn_month
[0m18:06:34.987558 [info ] [Thread-1 (]: 3 of 4 SKIP relation general_explorations.customer_churn_month ................. [[33mSKIP[0m]
[0m18:06:34.988033 [debug] [Thread-1 (]: Finished running node model.acme.customer_churn_month
[0m18:06:34.988663 [debug] [Thread-1 (]: Began running node model.acme.mrr
[0m18:06:34.989079 [info ] [Thread-1 (]: 4 of 4 SKIP relation general_explorations.mrr .................................. [[33mSKIP[0m]
[0m18:06:34.989498 [debug] [Thread-1 (]: Finished running node model.acme.mrr
[0m18:06:34.990946 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:06:34.991210 [debug] [MainThread]: Connection 'model.acme.customer_revenue_by_month' was properly closed.
[0m18:06:34.991497 [info ] [MainThread]: 
[0m18:06:34.991772 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 8.04 seconds (8.04s).
[0m18:06:34.992499 [debug] [MainThread]: Command end result
[0m18:06:35.006848 [info ] [MainThread]: 
[0m18:06:35.007267 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:06:35.007489 [info ] [MainThread]: 
[0m18:06:35.007708 [error] [MainThread]:   Database Error in model customer_revenue_by_month (models/customer_revenue_by_month.sql)
  A valid date part name is required but found min at [23:29]
  compiled Code at target/run/acme/models/customer_revenue_by_month.sql
[0m18:06:35.007937 [info ] [MainThread]: 
[0m18:06:35.008176 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=2 TOTAL=4
[0m18:06:35.008657 [debug] [MainThread]: Command `dbt run` failed at 18:06:35.008586 after 8.49 seconds
[0m18:06:35.008974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10951cc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10501d950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f3e190>]}
[0m18:06:35.009257 [debug] [MainThread]: Flushing usage events
[0m18:08:36.283729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050be850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050c7a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050c7f90>]}


============================== 18:08:36.286678 | f6be625e-1153-4181-84d3-4be68988ddb5 ==============================
[0m18:08:36.286678 [info ] [MainThread]: Running with dbt=1.6.7
[0m18:08:36.286990 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m18:08:36.503902 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:08:36.504189 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'f6be625e-1153-4181-84d3-4be68988ddb5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b1b490>]}
[0m18:08:36.504424 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:08:36.504607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'f6be625e-1153-4181-84d3-4be68988ddb5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ac2290>]}
[0m18:08:36.523843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f6be625e-1153-4181-84d3-4be68988ddb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b83990>]}
[0m18:08:36.530685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f6be625e-1153-4181-84d3-4be68988ddb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b96d10>]}
[0m18:08:36.531511 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m18:08:36.544563 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m18:08:36.584437 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:08:36.584885 [debug] [MainThread]: Partial parsing: updated file: acme://models/customer_churn_month.sql
[0m18:08:36.657721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f6be625e-1153-4181-84d3-4be68988ddb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d63410>]}
[0m18:08:36.665257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f6be625e-1153-4181-84d3-4be68988ddb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106058310>]}
[0m18:08:36.665509 [info ] [MainThread]: Found 4 models, 1 seed, 21 tests, 0 sources, 0 exposures, 0 metrics, 582 macros, 0 groups, 0 semantic models
[0m18:08:36.665686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f6be625e-1153-4181-84d3-4be68988ddb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10226cb50>]}
[0m18:08:36.666638 [info ] [MainThread]: 
[0m18:08:36.666992 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:08:36.667562 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_production-environment-306717'
[0m18:08:36.667765 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:08:38.386873 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_production-environment-306717, now list_production-environment-306717_general_explorations)
[0m18:08:38.388163 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:08:38.872467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f6be625e-1153-4181-84d3-4be68988ddb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105913b90>]}
[0m18:08:38.873669 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:08:38.874059 [info ] [MainThread]: 
[0m18:08:38.877808 [debug] [Thread-1 (]: Began running node model.acme.util_months
[0m18:08:38.878311 [info ] [Thread-1 (]: 1 of 4 START sql view model general_explorations.util_months ................... [RUN]
[0m18:08:38.878993 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_production-environment-306717_general_explorations, now model.acme.util_months)
[0m18:08:38.879327 [debug] [Thread-1 (]: Began compiling node model.acme.util_months
[0m18:08:38.900935 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:08:38.901365 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


        select 

    datetime_diff(
        cast(date_trunc(current_date, month) as datetime),
        cast('2018-01-01' as datetime),
        month
    )


[0m18:08:39.610174 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:d05f80e1-2727-4040-a6f8-236de51d765a&page=queryresults
[0m18:08:40.640181 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.util_months"
[0m18:08:40.641210 [debug] [Thread-1 (]: Timing info for model.acme.util_months (compile): 18:08:38.879556 => 18:08:40.641010
[0m18:08:40.641507 [debug] [Thread-1 (]: Began executing node model.acme.util_months
[0m18:08:40.659291 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.util_months"
[0m18:08:40.659917 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


  create or replace view `production-environment-306717`.`general_explorations`.`util_months`
  OPTIONS()
  as 

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
    
    

    )

    select *
    from unioned
    where generated_number <= 70
    order by generated_number



),

all_periods as (

    select (
        

        datetime_add(
            cast( '2018-01-01' as datetime),
        interval row_number() over (order by 1) - 1 month
        )


    ) as date_month
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_month <= date_trunc(current_date, month)

)

select * from filtered

;


[0m18:08:41.049280 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:b8a9631d-195a-4cc6-8cfe-2db156d1acd1&page=queryresults
[0m18:08:41.643831 [debug] [Thread-1 (]: Timing info for model.acme.util_months (execute): 18:08:40.641677 => 18:08:41.643592
[0m18:08:41.644911 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6be625e-1153-4181-84d3-4be68988ddb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e35a10>]}
[0m18:08:41.645599 [info ] [Thread-1 (]: 1 of 4 OK created sql view model general_explorations.util_months .............. [[32mCREATE VIEW (0 processed)[0m in 2.77s]
[0m18:08:41.646249 [debug] [Thread-1 (]: Finished running node model.acme.util_months
[0m18:08:41.647043 [debug] [Thread-1 (]: Began running node model.acme.customer_revenue_by_month
[0m18:08:41.647767 [info ] [Thread-1 (]: 2 of 4 START sql view model general_explorations.customer_revenue_by_month ..... [RUN]
[0m18:08:41.648488 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.util_months, now model.acme.customer_revenue_by_month)
[0m18:08:41.648864 [debug] [Thread-1 (]: Began compiling node model.acme.customer_revenue_by_month
[0m18:08:41.652769 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.customer_revenue_by_month"
[0m18:08:41.653739 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (compile): 18:08:41.649114 => 18:08:41.653560
[0m18:08:41.654064 [debug] [Thread-1 (]: Began executing node model.acme.customer_revenue_by_month
[0m18:08:41.657871 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.customer_revenue_by_month"
[0m18:08:41.658757 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:08:41.659362 [debug] [Thread-1 (]: On model.acme.customer_revenue_by_month: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.customer_revenue_by_month"} */


  create or replace view `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`
  OPTIONS()
  as with subscription_periods as (

    select * from `production-environment-306717`.`general_explorations`.`subscription_periods`

),

months as (

    select * from `production-environment-306717`.`general_explorations`.`util_months`

),

-- determine when a given account had its first and last (or most recent) month
customers as (

    select
        customer_id,
        date_trunc('month', min(start_date)) as date_month_start,
        date_trunc('month', max(end_date)) as date_month_end

    from subscription_periods

    group by 1

),

-- create one record per month between a customer's first and last month
-- (example of a date spine)
customer_months as (

    select
        customers.customer_id,
        months.date_month

    from customers

    inner join months
        -- all months after start date
        on  months.date_month >= customers.date_month_start
        -- and before end date
        and months.date_month < customers.date_month_end

),

-- join the account-month spine to MRR base model, pulling through most recent dates
-- and plan info for month rows that have no invoices (i.e. churns)
joined as (

    select
        customer_months.date_month,
        customer_months.customer_id,
        coalesce(subscription_periods.monthly_amount, 0) as mrr

    from customer_months

    left join subscription_periods
        on customer_months.customer_id = subscription_periods.customer_id
        -- month is after a subscription start date
        and customer_months.date_month >= subscription_periods.start_date
        -- month is before a subscription end date (and handle null case)
        and (customer_months.date_month < subscription_periods.end_date
                or subscription_periods.end_date is null)

),

final as (

    select
        date_month,
        customer_id,
        mrr,

        mrr > 0 as is_active,

        -- calculate first and last months
        min(case when is_active then date_month end) over (
            partition by customer_id
        ) as first_active_month,

        max(case when is_active then date_month end) over (
            partition by customer_id
        ) as last_active_month,

        -- calculate if this record is the first or last month
        first_active_month = date_month as is_first_month,
        last_active_month = date_month as is_last_month

    from joined

)

select * from final;


[0m18:08:42.248508 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:4742e7db-9c60-4273-83c9-9d07b74571ea&page=queryresults
[0m18:08:42.739705 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('A valid date part name is required but found min at [23:29]')
[0m18:08:44.044807 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:7235fb47-1235-4465-bca5-7f85af08eb99&page=queryresults
[0m18:08:44.615709 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:7235fb47-1235-4465-bca5-7f85af08eb99&page=queryresults
[0m18:08:44.617762 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (execute): 18:08:41.654274 => 18:08:44.617239
[0m18:08:44.636227 [debug] [Thread-1 (]: Database Error in model customer_revenue_by_month (models/customer_revenue_by_month.sql)
  A valid date part name is required but found min at [23:29]
  compiled Code at target/run/acme/models/customer_revenue_by_month.sql
[0m18:08:44.636932 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6be625e-1153-4181-84d3-4be68988ddb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106104750>]}
[0m18:08:44.637749 [error] [Thread-1 (]: 2 of 4 ERROR creating sql view model general_explorations.customer_revenue_by_month  [[31mERROR[0m in 2.99s]
[0m18:08:44.638450 [debug] [Thread-1 (]: Finished running node model.acme.customer_revenue_by_month
[0m18:08:44.639333 [debug] [Thread-1 (]: Began running node model.acme.customer_churn_month
[0m18:08:44.639901 [info ] [Thread-1 (]: 3 of 4 SKIP relation general_explorations.customer_churn_month ................. [[33mSKIP[0m]
[0m18:08:44.640364 [debug] [Thread-1 (]: Finished running node model.acme.customer_churn_month
[0m18:08:44.641011 [debug] [Thread-1 (]: Began running node model.acme.mrr
[0m18:08:44.641560 [info ] [Thread-1 (]: 4 of 4 SKIP relation general_explorations.mrr .................................. [[33mSKIP[0m]
[0m18:08:44.641978 [debug] [Thread-1 (]: Finished running node model.acme.mrr
[0m18:08:44.643664 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:08:44.644055 [debug] [MainThread]: Connection 'model.acme.customer_revenue_by_month' was properly closed.
[0m18:08:44.644419 [info ] [MainThread]: 
[0m18:08:44.644780 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 7.98 seconds (7.98s).
[0m18:08:44.645575 [debug] [MainThread]: Command end result
[0m18:08:44.657461 [info ] [MainThread]: 
[0m18:08:44.657839 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:08:44.658071 [info ] [MainThread]: 
[0m18:08:44.658297 [error] [MainThread]:   Database Error in model customer_revenue_by_month (models/customer_revenue_by_month.sql)
  A valid date part name is required but found min at [23:29]
  compiled Code at target/run/acme/models/customer_revenue_by_month.sql
[0m18:08:44.658521 [info ] [MainThread]: 
[0m18:08:44.658770 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=2 TOTAL=4
[0m18:08:44.659252 [debug] [MainThread]: Command `dbt run` failed at 18:08:44.659180 after 8.39 seconds
[0m18:08:44.659572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050c7b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100c52950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100bd5950>]}
[0m18:08:44.659855 [debug] [MainThread]: Flushing usage events
[0m18:09:21.908278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106852850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068538d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068690d0>]}


============================== 18:09:21.911575 | 6b24b185-e1f4-4130-a070-09093fce9c95 ==============================
[0m18:09:21.911575 [info ] [MainThread]: Running with dbt=1.6.7
[0m18:09:21.911942 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m18:09:22.132486 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:09:22.132812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '6b24b185-e1f4-4130-a070-09093fce9c95', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106873d10>]}
[0m18:09:22.133055 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:09:22.133235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '6b24b185-e1f4-4130-a070-09093fce9c95', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107328cd0>]}
[0m18:09:22.153023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6b24b185-e1f4-4130-a070-09093fce9c95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107309110>]}
[0m18:09:22.160022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6b24b185-e1f4-4130-a070-09093fce9c95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107252d10>]}
[0m18:09:22.160569 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m18:09:22.174167 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m18:09:22.213400 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:09:22.213874 [debug] [MainThread]: Partial parsing: updated file: acme://models/customer_churn_month.sql
[0m18:09:22.285101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6b24b185-e1f4-4130-a070-09093fce9c95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107536d10>]}
[0m18:09:22.295518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6b24b185-e1f4-4130-a070-09093fce9c95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10780c250>]}
[0m18:09:22.295805 [info ] [MainThread]: Found 4 models, 1 seed, 21 tests, 0 sources, 0 exposures, 0 metrics, 582 macros, 0 groups, 0 semantic models
[0m18:09:22.295966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b24b185-e1f4-4130-a070-09093fce9c95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061e0c90>]}
[0m18:09:22.296950 [info ] [MainThread]: 
[0m18:09:22.297324 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:09:22.297884 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_production-environment-306717'
[0m18:09:22.298061 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:09:23.638623 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_production-environment-306717, now list_production-environment-306717_general_explorations)
[0m18:09:23.640313 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:09:24.101295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b24b185-e1f4-4130-a070-09093fce9c95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b4c750>]}
[0m18:09:24.102490 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:09:24.102860 [info ] [MainThread]: 
[0m18:09:24.106672 [debug] [Thread-1 (]: Began running node model.acme.util_months
[0m18:09:24.107249 [info ] [Thread-1 (]: 1 of 4 START sql view model general_explorations.util_months ................... [RUN]
[0m18:09:24.107991 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_production-environment-306717_general_explorations, now model.acme.util_months)
[0m18:09:24.108343 [debug] [Thread-1 (]: Began compiling node model.acme.util_months
[0m18:09:24.129921 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:24.130405 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


        select 

    datetime_diff(
        cast(date_trunc(current_date, month) as datetime),
        cast('2018-01-01' as datetime),
        month
    )


[0m18:09:24.747903 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:63dd73b2-1560-463d-abff-0c8be1a52a6a&page=queryresults
[0m18:09:25.789889 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.util_months"
[0m18:09:25.792517 [debug] [Thread-1 (]: Timing info for model.acme.util_months (compile): 18:09:24.108587 => 18:09:25.792251
[0m18:09:25.792984 [debug] [Thread-1 (]: Began executing node model.acme.util_months
[0m18:09:25.818566 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.util_months"
[0m18:09:25.819368 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


  create or replace view `production-environment-306717`.`general_explorations`.`util_months`
  OPTIONS()
  as 

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
    
    

    )

    select *
    from unioned
    where generated_number <= 70
    order by generated_number



),

all_periods as (

    select (
        

        datetime_add(
            cast( '2018-01-01' as datetime),
        interval row_number() over (order by 1) - 1 month
        )


    ) as date_month
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_month <= date_trunc(current_date, month)

)

select * from filtered

;


[0m18:09:26.182206 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:22f9a600-8ab2-4ba5-917b-1c91028b4607&page=queryresults
[0m18:09:26.819705 [debug] [Thread-1 (]: Timing info for model.acme.util_months (execute): 18:09:25.793246 => 18:09:26.819462
[0m18:09:26.820827 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b24b185-e1f4-4130-a070-09093fce9c95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075736d0>]}
[0m18:09:26.821553 [info ] [Thread-1 (]: 1 of 4 OK created sql view model general_explorations.util_months .............. [[32mCREATE VIEW (0 processed)[0m in 2.71s]
[0m18:09:26.822205 [debug] [Thread-1 (]: Finished running node model.acme.util_months
[0m18:09:26.823092 [debug] [Thread-1 (]: Began running node model.acme.customer_revenue_by_month
[0m18:09:26.823682 [info ] [Thread-1 (]: 2 of 4 START sql view model general_explorations.customer_revenue_by_month ..... [RUN]
[0m18:09:26.824415 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.util_months, now model.acme.customer_revenue_by_month)
[0m18:09:26.824787 [debug] [Thread-1 (]: Began compiling node model.acme.customer_revenue_by_month
[0m18:09:26.828486 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.customer_revenue_by_month"
[0m18:09:26.830113 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (compile): 18:09:26.825029 => 18:09:26.829935
[0m18:09:26.830446 [debug] [Thread-1 (]: Began executing node model.acme.customer_revenue_by_month
[0m18:09:26.834111 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.customer_revenue_by_month"
[0m18:09:26.835202 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:26.835766 [debug] [Thread-1 (]: On model.acme.customer_revenue_by_month: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.customer_revenue_by_month"} */


  create or replace view `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`
  OPTIONS()
  as with subscription_periods as (

    select * from `production-environment-306717`.`general_explorations`.`subscription_periods`

),

months as (

    select * from `production-environment-306717`.`general_explorations`.`util_months`

),

-- determine when a given account had its first and last (or most recent) month
customers as (

    select
        customer_id,
        date_trunc('month', min(start_date)) as date_month_start,
        date_trunc('month', max(end_date)) as date_month_end

    from subscription_periods

    group by 1

),

-- create one record per month between a customer's first and last month
-- (example of a date spine)
customer_months as (

    select
        customers.customer_id,
        months.date_month

    from customers

    inner join months
        -- all months after start date
        on  months.date_month >= customers.date_month_start
        -- and before end date
        and months.date_month < customers.date_month_end

),

-- join the account-month spine to MRR base model, pulling through most recent dates
-- and plan info for month rows that have no invoices (i.e. churns)
joined as (

    select
        customer_months.date_month,
        customer_months.customer_id,
        coalesce(subscription_periods.monthly_amount, 0) as mrr

    from customer_months

    left join subscription_periods
        on customer_months.customer_id = subscription_periods.customer_id
        -- month is after a subscription start date
        and customer_months.date_month >= subscription_periods.start_date
        -- month is before a subscription end date (and handle null case)
        and (customer_months.date_month < subscription_periods.end_date
                or subscription_periods.end_date is null)

),

final as (

    select
        date_month,
        customer_id,
        mrr,

        mrr > 0 as is_active,

        -- calculate first and last months
        min(case when is_active then date_month end) over (
            partition by customer_id
        ) as first_active_month,

        max(case when is_active then date_month end) over (
            partition by customer_id
        ) as last_active_month,

        -- calculate if this record is the first or last month
        first_active_month = date_month as is_first_month,
        last_active_month = date_month as is_last_month

    from joined

)

select * from final;


[0m18:09:27.513015 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:6dfae655-977f-47f8-a72c-c9fdc9f5de69&page=queryresults
[0m18:09:28.125349 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('A valid date part name is required but found min at [23:29]')
[0m18:09:28.636784 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:e6658031-f369-422d-8239-116175e7b2b7&page=queryresults
[0m18:09:29.224325 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:e6658031-f369-422d-8239-116175e7b2b7&page=queryresults
[0m18:09:29.226541 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (execute): 18:09:26.830664 => 18:09:29.226063
[0m18:09:29.245291 [debug] [Thread-1 (]: Database Error in model customer_revenue_by_month (models/customer_revenue_by_month.sql)
  A valid date part name is required but found min at [23:29]
  compiled Code at target/run/acme/models/customer_revenue_by_month.sql
[0m18:09:29.245977 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b24b185-e1f4-4130-a070-09093fce9c95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10787cdd0>]}
[0m18:09:29.246672 [error] [Thread-1 (]: 2 of 4 ERROR creating sql view model general_explorations.customer_revenue_by_month  [[31mERROR[0m in 2.42s]
[0m18:09:29.247301 [debug] [Thread-1 (]: Finished running node model.acme.customer_revenue_by_month
[0m18:09:29.248165 [debug] [Thread-1 (]: Began running node model.acme.customer_churn_month
[0m18:09:29.248733 [info ] [Thread-1 (]: 3 of 4 SKIP relation general_explorations.customer_churn_month ................. [[33mSKIP[0m]
[0m18:09:29.249264 [debug] [Thread-1 (]: Finished running node model.acme.customer_churn_month
[0m18:09:29.249931 [debug] [Thread-1 (]: Began running node model.acme.mrr
[0m18:09:29.250434 [info ] [Thread-1 (]: 4 of 4 SKIP relation general_explorations.mrr .................................. [[33mSKIP[0m]
[0m18:09:29.250878 [debug] [Thread-1 (]: Finished running node model.acme.mrr
[0m18:09:29.252390 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:09:29.252680 [debug] [MainThread]: Connection 'model.acme.customer_revenue_by_month' was properly closed.
[0m18:09:29.252975 [info ] [MainThread]: 
[0m18:09:29.253266 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 6.96 seconds (6.96s).
[0m18:09:29.253988 [debug] [MainThread]: Command end result
[0m18:09:29.266608 [info ] [MainThread]: 
[0m18:09:29.267128 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:09:29.267358 [info ] [MainThread]: 
[0m18:09:29.267581 [error] [MainThread]:   Database Error in model customer_revenue_by_month (models/customer_revenue_by_month.sql)
  A valid date part name is required but found min at [23:29]
  compiled Code at target/run/acme/models/customer_revenue_by_month.sql
[0m18:09:29.267807 [info ] [MainThread]: 
[0m18:09:29.268058 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=2 TOTAL=4
[0m18:09:29.268622 [debug] [MainThread]: Command `dbt run` failed at 18:09:29.268529 after 7.42 seconds
[0m18:09:29.269001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068686d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075cb750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1023e6950>]}
[0m18:09:29.269327 [debug] [MainThread]: Flushing usage events
[0m18:11:15.431112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118a8ccd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118a973d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118a97a10>]}


============================== 18:11:15.433864 | eb083fec-6ef0-4ea5-a4ba-3588dccb6db5 ==============================
[0m18:11:15.433864 [info ] [MainThread]: Running with dbt=1.6.7
[0m18:11:15.434163 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m18:11:15.648821 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:11:15.649098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'eb083fec-6ef0-4ea5-a4ba-3588dccb6db5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118d79c50>]}
[0m18:11:15.649334 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:11:15.649516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'eb083fec-6ef0-4ea5-a4ba-3588dccb6db5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119750d50>]}
[0m18:11:15.669052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eb083fec-6ef0-4ea5-a4ba-3588dccb6db5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118d7a2d0>]}
[0m18:11:15.676099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eb083fec-6ef0-4ea5-a4ba-3588dccb6db5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119753f50>]}
[0m18:11:15.676697 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m18:11:15.690522 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m18:11:15.731072 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:11:15.731520 [debug] [MainThread]: Partial parsing: updated file: acme://models/customer_churn_month.sql
[0m18:11:15.802448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eb083fec-6ef0-4ea5-a4ba-3588dccb6db5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119750d50>]}
[0m18:11:15.809965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eb083fec-6ef0-4ea5-a4ba-3588dccb6db5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119a7ebd0>]}
[0m18:11:15.810188 [info ] [MainThread]: Found 4 models, 1 seed, 21 tests, 0 sources, 0 exposures, 0 metrics, 582 macros, 0 groups, 0 semantic models
[0m18:11:15.810348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb083fec-6ef0-4ea5-a4ba-3588dccb6db5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11971b550>]}
[0m18:11:15.811267 [info ] [MainThread]: 
[0m18:11:15.811628 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:11:15.812157 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_production-environment-306717'
[0m18:11:15.812301 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:11:17.294223 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_production-environment-306717, now list_production-environment-306717_general_explorations)
[0m18:11:17.295546 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:11:17.745209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb083fec-6ef0-4ea5-a4ba-3588dccb6db5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119ca7f90>]}
[0m18:11:17.746351 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:11:17.746744 [info ] [MainThread]: 
[0m18:11:17.750595 [debug] [Thread-1 (]: Began running node model.acme.util_months
[0m18:11:17.751115 [info ] [Thread-1 (]: 1 of 4 START sql view model general_explorations.util_months ................... [RUN]
[0m18:11:17.751830 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_production-environment-306717_general_explorations, now model.acme.util_months)
[0m18:11:17.752162 [debug] [Thread-1 (]: Began compiling node model.acme.util_months
[0m18:11:17.773747 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:11:17.774184 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


        select 

    datetime_diff(
        cast(date_trunc(current_date, month) as datetime),
        cast('2018-01-01' as datetime),
        month
    )


[0m18:11:18.391678 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:3c549e36-7405-40dd-8066-ab594e2d23f4&page=queryresults
[0m18:11:19.525847 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.util_months"
[0m18:11:19.528623 [debug] [Thread-1 (]: Timing info for model.acme.util_months (compile): 18:11:17.752405 => 18:11:19.528319
[0m18:11:19.529116 [debug] [Thread-1 (]: Began executing node model.acme.util_months
[0m18:11:19.555412 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.util_months"
[0m18:11:19.556217 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


  create or replace view `production-environment-306717`.`general_explorations`.`util_months`
  OPTIONS()
  as 

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
    
    

    )

    select *
    from unioned
    where generated_number <= 70
    order by generated_number



),

all_periods as (

    select (
        

        datetime_add(
            cast( '2018-01-01' as datetime),
        interval row_number() over (order by 1) - 1 month
        )


    ) as date_month
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_month <= date_trunc(current_date, month)

)

select * from filtered

;


[0m18:11:20.029800 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:7f22d341-8c9d-4704-bce2-3c116f365e7a&page=queryresults
[0m18:11:20.606528 [debug] [Thread-1 (]: Timing info for model.acme.util_months (execute): 18:11:19.529399 => 18:11:20.606277
[0m18:11:20.608524 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb083fec-6ef0-4ea5-a4ba-3588dccb6db5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119d484d0>]}
[0m18:11:20.609240 [info ] [Thread-1 (]: 1 of 4 OK created sql view model general_explorations.util_months .............. [[32mCREATE VIEW (0 processed)[0m in 2.86s]
[0m18:11:20.609899 [debug] [Thread-1 (]: Finished running node model.acme.util_months
[0m18:11:20.610626 [debug] [Thread-1 (]: Began running node model.acme.customer_revenue_by_month
[0m18:11:20.611240 [info ] [Thread-1 (]: 2 of 4 START sql view model general_explorations.customer_revenue_by_month ..... [RUN]
[0m18:11:20.612026 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.util_months, now model.acme.customer_revenue_by_month)
[0m18:11:20.612353 [debug] [Thread-1 (]: Began compiling node model.acme.customer_revenue_by_month
[0m18:11:20.616177 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.customer_revenue_by_month"
[0m18:11:20.617026 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (compile): 18:11:20.612570 => 18:11:20.616854
[0m18:11:20.617357 [debug] [Thread-1 (]: Began executing node model.acme.customer_revenue_by_month
[0m18:11:20.620943 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.customer_revenue_by_month"
[0m18:11:20.621682 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:11:20.622177 [debug] [Thread-1 (]: On model.acme.customer_revenue_by_month: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.customer_revenue_by_month"} */


  create or replace view `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`
  OPTIONS()
  as with subscription_periods as (

    select * from `production-environment-306717`.`general_explorations`.`subscription_periods`

),

months as (

    select * from `production-environment-306717`.`general_explorations`.`util_months`

),

-- determine when a given account had its first and last (or most recent) month
customers as (

    select
        customer_id,
        date_trunc('month', min(start_date)) as date_month_start,
        date_trunc('month', max(end_date)) as date_month_end

    from subscription_periods

    group by 1

),

-- create one record per month between a customer's first and last month
-- (example of a date spine)
customer_months as (

    select
        customers.customer_id,
        months.date_month

    from customers

    inner join months
        -- all months after start date
        on  months.date_month >= customers.date_month_start
        -- and before end date
        and months.date_month < customers.date_month_end

),

-- join the account-month spine to MRR base model, pulling through most recent dates
-- and plan info for month rows that have no invoices (i.e. churns)
joined as (

    select
        customer_months.date_month,
        customer_months.customer_id,
        coalesce(subscription_periods.monthly_amount, 0) as mrr

    from customer_months

    left join subscription_periods
        on customer_months.customer_id = subscription_periods.customer_id
        -- month is after a subscription start date
        and customer_months.date_month >= subscription_periods.start_date
        -- month is before a subscription end date (and handle null case)
        and (customer_months.date_month < subscription_periods.end_date
                or subscription_periods.end_date is null)

),

final as (

    select
        date_month,
        customer_id,
        mrr,

        mrr > 0 as is_active,

        -- calculate first and last months
        min(case when is_active then date_month end) over (
            partition by customer_id
        ) as first_active_month,

        max(case when is_active then date_month end) over (
            partition by customer_id
        ) as last_active_month,

        -- calculate if this record is the first or last month
        first_active_month = date_month as is_first_month,
        last_active_month = date_month as is_last_month

    from joined

)

select * from final;


[0m18:11:21.227647 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:3ae7c1ab-58ef-4542-a24c-2bf2ccc7ed64&page=queryresults
[0m18:11:21.822310 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('A valid date part name is required but found min at [23:29]')
[0m18:11:22.918327 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:47e5d384-33e5-4e00-85e5-40caf15de709&page=queryresults
[0m18:11:23.527886 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:47e5d384-33e5-4e00-85e5-40caf15de709&page=queryresults
[0m18:11:23.529837 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (execute): 18:11:20.617565 => 18:11:23.529232
[0m18:11:23.548516 [debug] [Thread-1 (]: Database Error in model customer_revenue_by_month (models/customer_revenue_by_month.sql)
  A valid date part name is required but found min at [23:29]
  compiled Code at target/run/acme/models/customer_revenue_by_month.sql
[0m18:11:23.549290 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb083fec-6ef0-4ea5-a4ba-3588dccb6db5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119eb3f10>]}
[0m18:11:23.549970 [error] [Thread-1 (]: 2 of 4 ERROR creating sql view model general_explorations.customer_revenue_by_month  [[31mERROR[0m in 2.94s]
[0m18:11:23.550608 [debug] [Thread-1 (]: Finished running node model.acme.customer_revenue_by_month
[0m18:11:23.551491 [debug] [Thread-1 (]: Began running node model.acme.customer_churn_month
[0m18:11:23.552082 [info ] [Thread-1 (]: 3 of 4 SKIP relation general_explorations.customer_churn_month ................. [[33mSKIP[0m]
[0m18:11:23.552547 [debug] [Thread-1 (]: Finished running node model.acme.customer_churn_month
[0m18:11:23.553182 [debug] [Thread-1 (]: Began running node model.acme.mrr
[0m18:11:23.553584 [info ] [Thread-1 (]: 4 of 4 SKIP relation general_explorations.mrr .................................. [[33mSKIP[0m]
[0m18:11:23.553985 [debug] [Thread-1 (]: Finished running node model.acme.mrr
[0m18:11:23.555627 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:11:23.556001 [debug] [MainThread]: Connection 'model.acme.customer_revenue_by_month' was properly closed.
[0m18:11:23.556355 [info ] [MainThread]: 
[0m18:11:23.556649 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 7.74 seconds (7.74s).
[0m18:11:23.557409 [debug] [MainThread]: Command end result
[0m18:11:23.569421 [info ] [MainThread]: 
[0m18:11:23.569792 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:11:23.570016 [info ] [MainThread]: 
[0m18:11:23.570240 [error] [MainThread]:   Database Error in model customer_revenue_by_month (models/customer_revenue_by_month.sql)
  A valid date part name is required but found min at [23:29]
  compiled Code at target/run/acme/models/customer_revenue_by_month.sql
[0m18:11:23.570466 [info ] [MainThread]: 
[0m18:11:23.570707 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=2 TOTAL=4
[0m18:11:23.571189 [debug] [MainThread]: Command `dbt run` failed at 18:11:23.571119 after 8.16 seconds
[0m18:11:23.571501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118a97e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102ac1950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1029e2190>]}
[0m18:11:23.571777 [debug] [MainThread]: Flushing usage events
[0m18:14:52.540311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10916e850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109177510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109177c90>]}


============================== 18:14:52.543230 | 6f9f5b53-9c56-4d3b-af51-1f9acb35b792 ==============================
[0m18:14:52.543230 [info ] [MainThread]: Running with dbt=1.6.7
[0m18:14:52.543551 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m18:14:52.775249 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:14:52.775536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '6f9f5b53-9c56-4d3b-af51-1f9acb35b792', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c033d0>]}
[0m18:14:52.775768 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:14:52.775943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '6f9f5b53-9c56-4d3b-af51-1f9acb35b792', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109bed110>]}
[0m18:14:52.795389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6f9f5b53-9c56-4d3b-af51-1f9acb35b792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e62f50>]}
[0m18:14:52.802377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6f9f5b53-9c56-4d3b-af51-1f9acb35b792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109459fd0>]}
[0m18:14:52.803022 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m18:14:52.815826 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m18:14:52.857913 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:14:52.858331 [debug] [MainThread]: Partial parsing: updated file: acme://models/customer_revenue_by_month.sql
[0m18:14:52.933921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6f9f5b53-9c56-4d3b-af51-1f9acb35b792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e6b550>]}
[0m18:14:52.943799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6f9f5b53-9c56-4d3b-af51-1f9acb35b792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fe02d0>]}
[0m18:14:52.944048 [info ] [MainThread]: Found 4 models, 1 seed, 21 tests, 0 sources, 0 exposures, 0 metrics, 582 macros, 0 groups, 0 semantic models
[0m18:14:52.944203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f9f5b53-9c56-4d3b-af51-1f9acb35b792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ef1010>]}
[0m18:14:52.945140 [info ] [MainThread]: 
[0m18:14:52.945497 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:14:52.946050 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_production-environment-306717'
[0m18:14:52.946238 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:14:54.486317 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_production-environment-306717, now list_production-environment-306717_general_explorations)
[0m18:14:54.487239 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:14:54.945616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f9f5b53-9c56-4d3b-af51-1f9acb35b792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ebced0>]}
[0m18:14:54.946908 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:14:54.947301 [info ] [MainThread]: 
[0m18:14:54.951145 [debug] [Thread-1 (]: Began running node model.acme.util_months
[0m18:14:54.951700 [info ] [Thread-1 (]: 1 of 4 START sql view model general_explorations.util_months ................... [RUN]
[0m18:14:54.952454 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_production-environment-306717_general_explorations, now model.acme.util_months)
[0m18:14:54.952811 [debug] [Thread-1 (]: Began compiling node model.acme.util_months
[0m18:14:54.973985 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:14:54.974424 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


        select 

    datetime_diff(
        cast(date_trunc(current_date, month) as datetime),
        cast('2018-01-01' as datetime),
        month
    )


[0m18:14:55.611548 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:4874120b-0dd8-471d-8313-fec58607ae67&page=queryresults
[0m18:14:56.755637 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.util_months"
[0m18:14:56.758598 [debug] [Thread-1 (]: Timing info for model.acme.util_months (compile): 18:14:54.953043 => 18:14:56.758339
[0m18:14:56.759063 [debug] [Thread-1 (]: Began executing node model.acme.util_months
[0m18:14:56.785423 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.util_months"
[0m18:14:56.786327 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


  create or replace view `production-environment-306717`.`general_explorations`.`util_months`
  OPTIONS()
  as 

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
    
    

    )

    select *
    from unioned
    where generated_number <= 70
    order by generated_number



),

all_periods as (

    select (
        

        datetime_add(
            cast( '2018-01-01' as datetime),
        interval row_number() over (order by 1) - 1 month
        )


    ) as date_month
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_month <= date_trunc(current_date, month)

)

select * from filtered

;


[0m18:14:57.250339 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:7bffb619-6ba5-4dc3-8d21-6c25b3c7088a&page=queryresults
[0m18:14:57.887174 [debug] [Thread-1 (]: Timing info for model.acme.util_months (execute): 18:14:56.759325 => 18:14:57.886944
[0m18:14:57.888246 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f9f5b53-9c56-4d3b-af51-1f9acb35b792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a11ed10>]}
[0m18:14:57.888925 [info ] [Thread-1 (]: 1 of 4 OK created sql view model general_explorations.util_months .............. [[32mCREATE VIEW (0 processed)[0m in 2.94s]
[0m18:14:57.889583 [debug] [Thread-1 (]: Finished running node model.acme.util_months
[0m18:14:57.890306 [debug] [Thread-1 (]: Began running node model.acme.customer_revenue_by_month
[0m18:14:57.890953 [info ] [Thread-1 (]: 2 of 4 START sql view model general_explorations.customer_revenue_by_month ..... [RUN]
[0m18:14:57.891675 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.util_months, now model.acme.customer_revenue_by_month)
[0m18:14:57.892040 [debug] [Thread-1 (]: Began compiling node model.acme.customer_revenue_by_month
[0m18:14:57.895805 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.customer_revenue_by_month"
[0m18:14:57.897593 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (compile): 18:14:57.892304 => 18:14:57.897412
[0m18:14:57.897925 [debug] [Thread-1 (]: Began executing node model.acme.customer_revenue_by_month
[0m18:14:57.905759 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.customer_revenue_by_month"
[0m18:14:57.906499 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:14:57.906961 [debug] [Thread-1 (]: On model.acme.customer_revenue_by_month: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.customer_revenue_by_month"} */


  create or replace view `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`
  OPTIONS()
  as with subscription_periods as (

    select * from `production-environment-306717`.`general_explorations`.`subscription_periods`

),

months as (

    select * from `production-environment-306717`.`general_explorations`.`util_months`

),

-- determine when a given account had its first and last (or most recent) month
customers as (

    select
        customer_id,
        date_trunc(min(start_date), month) as date_month_start,
        date_trunc(max(end_date), month) as date_month_end

    from subscription_periods

    group by 1

),

-- create one record per month between a customer's first and last month
-- (example of a date spine)
customer_months as (

    select
        customers.customer_id,
        months.date_month

    from customers

    inner join months
        -- all months after start date
        on  months.date_month >= customers.date_month_start
        -- and before end date
        and months.date_month < customers.date_month_end

),

-- join the account-month spine to MRR base model, pulling through most recent dates
-- and plan info for month rows that have no invoices (i.e. churns)
joined as (

    select
        customer_months.date_month,
        customer_months.customer_id,
        coalesce(subscription_periods.monthly_amount, 0) as mrr

    from customer_months

    left join subscription_periods
        on customer_months.customer_id = subscription_periods.customer_id
        -- month is after a subscription start date
        and customer_months.date_month >= subscription_periods.start_date
        -- month is before a subscription end date (and handle null case)
        and (customer_months.date_month < subscription_periods.end_date
                or subscription_periods.end_date is null)

),

final as (

    select
        date_month,
        customer_id,
        mrr,

        mrr > 0 as is_active,

        -- calculate first and last months
        min(case when is_active then date_month end) over (
            partition by customer_id
        ) as first_active_month,

        max(case when is_active then date_month end) over (
            partition by customer_id
        ) as last_active_month,

        -- calculate if this record is the first or last month
        first_active_month = date_month as is_first_month,
        last_active_month = date_month as is_last_month

    from joined

)

select * from final;


[0m18:14:58.431898 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:edf0d15f-6828-4a63-983c-66267b5db46b&page=queryresults
[0m18:14:58.988248 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: is_active at [81:23]')
[0m18:14:59.912516 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:2ec9945e-f314-433f-be40-a6a718fb4110&page=queryresults
[0m18:15:00.528416 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:2ec9945e-f314-433f-be40-a6a718fb4110&page=queryresults
[0m18:15:00.530533 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (execute): 18:14:57.898141 => 18:15:00.529965
[0m18:15:00.549320 [debug] [Thread-1 (]: Database Error in model customer_revenue_by_month (models/customer_revenue_by_month.sql)
  Unrecognized name: is_active at [81:23]
  compiled Code at target/run/acme/models/customer_revenue_by_month.sql
[0m18:15:00.550089 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f9f5b53-9c56-4d3b-af51-1f9acb35b792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f82cd0>]}
[0m18:15:00.550775 [error] [Thread-1 (]: 2 of 4 ERROR creating sql view model general_explorations.customer_revenue_by_month  [[31mERROR[0m in 2.66s]
[0m18:15:00.551411 [debug] [Thread-1 (]: Finished running node model.acme.customer_revenue_by_month
[0m18:15:00.552257 [debug] [Thread-1 (]: Began running node model.acme.customer_churn_month
[0m18:15:00.552792 [info ] [Thread-1 (]: 3 of 4 SKIP relation general_explorations.customer_churn_month ................. [[33mSKIP[0m]
[0m18:15:00.553363 [debug] [Thread-1 (]: Finished running node model.acme.customer_churn_month
[0m18:15:00.554001 [debug] [Thread-1 (]: Began running node model.acme.mrr
[0m18:15:00.554450 [info ] [Thread-1 (]: 4 of 4 SKIP relation general_explorations.mrr .................................. [[33mSKIP[0m]
[0m18:15:00.554871 [debug] [Thread-1 (]: Finished running node model.acme.mrr
[0m18:15:00.556574 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:15:00.556891 [debug] [MainThread]: Connection 'model.acme.customer_revenue_by_month' was properly closed.
[0m18:15:00.557220 [info ] [MainThread]: 
[0m18:15:00.557532 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 7.61 seconds (7.61s).
[0m18:15:00.558255 [debug] [MainThread]: Command end result
[0m18:15:00.567398 [info ] [MainThread]: 
[0m18:15:00.567943 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:15:00.568191 [info ] [MainThread]: 
[0m18:15:00.568424 [error] [MainThread]:   Database Error in model customer_revenue_by_month (models/customer_revenue_by_month.sql)
  Unrecognized name: is_active at [81:23]
  compiled Code at target/run/acme/models/customer_revenue_by_month.sql
[0m18:15:00.568655 [info ] [MainThread]: 
[0m18:15:00.568904 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=2 TOTAL=4
[0m18:15:00.569385 [debug] [MainThread]: Command `dbt run` failed at 18:15:00.569314 after 8.05 seconds
[0m18:15:00.569707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109177a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c85950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d02910>]}
[0m18:15:00.569994 [debug] [MainThread]: Flushing usage events
[0m18:16:37.842764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10892a850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10892b090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108940950>]}


============================== 18:16:37.845564 | e7894ba0-844c-4241-8c86-465135533ba0 ==============================
[0m18:16:37.845564 [info ] [MainThread]: Running with dbt=1.6.7
[0m18:16:37.845863 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m18:16:38.059813 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:16:38.060108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'e7894ba0-844c-4241-8c86-465135533ba0', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c175d0>]}
[0m18:16:38.060345 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:16:38.060524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'e7894ba0-844c-4241-8c86-465135533ba0', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109386410>]}
[0m18:16:38.079975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e7894ba0-844c-4241-8c86-465135533ba0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109387110>]}
[0m18:16:38.086887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e7894ba0-844c-4241-8c86-465135533ba0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10917fd50>]}
[0m18:16:38.087442 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m18:16:38.100582 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m18:16:38.140188 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:16:38.140624 [debug] [MainThread]: Partial parsing: updated file: acme://models/customer_revenue_by_month.sql
[0m18:16:38.215263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e7894ba0-844c-4241-8c86-465135533ba0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109618890>]}
[0m18:16:38.222936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e7894ba0-844c-4241-8c86-465135533ba0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096dd750>]}
[0m18:16:38.223171 [info ] [MainThread]: Found 4 models, 1 seed, 21 tests, 0 sources, 0 exposures, 0 metrics, 582 macros, 0 groups, 0 semantic models
[0m18:16:38.223343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7894ba0-844c-4241-8c86-465135533ba0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093cc050>]}
[0m18:16:38.224292 [info ] [MainThread]: 
[0m18:16:38.224642 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:16:38.225165 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_production-environment-306717'
[0m18:16:38.225346 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:16:39.458607 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_production-environment-306717, now list_production-environment-306717_general_explorations)
[0m18:16:39.459965 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:16:39.984543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7894ba0-844c-4241-8c86-465135533ba0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109913a50>]}
[0m18:16:39.985768 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:16:39.986146 [info ] [MainThread]: 
[0m18:16:39.989296 [debug] [Thread-1 (]: Began running node model.acme.util_months
[0m18:16:39.989918 [info ] [Thread-1 (]: 1 of 4 START sql view model general_explorations.util_months ................... [RUN]
[0m18:16:39.990668 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_production-environment-306717_general_explorations, now model.acme.util_months)
[0m18:16:39.991018 [debug] [Thread-1 (]: Began compiling node model.acme.util_months
[0m18:16:40.012620 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:16:40.013106 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


        select 

    datetime_diff(
        cast(date_trunc(current_date, month) as datetime),
        cast('2018-01-01' as datetime),
        month
    )


[0m18:16:40.677629 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:bab82674-3200-41a3-bd8e-0fb86ffbff29&page=queryresults
[0m18:16:41.671123 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.util_months"
[0m18:16:41.673628 [debug] [Thread-1 (]: Timing info for model.acme.util_months (compile): 18:16:39.991259 => 18:16:41.673371
[0m18:16:41.674070 [debug] [Thread-1 (]: Began executing node model.acme.util_months
[0m18:16:41.700368 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.util_months"
[0m18:16:41.701121 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


  create or replace view `production-environment-306717`.`general_explorations`.`util_months`
  OPTIONS()
  as 

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
    
    

    )

    select *
    from unioned
    where generated_number <= 70
    order by generated_number



),

all_periods as (

    select (
        

        datetime_add(
            cast( '2018-01-01' as datetime),
        interval row_number() over (order by 1) - 1 month
        )


    ) as date_month
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_month <= date_trunc(current_date, month)

)

select * from filtered

;


[0m18:16:42.109275 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:d02f2aa2-20bf-42cd-9d5e-ed7ece094005&page=queryresults
[0m18:16:42.724120 [debug] [Thread-1 (]: Timing info for model.acme.util_months (execute): 18:16:41.674347 => 18:16:42.723886
[0m18:16:42.725105 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7894ba0-844c-4241-8c86-465135533ba0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10932d590>]}
[0m18:16:42.725802 [info ] [Thread-1 (]: 1 of 4 OK created sql view model general_explorations.util_months .............. [[32mCREATE VIEW (0 processed)[0m in 2.73s]
[0m18:16:42.726459 [debug] [Thread-1 (]: Finished running node model.acme.util_months
[0m18:16:42.727359 [debug] [Thread-1 (]: Began running node model.acme.customer_revenue_by_month
[0m18:16:42.727824 [info ] [Thread-1 (]: 2 of 4 START sql view model general_explorations.customer_revenue_by_month ..... [RUN]
[0m18:16:42.728459 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.util_months, now model.acme.customer_revenue_by_month)
[0m18:16:42.728786 [debug] [Thread-1 (]: Began compiling node model.acme.customer_revenue_by_month
[0m18:16:42.732478 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.customer_revenue_by_month"
[0m18:16:42.733383 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (compile): 18:16:42.728996 => 18:16:42.733205
[0m18:16:42.733723 [debug] [Thread-1 (]: Began executing node model.acme.customer_revenue_by_month
[0m18:16:42.741473 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.customer_revenue_by_month"
[0m18:16:42.742267 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:16:42.742763 [debug] [Thread-1 (]: On model.acme.customer_revenue_by_month: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.customer_revenue_by_month"} */


  create or replace view `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`
  OPTIONS()
  as with subscription_periods as (

    select * from `production-environment-306717`.`general_explorations`.`subscription_periods`

),

months as (

    select * from `production-environment-306717`.`general_explorations`.`util_months`

),

-- determine when a given account had its first and last (or most recent) month
customers as (

    select
        customer_id,
        date_trunc(min(start_date), month) as date_month_start,
        date_trunc(max(end_date), month) as date_month_end

    from subscription_periods

    group by 1

),

-- create one record per month between a customer's first and last month
-- (example of a date spine)
customer_months as (

    select
        customers.customer_id,
        months.date_month

    from customers

    inner join months
        -- all months after start date
        on  months.date_month >= customers.date_month_start
        -- and before end date
        and months.date_month < customers.date_month_end

),

-- join the account-month spine to MRR base model, pulling through most recent dates
-- and plan info for month rows that have no invoices (i.e. churns)
joined as (

    select
        customer_months.date_month,
        customer_months.customer_id,
        coalesce(subscription_periods.monthly_amount, 0) as mrr

    from customer_months

    left join subscription_periods
        on customer_months.customer_id = subscription_periods.customer_id
        -- month is after a subscription start date
        and customer_months.date_month >= subscription_periods.start_date
        -- month is before a subscription end date (and handle null case)
        and (customer_months.date_month < subscription_periods.end_date
                or subscription_periods.end_date is null)

),

final as (

    select
        date_month,
        customer_id,
        mrr,
        case when mrr > 0 then true else false end as is_active

        -- calculate first and last months
        min(case when is_active then date_month end) over (
            partition by customer_id
        ) as first_active_month,

        max(case when is_active then date_month end) over (
            partition by customer_id
        ) as last_active_month,

        -- calculate if this record is the first or last month
        first_active_month = date_month as is_first_month,
        last_active_month = date_month as is_last_month

    from joined

)

select * from final;


[0m18:16:43.139368 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:8c9817e7-17cf-4e00-8e7d-7aea818b6a4d&page=queryresults
[0m18:16:43.141591 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword MIN at [80:9]')
[0m18:16:43.546621 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:9b1eefd2-c53c-4d9e-b243-57664eeaba87&page=queryresults
[0m18:16:43.550010 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:9b1eefd2-c53c-4d9e-b243-57664eeaba87&page=queryresults
[0m18:16:43.551107 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (execute): 18:16:42.733937 => 18:16:43.550745
[0m18:16:43.568654 [debug] [Thread-1 (]: Database Error in model customer_revenue_by_month (models/customer_revenue_by_month.sql)
  Syntax error: Expected ")" but got keyword MIN at [80:9]
  compiled Code at target/run/acme/models/customer_revenue_by_month.sql
[0m18:16:43.569397 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7894ba0-844c-4241-8c86-465135533ba0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10994d550>]}
[0m18:16:43.570083 [error] [Thread-1 (]: 2 of 4 ERROR creating sql view model general_explorations.customer_revenue_by_month  [[31mERROR[0m in 0.84s]
[0m18:16:43.570734 [debug] [Thread-1 (]: Finished running node model.acme.customer_revenue_by_month
[0m18:16:43.571629 [debug] [Thread-1 (]: Began running node model.acme.customer_churn_month
[0m18:16:43.572176 [info ] [Thread-1 (]: 3 of 4 SKIP relation general_explorations.customer_churn_month ................. [[33mSKIP[0m]
[0m18:16:43.572631 [debug] [Thread-1 (]: Finished running node model.acme.customer_churn_month
[0m18:16:43.573287 [debug] [Thread-1 (]: Began running node model.acme.mrr
[0m18:16:43.573791 [info ] [Thread-1 (]: 4 of 4 SKIP relation general_explorations.mrr .................................. [[33mSKIP[0m]
[0m18:16:43.574272 [debug] [Thread-1 (]: Finished running node model.acme.mrr
[0m18:16:43.575933 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:16:43.576213 [debug] [MainThread]: Connection 'model.acme.customer_revenue_by_month' was properly closed.
[0m18:16:43.576502 [info ] [MainThread]: 
[0m18:16:43.576787 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 5.35 seconds (5.35s).
[0m18:16:43.577508 [debug] [MainThread]: Command end result
[0m18:16:43.588846 [info ] [MainThread]: 
[0m18:16:43.589204 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:16:43.589430 [info ] [MainThread]: 
[0m18:16:43.589653 [error] [MainThread]:   Database Error in model customer_revenue_by_month (models/customer_revenue_by_month.sql)
  Syntax error: Expected ")" but got keyword MIN at [80:9]
  compiled Code at target/run/acme/models/customer_revenue_by_month.sql
[0m18:16:43.589880 [info ] [MainThread]: 
[0m18:16:43.590128 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=2 TOTAL=4
[0m18:16:43.590618 [debug] [MainThread]: Command `dbt run` failed at 18:16:43.590547 after 5.77 seconds
[0m18:16:43.590936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108940d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1044be950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108929650>]}
[0m18:16:43.591218 [debug] [MainThread]: Flushing usage events
[0m18:17:09.406188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074f2850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074fbd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074fbf90>]}


============================== 18:17:09.409743 | f2034a57-1734-4121-abef-d8546c60cef5 ==============================
[0m18:17:09.409743 [info ] [MainThread]: Running with dbt=1.6.7
[0m18:17:09.410325 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:17:09.683106 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:17:09.683848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'f2034a57-1734-4121-abef-d8546c60cef5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac523d0>]}
[0m18:17:09.684177 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:17:09.684455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'f2034a57-1734-4121-abef-d8546c60cef5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac0a450>]}
[0m18:17:09.724513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f2034a57-1734-4121-abef-d8546c60cef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10abe8790>]}
[0m18:17:09.732990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f2034a57-1734-4121-abef-d8546c60cef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac696d0>]}
[0m18:17:09.734720 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m18:17:09.760914 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m18:17:09.806333 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:17:09.806815 [debug] [MainThread]: Partial parsing: updated file: acme://models/customer_revenue_by_month.sql
[0m18:17:09.888337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f2034a57-1734-4121-abef-d8546c60cef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b17afd0>]}
[0m18:17:09.895444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f2034a57-1734-4121-abef-d8546c60cef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b334e50>]}
[0m18:17:09.895738 [info ] [MainThread]: Found 4 models, 1 seed, 21 tests, 0 sources, 0 exposures, 0 metrics, 582 macros, 0 groups, 0 semantic models
[0m18:17:09.895985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2034a57-1734-4121-abef-d8546c60cef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b14c090>]}
[0m18:17:09.897260 [info ] [MainThread]: 
[0m18:17:09.897692 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:17:09.898251 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_production-environment-306717'
[0m18:17:09.898416 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:17:11.297210 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_production-environment-306717, now list_production-environment-306717_general_explorations)
[0m18:17:11.299334 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:17:11.795964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2034a57-1734-4121-abef-d8546c60cef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae73650>]}
[0m18:17:11.796796 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:17:11.797000 [info ] [MainThread]: 
[0m18:17:11.799607 [debug] [Thread-1 (]: Began running node model.acme.util_months
[0m18:17:11.800048 [info ] [Thread-1 (]: 1 of 4 START sql view model general_explorations.util_months ................... [RUN]
[0m18:17:11.800492 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_production-environment-306717_general_explorations, now model.acme.util_months)
[0m18:17:11.800688 [debug] [Thread-1 (]: Began compiling node model.acme.util_months
[0m18:17:11.813513 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:17:11.813983 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


        select 

    datetime_diff(
        cast(date_trunc(current_date, month) as datetime),
        cast('2018-01-01' as datetime),
        month
    )


[0m18:17:13.373968 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:ffda0208-b265-4b96-9f8c-dd0c100486ed&page=queryresults
[0m18:17:14.574161 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.util_months"
[0m18:17:14.577653 [debug] [Thread-1 (]: Timing info for model.acme.util_months (compile): 18:17:11.800822 => 18:17:14.577109
[0m18:17:14.578740 [debug] [Thread-1 (]: Began executing node model.acme.util_months
[0m18:17:14.612023 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.util_months"
[0m18:17:14.613091 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


  create or replace view `production-environment-306717`.`general_explorations`.`util_months`
  OPTIONS()
  as 

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
    
    

    )

    select *
    from unioned
    where generated_number <= 70
    order by generated_number



),

all_periods as (

    select (
        

        datetime_add(
            cast( '2018-01-01' as datetime),
        interval row_number() over (order by 1) - 1 month
        )


    ) as date_month
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_month <= date_trunc(current_date, month)

)

select * from filtered

;


[0m18:17:14.948914 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:d3a95e50-a044-479e-acf6-b60401f73a94&page=queryresults
[0m18:17:15.494766 [debug] [Thread-1 (]: Timing info for model.acme.util_months (execute): 18:17:14.579202 => 18:17:15.494570
[0m18:17:15.495628 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2034a57-1734-4121-abef-d8546c60cef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b35a610>]}
[0m18:17:15.496266 [info ] [Thread-1 (]: 1 of 4 OK created sql view model general_explorations.util_months .............. [[32mCREATE VIEW (0 processed)[0m in 3.70s]
[0m18:17:15.496770 [debug] [Thread-1 (]: Finished running node model.acme.util_months
[0m18:17:15.497368 [debug] [Thread-1 (]: Began running node model.acme.customer_revenue_by_month
[0m18:17:15.497710 [info ] [Thread-1 (]: 2 of 4 START sql view model general_explorations.customer_revenue_by_month ..... [RUN]
[0m18:17:15.498331 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.util_months, now model.acme.customer_revenue_by_month)
[0m18:17:15.498741 [debug] [Thread-1 (]: Began compiling node model.acme.customer_revenue_by_month
[0m18:17:15.502335 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.customer_revenue_by_month"
[0m18:17:15.503980 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (compile): 18:17:15.499073 => 18:17:15.503788
[0m18:17:15.504316 [debug] [Thread-1 (]: Began executing node model.acme.customer_revenue_by_month
[0m18:17:15.512893 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.customer_revenue_by_month"
[0m18:17:15.513791 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:17:15.514389 [debug] [Thread-1 (]: On model.acme.customer_revenue_by_month: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.customer_revenue_by_month"} */


  create or replace view `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`
  OPTIONS()
  as with subscription_periods as (

    select * from `production-environment-306717`.`general_explorations`.`subscription_periods`

),

months as (

    select * from `production-environment-306717`.`general_explorations`.`util_months`

),

-- determine when a given account had its first and last (or most recent) month
customers as (

    select
        customer_id,
        date_trunc(min(start_date), month) as date_month_start,
        date_trunc(max(end_date), month) as date_month_end

    from subscription_periods

    group by 1

),

-- create one record per month between a customer's first and last month
-- (example of a date spine)
customer_months as (

    select
        customers.customer_id,
        months.date_month

    from customers

    inner join months
        -- all months after start date
        on  months.date_month >= customers.date_month_start
        -- and before end date
        and months.date_month < customers.date_month_end

),

-- join the account-month spine to MRR base model, pulling through most recent dates
-- and plan info for month rows that have no invoices (i.e. churns)
joined as (

    select
        customer_months.date_month,
        customer_months.customer_id,
        coalesce(subscription_periods.monthly_amount, 0) as mrr

    from customer_months

    left join subscription_periods
        on customer_months.customer_id = subscription_periods.customer_id
        -- month is after a subscription start date
        and customer_months.date_month >= subscription_periods.start_date
        -- month is before a subscription end date (and handle null case)
        and (customer_months.date_month < subscription_periods.end_date
                or subscription_periods.end_date is null)

),

final as (

    select
        date_month,
        customer_id,
        mrr,
        case when mrr > 0 then true else false end as is_active,

        -- calculate first and last months
        min(case when is_active then date_month end) over (
            partition by customer_id
        ) as first_active_month,

        max(case when is_active then date_month end) over (
            partition by customer_id
        ) as last_active_month,

        -- calculate if this record is the first or last month
        first_active_month = date_month as is_first_month,
        last_active_month = date_month as is_last_month

    from joined

)

select * from final;


[0m18:17:16.105269 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:9f472e9f-7d15-4f89-a31e-405222806fef&page=queryresults
[0m18:17:16.825628 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: is_active at [80:23]')
[0m18:17:17.369834 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:69e0b6dd-d66b-4198-bb6b-7078876c6d55&page=queryresults
[0m18:17:17.948640 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:69e0b6dd-d66b-4198-bb6b-7078876c6d55&page=queryresults
[0m18:17:17.949984 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (execute): 18:17:15.504513 => 18:17:17.949534
[0m18:17:17.974215 [debug] [Thread-1 (]: Database Error in model customer_revenue_by_month (models/customer_revenue_by_month.sql)
  Unrecognized name: is_active at [80:23]
  compiled Code at target/run/acme/models/customer_revenue_by_month.sql
[0m18:17:17.975234 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2034a57-1734-4121-abef-d8546c60cef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b221210>]}
[0m18:17:17.976167 [error] [Thread-1 (]: 2 of 4 ERROR creating sql view model general_explorations.customer_revenue_by_month  [[31mERROR[0m in 2.48s]
[0m18:17:17.976961 [debug] [Thread-1 (]: Finished running node model.acme.customer_revenue_by_month
[0m18:17:17.977967 [debug] [Thread-1 (]: Began running node model.acme.customer_churn_month
[0m18:17:17.978605 [info ] [Thread-1 (]: 3 of 4 SKIP relation general_explorations.customer_churn_month ................. [[33mSKIP[0m]
[0m18:17:17.979145 [debug] [Thread-1 (]: Finished running node model.acme.customer_churn_month
[0m18:17:17.979961 [debug] [Thread-1 (]: Began running node model.acme.mrr
[0m18:17:17.980392 [info ] [Thread-1 (]: 4 of 4 SKIP relation general_explorations.mrr .................................. [[33mSKIP[0m]
[0m18:17:17.980786 [debug] [Thread-1 (]: Finished running node model.acme.mrr
[0m18:17:17.982490 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:17:17.982887 [debug] [MainThread]: Connection 'model.acme.customer_revenue_by_month' was properly closed.
[0m18:17:17.983265 [info ] [MainThread]: 
[0m18:17:17.983634 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 8.09 seconds (8.09s).
[0m18:17:17.984512 [debug] [MainThread]: Command end result
[0m18:17:17.998914 [info ] [MainThread]: 
[0m18:17:17.999381 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:17:17.999646 [info ] [MainThread]: 
[0m18:17:17.999988 [error] [MainThread]:   Database Error in model customer_revenue_by_month (models/customer_revenue_by_month.sql)
  Unrecognized name: is_active at [80:23]
  compiled Code at target/run/acme/models/customer_revenue_by_month.sql
[0m18:17:18.000302 [info ] [MainThread]: 
[0m18:17:18.000613 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=2 TOTAL=4
[0m18:17:18.001231 [debug] [MainThread]: Command `dbt run` failed at 18:17:18.001141 after 8.62 seconds
[0m18:17:18.001624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103086950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103009910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10562ebd0>]}
[0m18:17:18.001977 [debug] [MainThread]: Flushing usage events
[0m18:26:39.622689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087c2850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087cba90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087cbf90>]}


============================== 18:26:39.625612 | cfb27501-36ac-47df-8997-4ec29246301d ==============================
[0m18:26:39.625612 [info ] [MainThread]: Running with dbt=1.6.7
[0m18:26:39.625919 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m18:26:39.858125 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:26:39.858415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'cfb27501-36ac-47df-8997-4ec29246301d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109228190>]}
[0m18:26:39.858651 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:26:39.858828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'cfb27501-36ac-47df-8997-4ec29246301d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10923d310>]}
[0m18:26:39.878475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cfb27501-36ac-47df-8997-4ec29246301d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ac1110>]}
[0m18:26:39.885670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cfb27501-36ac-47df-8997-4ec29246301d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10901fe50>]}
[0m18:26:39.886389 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m18:26:39.900148 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m18:26:39.943542 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:26:39.943991 [debug] [MainThread]: Partial parsing: updated file: acme://models/customer_revenue_by_month.sql
[0m18:26:40.019592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cfb27501-36ac-47df-8997-4ec29246301d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094b2550>]}
[0m18:26:40.028349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cfb27501-36ac-47df-8997-4ec29246301d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10951e550>]}
[0m18:26:40.028598 [info ] [MainThread]: Found 4 models, 1 seed, 21 tests, 0 sources, 0 exposures, 0 metrics, 582 macros, 0 groups, 0 semantic models
[0m18:26:40.028757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cfb27501-36ac-47df-8997-4ec29246301d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10929d450>]}
[0m18:26:40.029702 [info ] [MainThread]: 
[0m18:26:40.030063 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:26:40.030597 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_production-environment-306717'
[0m18:26:40.030770 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:26:41.866429 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_production-environment-306717, now list_production-environment-306717_general_explorations)
[0m18:26:41.867963 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:26:42.314371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cfb27501-36ac-47df-8997-4ec29246301d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10969b910>]}
[0m18:26:42.315545 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:26:42.315938 [info ] [MainThread]: 
[0m18:26:42.319832 [debug] [Thread-1 (]: Began running node model.acme.util_months
[0m18:26:42.320415 [info ] [Thread-1 (]: 1 of 4 START sql view model general_explorations.util_months ................... [RUN]
[0m18:26:42.321142 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_production-environment-306717_general_explorations, now model.acme.util_months)
[0m18:26:42.321487 [debug] [Thread-1 (]: Began compiling node model.acme.util_months
[0m18:26:42.342908 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:26:42.343392 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


        select 

    datetime_diff(
        cast(date_trunc(current_date, month) as datetime),
        cast('2018-01-01' as datetime),
        month
    )


[0m18:26:43.931339 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:9005b912-904c-481a-9f2d-2a50570c8b45&page=queryresults
[0m18:26:45.364969 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.util_months"
[0m18:26:45.367563 [debug] [Thread-1 (]: Timing info for model.acme.util_months (compile): 18:26:42.321723 => 18:26:45.367257
[0m18:26:45.368051 [debug] [Thread-1 (]: Began executing node model.acme.util_months
[0m18:26:45.394941 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.util_months"
[0m18:26:45.395628 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


  create or replace view `production-environment-306717`.`general_explorations`.`util_months`
  OPTIONS()
  as 

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
    
    

    )

    select *
    from unioned
    where generated_number <= 70
    order by generated_number



),

all_periods as (

    select (
        

        datetime_add(
            cast( '2018-01-01' as datetime),
        interval row_number() over (order by 1) - 1 month
        )


    ) as date_month
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_month <= date_trunc(current_date, month)

)

select * from filtered

;


[0m18:26:45.780869 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:1cc2252b-998b-403c-a9f8-31ec55da2d7d&page=queryresults
[0m18:26:46.326925 [debug] [Thread-1 (]: Timing info for model.acme.util_months (execute): 18:26:45.368336 => 18:26:46.326683
[0m18:26:46.327979 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cfb27501-36ac-47df-8997-4ec29246301d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094b5c90>]}
[0m18:26:46.328615 [info ] [Thread-1 (]: 1 of 4 OK created sql view model general_explorations.util_months .............. [[32mCREATE VIEW (0 processed)[0m in 4.01s]
[0m18:26:46.329258 [debug] [Thread-1 (]: Finished running node model.acme.util_months
[0m18:26:46.330014 [debug] [Thread-1 (]: Began running node model.acme.customer_revenue_by_month
[0m18:26:46.330720 [info ] [Thread-1 (]: 2 of 4 START sql view model general_explorations.customer_revenue_by_month ..... [RUN]
[0m18:26:46.331450 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.util_months, now model.acme.customer_revenue_by_month)
[0m18:26:46.331843 [debug] [Thread-1 (]: Began compiling node model.acme.customer_revenue_by_month
[0m18:26:46.335522 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.customer_revenue_by_month"
[0m18:26:46.336387 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (compile): 18:26:46.332069 => 18:26:46.336207
[0m18:26:46.336735 [debug] [Thread-1 (]: Began executing node model.acme.customer_revenue_by_month
[0m18:26:46.344750 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.customer_revenue_by_month"
[0m18:26:46.345514 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:26:46.346006 [debug] [Thread-1 (]: On model.acme.customer_revenue_by_month: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.customer_revenue_by_month"} */


  create or replace view `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`
  OPTIONS()
  as with subscription_periods as (

    select * from `production-environment-306717`.`general_explorations`.`subscription_periods`

),

months as (

    select * from `production-environment-306717`.`general_explorations`.`util_months`

),

-- determine when a given account had its first and last (or most recent) month
customers as (

    select
        customer_id,
        date_trunc(min(start_date), month) as date_month_start,
        date_trunc(max(end_date), month) as date_month_end

    from subscription_periods

    group by 1

),

-- create one record per month between a customer's first and last month
-- (example of a date spine)
customer_months as (

    select
        customers.customer_id,
        months.date_month

    from customers

    inner join months
        -- all months after start date
        on  months.date_month >= customers.date_month_start
        -- and before end date
        and months.date_month < customers.date_month_end

),

-- join the account-month spine to MRR base model, pulling through most recent dates
-- and plan info for month rows that have no invoices (i.e. churns)
joined as (

    select
        customer_months.date_month,
        customer_months.customer_id,
        coalesce(subscription_periods.monthly_amount, 0) as mrr

    from customer_months

    left join subscription_periods
        on customer_months.customer_id = subscription_periods.customer_id
        -- month is after a subscription start date
        and customer_months.date_month >= subscription_periods.start_date
        -- month is before a subscription end date (and handle null case)
        and (customer_months.date_month < subscription_periods.end_date
                or subscription_periods.end_date is null)

),

final as (

    select
        date_month,
        customer_id,
        mrr,
        case when mrr > 0 then true else false end as is_active,

        -- calculate first and last months
        min(case when mrr > 0 then date_month end) over (
            partition by customer_id
        ) as first_active_month,

        max(case when mrr > 0 then date_month end) over (
            partition by customer_id
        ) as last_active_month,

        -- calculate if this record is the first or last month
        first_active_month = date_month as is_first_month,
        last_active_month = date_month as is_last_month

    from joined

)

select * from final;


[0m18:26:46.848491 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:b6797119-bb9a-49c6-96a9-7ea2426e0181&page=queryresults
[0m18:26:47.469222 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: first_active_month at [89:9]')
[0m18:26:48.537408 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:3c14f696-918d-45eb-a268-02e410eae6cc&page=queryresults
[0m18:26:49.152911 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:3c14f696-918d-45eb-a268-02e410eae6cc&page=queryresults
[0m18:26:49.155541 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (execute): 18:26:46.336951 => 18:26:49.154851
[0m18:26:49.185362 [debug] [Thread-1 (]: Database Error in model customer_revenue_by_month (models/customer_revenue_by_month.sql)
  Unrecognized name: first_active_month at [89:9]
  compiled Code at target/run/acme/models/customer_revenue_by_month.sql
[0m18:26:49.186260 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cfb27501-36ac-47df-8997-4ec29246301d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094f9290>]}
[0m18:26:49.187112 [error] [Thread-1 (]: 2 of 4 ERROR creating sql view model general_explorations.customer_revenue_by_month  [[31mERROR[0m in 2.85s]
[0m18:26:49.187869 [debug] [Thread-1 (]: Finished running node model.acme.customer_revenue_by_month
[0m18:26:49.188962 [debug] [Thread-1 (]: Began running node model.acme.customer_churn_month
[0m18:26:49.189718 [info ] [Thread-1 (]: 3 of 4 SKIP relation general_explorations.customer_churn_month ................. [[33mSKIP[0m]
[0m18:26:49.190307 [debug] [Thread-1 (]: Finished running node model.acme.customer_churn_month
[0m18:26:49.191180 [debug] [Thread-1 (]: Began running node model.acme.mrr
[0m18:26:49.191841 [info ] [Thread-1 (]: 4 of 4 SKIP relation general_explorations.mrr .................................. [[33mSKIP[0m]
[0m18:26:49.192319 [debug] [Thread-1 (]: Finished running node model.acme.mrr
[0m18:26:49.194087 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:26:49.194415 [debug] [MainThread]: Connection 'model.acme.customer_revenue_by_month' was properly closed.
[0m18:26:49.194761 [info ] [MainThread]: 
[0m18:26:49.195103 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 9.16 seconds (9.16s).
[0m18:26:49.195940 [debug] [MainThread]: Command end result
[0m18:26:49.209015 [info ] [MainThread]: 
[0m18:26:49.209427 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:26:49.209662 [info ] [MainThread]: 
[0m18:26:49.209895 [error] [MainThread]:   Database Error in model customer_revenue_by_month (models/customer_revenue_by_month.sql)
  Unrecognized name: first_active_month at [89:9]
  compiled Code at target/run/acme/models/customer_revenue_by_month.sql
[0m18:26:49.210122 [info ] [MainThread]: 
[0m18:26:49.210377 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=2 TOTAL=4
[0m18:26:49.210940 [debug] [MainThread]: Command `dbt run` failed at 18:26:49.210863 after 9.61 seconds
[0m18:26:49.211274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104356950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107709ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042d9910>]}
[0m18:26:49.211564 [debug] [MainThread]: Flushing usage events
[0m18:31:32.712809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c746d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092e3450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092ec250>]}


============================== 18:31:32.715779 | f71ad548-23c0-4296-9431-0a7bc40ec29c ==============================
[0m18:31:32.715779 [info ] [MainThread]: Running with dbt=1.6.7
[0m18:31:32.716102 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'profiles_dir': '/Users/olaisaac/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:31:32.951659 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:31:32.952270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'f71ad548-23c0-4296-9431-0a7bc40ec29c', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d6fdd0>]}
[0m18:31:32.952539 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:31:32.957351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'f71ad548-23c0-4296-9431-0a7bc40ec29c', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d77490>]}
[0m18:31:32.987703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f71ad548-23c0-4296-9431-0a7bc40ec29c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d6f990>]}
[0m18:31:32.994520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f71ad548-23c0-4296-9431-0a7bc40ec29c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d6f990>]}
[0m18:31:32.994993 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m18:31:33.008582 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m18:31:33.052909 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:31:33.053378 [debug] [MainThread]: Partial parsing: updated file: acme://models/customer_revenue_by_month.sql
[0m18:31:33.129235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f71ad548-23c0-4296-9431-0a7bc40ec29c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d3cb50>]}
[0m18:31:33.137400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f71ad548-23c0-4296-9431-0a7bc40ec29c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fbf290>]}
[0m18:31:33.137651 [info ] [MainThread]: Found 4 models, 1 seed, 21 tests, 0 sources, 0 exposures, 0 metrics, 582 macros, 0 groups, 0 semantic models
[0m18:31:33.137813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f71ad548-23c0-4296-9431-0a7bc40ec29c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d05450>]}
[0m18:31:33.138735 [info ] [MainThread]: 
[0m18:31:33.139089 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:31:33.139664 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_production-environment-306717'
[0m18:31:33.139841 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:31:34.661085 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_production-environment-306717, now list_production-environment-306717_general_explorations)
[0m18:31:34.662412 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:31:35.073723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f71ad548-23c0-4296-9431-0a7bc40ec29c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095dcc10>]}
[0m18:31:35.074929 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:31:35.075311 [info ] [MainThread]: 
[0m18:31:35.078869 [debug] [Thread-1 (]: Began running node model.acme.util_months
[0m18:31:35.079359 [info ] [Thread-1 (]: 1 of 4 START sql view model general_explorations.util_months ................... [RUN]
[0m18:31:35.080102 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_production-environment-306717_general_explorations, now model.acme.util_months)
[0m18:31:35.080434 [debug] [Thread-1 (]: Began compiling node model.acme.util_months
[0m18:31:35.101805 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:31:35.102288 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


        select 

    datetime_diff(
        cast(date_trunc(current_date, month) as datetime),
        cast('2018-01-01' as datetime),
        month
    )


[0m18:31:35.658649 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:2683c6e3-6a4a-4fd5-a642-03335fae7e94&page=queryresults
[0m18:31:36.596274 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.util_months"
[0m18:31:36.600233 [debug] [Thread-1 (]: Timing info for model.acme.util_months (compile): 18:31:35.080667 => 18:31:36.599915
[0m18:31:36.600686 [debug] [Thread-1 (]: Began executing node model.acme.util_months
[0m18:31:36.624900 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.util_months"
[0m18:31:36.625572 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


  create or replace view `production-environment-306717`.`general_explorations`.`util_months`
  OPTIONS()
  as 

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
    
    

    )

    select *
    from unioned
    where generated_number <= 70
    order by generated_number



),

all_periods as (

    select (
        

        datetime_add(
            cast( '2018-01-01' as datetime),
        interval row_number() over (order by 1) - 1 month
        )


    ) as date_month
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_month <= date_trunc(current_date, month)

)

select * from filtered

;


[0m18:31:37.001210 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:c54a423f-d335-4c39-a867-46283eda315d&page=queryresults
[0m18:31:37.642975 [debug] [Thread-1 (]: Timing info for model.acme.util_months (execute): 18:31:36.600930 => 18:31:37.642748
[0m18:31:37.643954 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f71ad548-23c0-4296-9431-0a7bc40ec29c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fd5bd0>]}
[0m18:31:37.644618 [info ] [Thread-1 (]: 1 of 4 OK created sql view model general_explorations.util_months .............. [[32mCREATE VIEW (0 processed)[0m in 2.56s]
[0m18:31:37.645266 [debug] [Thread-1 (]: Finished running node model.acme.util_months
[0m18:31:37.645960 [debug] [Thread-1 (]: Began running node model.acme.customer_revenue_by_month
[0m18:31:37.646601 [info ] [Thread-1 (]: 2 of 4 START sql view model general_explorations.customer_revenue_by_month ..... [RUN]
[0m18:31:37.647331 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.util_months, now model.acme.customer_revenue_by_month)
[0m18:31:37.647706 [debug] [Thread-1 (]: Began compiling node model.acme.customer_revenue_by_month
[0m18:31:37.651505 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.customer_revenue_by_month"
[0m18:31:37.652387 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (compile): 18:31:37.647960 => 18:31:37.652214
[0m18:31:37.652715 [debug] [Thread-1 (]: Began executing node model.acme.customer_revenue_by_month
[0m18:31:37.660789 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.customer_revenue_by_month"
[0m18:31:37.661541 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:31:37.662019 [debug] [Thread-1 (]: On model.acme.customer_revenue_by_month: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.customer_revenue_by_month"} */


  create or replace view `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`
  OPTIONS()
  as with subscription_periods as (

    select * from `production-environment-306717`.`general_explorations`.`subscription_periods`

),

months as (

    select * from `production-environment-306717`.`general_explorations`.`util_months`

),

-- determine when a given account had its first and last (or most recent) month
customers as (

    select
        customer_id,
        date_trunc(min(start_date), month) as date_month_start,
        date_trunc(max(end_date), month) as date_month_end

    from subscription_periods

    group by 1

),

-- create one record per month between a customer's first and last month
-- (example of a date spine)
customer_months as (

    select
        customers.customer_id,
        months.date_month

    from customers

    inner join months
        -- all months after start date
        on  months.date_month >= customers.date_month_start
        -- and before end date
        and months.date_month < customers.date_month_end

),

-- join the account-month spine to MRR base model, pulling through most recent dates
-- and plan info for month rows that have no invoices (i.e. churns)
joined as (

    select
        customer_months.date_month,
        customer_months.customer_id,
        coalesce(subscription_periods.monthly_amount, 0) as mrr

    from customer_months

    left join subscription_periods
        on customer_months.customer_id = subscription_periods.customer_id
        -- month is after a subscription start date
        and customer_months.date_month >= subscription_periods.start_date
        -- month is before a subscription end date (and handle null case)
        and (customer_months.date_month < subscription_periods.end_date
                or subscription_periods.end_date is null)

),

final as (
    select *,
    case when first_active_month = date_month then true else false end as is_first_month,
    case when last_active_month = date_month then true else false end as is_last_month,

    from(
        select
            date_month,
            customer_id,
            mrr,
            case when mrr > 0 then true else false end as is_active,

            -- calculate first and last months
            min(case when mrr > 0 then date_month end) over (
                partition by customer_id
            ) as first_active_month,

            max(case when mrr > 0 then date_month end) over (
                partition by customer_id
            ) as last_active_month
    )

    from joined

)

select * from final;


[0m18:31:38.130128 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:4032d826-e3ee-4020-85fb-c2d0aaa968a9&page=queryresults
[0m18:31:38.132659 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword FROM at [93:5]')
[0m18:31:39.096500 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:e240fa89-6b8e-4017-9c8d-f4ff9ab3f648&page=queryresults
[0m18:31:39.100010 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:e240fa89-6b8e-4017-9c8d-f4ff9ab3f648&page=queryresults
[0m18:31:39.101295 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (execute): 18:31:37.652932 => 18:31:39.100839
[0m18:31:39.118656 [debug] [Thread-1 (]: Database Error in model customer_revenue_by_month (models/customer_revenue_by_month.sql)
  Syntax error: Expected ")" but got keyword FROM at [93:5]
  compiled Code at target/run/acme/models/customer_revenue_by_month.sql
[0m18:31:39.119400 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f71ad548-23c0-4296-9431-0a7bc40ec29c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3139d0>]}
[0m18:31:39.120094 [error] [Thread-1 (]: 2 of 4 ERROR creating sql view model general_explorations.customer_revenue_by_month  [[31mERROR[0m in 1.47s]
[0m18:31:39.120771 [debug] [Thread-1 (]: Finished running node model.acme.customer_revenue_by_month
[0m18:31:39.121663 [debug] [Thread-1 (]: Began running node model.acme.customer_churn_month
[0m18:31:39.122287 [info ] [Thread-1 (]: 3 of 4 SKIP relation general_explorations.customer_churn_month ................. [[33mSKIP[0m]
[0m18:31:39.122750 [debug] [Thread-1 (]: Finished running node model.acme.customer_churn_month
[0m18:31:39.123396 [debug] [Thread-1 (]: Began running node model.acme.mrr
[0m18:31:39.123924 [info ] [Thread-1 (]: 4 of 4 SKIP relation general_explorations.mrr .................................. [[33mSKIP[0m]
[0m18:31:39.124406 [debug] [Thread-1 (]: Finished running node model.acme.mrr
[0m18:31:39.126118 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:31:39.126440 [debug] [MainThread]: Connection 'model.acme.customer_revenue_by_month' was properly closed.
[0m18:31:39.126772 [info ] [MainThread]: 
[0m18:31:39.127070 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 5.99 seconds (5.99s).
[0m18:31:39.127792 [debug] [MainThread]: Command end result
[0m18:31:39.139996 [info ] [MainThread]: 
[0m18:31:39.140501 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:31:39.140734 [info ] [MainThread]: 
[0m18:31:39.140967 [error] [MainThread]:   Database Error in model customer_revenue_by_month (models/customer_revenue_by_month.sql)
  Syntax error: Expected ")" but got keyword FROM at [93:5]
  compiled Code at target/run/acme/models/customer_revenue_by_month.sql
[0m18:31:39.141199 [info ] [MainThread]: 
[0m18:31:39.141439 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=2 TOTAL=4
[0m18:31:39.141945 [debug] [MainThread]: Command `dbt run` failed at 18:31:39.141872 after 6.45 seconds
[0m18:31:39.142267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092f8c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e76950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092e1d90>]}
[0m18:31:39.142559 [debug] [MainThread]: Flushing usage events
[0m18:32:09.502731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d3e850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d54b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d55210>]}


============================== 18:32:09.505929 | 33350c33-a736-4c7d-b60b-6c89752a530c ==============================
[0m18:32:09.505929 [info ] [MainThread]: Running with dbt=1.6.7
[0m18:32:09.506268 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'profiles_dir': '/Users/olaisaac/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m18:32:09.709202 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:32:09.709495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '33350c33-a736-4c7d-b60b-6c89752a530c', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057cb490>]}
[0m18:32:09.709729 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:32:09.709906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '33350c33-a736-4c7d-b60b-6c89752a530c', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d41950>]}
[0m18:32:09.723471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '33350c33-a736-4c7d-b60b-6c89752a530c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103643010>]}
[0m18:32:09.730333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '33350c33-a736-4c7d-b60b-6c89752a530c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10579a110>]}
[0m18:32:09.731184 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m18:32:09.743693 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m18:32:09.784580 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:32:09.785007 [debug] [MainThread]: Partial parsing: updated file: acme://models/customer_revenue_by_month.sql
[0m18:32:09.860767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '33350c33-a736-4c7d-b60b-6c89752a530c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b26fd0>]}
[0m18:32:09.869255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '33350c33-a736-4c7d-b60b-6c89752a530c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105aeff90>]}
[0m18:32:09.869559 [info ] [MainThread]: Found 4 models, 1 seed, 21 tests, 0 sources, 0 exposures, 0 metrics, 582 macros, 0 groups, 0 semantic models
[0m18:32:09.869735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '33350c33-a736-4c7d-b60b-6c89752a530c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b7fb90>]}
[0m18:32:09.870764 [info ] [MainThread]: 
[0m18:32:09.871175 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:32:09.871785 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_production-environment-306717'
[0m18:32:09.872008 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:32:11.052305 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_production-environment-306717, now list_production-environment-306717_general_explorations)
[0m18:32:11.053475 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:32:11.504430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '33350c33-a736-4c7d-b60b-6c89752a530c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d1e990>]}
[0m18:32:11.505617 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:32:11.506018 [info ] [MainThread]: 
[0m18:32:11.508901 [debug] [Thread-1 (]: Began running node model.acme.util_months
[0m18:32:11.509410 [info ] [Thread-1 (]: 1 of 4 START sql view model general_explorations.util_months ................... [RUN]
[0m18:32:11.510145 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_production-environment-306717_general_explorations, now model.acme.util_months)
[0m18:32:11.510501 [debug] [Thread-1 (]: Began compiling node model.acme.util_months
[0m18:32:11.532515 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:32:11.532996 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


        select 

    datetime_diff(
        cast(date_trunc(current_date, month) as datetime),
        cast('2018-01-01' as datetime),
        month
    )


[0m18:32:12.110884 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:02e5d128-266f-473f-bc8c-656e301306e0&page=queryresults
[0m18:32:13.118966 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.util_months"
[0m18:32:13.121759 [debug] [Thread-1 (]: Timing info for model.acme.util_months (compile): 18:32:11.510738 => 18:32:13.121503
[0m18:32:13.122229 [debug] [Thread-1 (]: Began executing node model.acme.util_months
[0m18:32:13.148709 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.util_months"
[0m18:32:13.149487 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


  create or replace view `production-environment-306717`.`general_explorations`.`util_months`
  OPTIONS()
  as 

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
    
    

    )

    select *
    from unioned
    where generated_number <= 70
    order by generated_number



),

all_periods as (

    select (
        

        datetime_add(
            cast( '2018-01-01' as datetime),
        interval row_number() over (order by 1) - 1 month
        )


    ) as date_month
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_month <= date_trunc(current_date, month)

)

select * from filtered

;


[0m18:32:13.486957 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:11f928b8-4a73-4a16-9948-2f72b957759b&page=queryresults
[0m18:32:14.203673 [debug] [Thread-1 (]: Timing info for model.acme.util_months (execute): 18:32:13.122522 => 18:32:14.203436
[0m18:32:14.204717 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33350c33-a736-4c7d-b60b-6c89752a530c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bde7d0>]}
[0m18:32:14.205380 [info ] [Thread-1 (]: 1 of 4 OK created sql view model general_explorations.util_months .............. [[32mCREATE VIEW (0 processed)[0m in 2.69s]
[0m18:32:14.206027 [debug] [Thread-1 (]: Finished running node model.acme.util_months
[0m18:32:14.206767 [debug] [Thread-1 (]: Began running node model.acme.customer_revenue_by_month
[0m18:32:14.207423 [info ] [Thread-1 (]: 2 of 4 START sql view model general_explorations.customer_revenue_by_month ..... [RUN]
[0m18:32:14.208161 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.util_months, now model.acme.customer_revenue_by_month)
[0m18:32:14.208515 [debug] [Thread-1 (]: Began compiling node model.acme.customer_revenue_by_month
[0m18:32:14.212294 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.customer_revenue_by_month"
[0m18:32:14.213962 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (compile): 18:32:14.208736 => 18:32:14.213751
[0m18:32:14.214328 [debug] [Thread-1 (]: Began executing node model.acme.customer_revenue_by_month
[0m18:32:14.222083 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.customer_revenue_by_month"
[0m18:32:14.222858 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:32:14.223331 [debug] [Thread-1 (]: On model.acme.customer_revenue_by_month: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.customer_revenue_by_month"} */


  create or replace view `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`
  OPTIONS()
  as with subscription_periods as (

    select * from `production-environment-306717`.`general_explorations`.`subscription_periods`

),

months as (

    select * from `production-environment-306717`.`general_explorations`.`util_months`

),

-- determine when a given account had its first and last (or most recent) month
customers as (

    select
        customer_id,
        date_trunc(min(start_date), month) as date_month_start,
        date_trunc(max(end_date), month) as date_month_end

    from subscription_periods

    group by 1

),

-- create one record per month between a customer's first and last month
-- (example of a date spine)
customer_months as (

    select
        customers.customer_id,
        months.date_month

    from customers

    inner join months
        -- all months after start date
        on  months.date_month >= customers.date_month_start
        -- and before end date
        and months.date_month < customers.date_month_end

),

-- join the account-month spine to MRR base model, pulling through most recent dates
-- and plan info for month rows that have no invoices (i.e. churns)
joined as (

    select
        customer_months.date_month,
        customer_months.customer_id,
        coalesce(subscription_periods.monthly_amount, 0) as mrr

    from customer_months

    left join subscription_periods
        on customer_months.customer_id = subscription_periods.customer_id
        -- month is after a subscription start date
        and customer_months.date_month >= subscription_periods.start_date
        -- month is before a subscription end date (and handle null case)
        and (customer_months.date_month < subscription_periods.end_date
                or subscription_periods.end_date is null)

),

final as (
    select *,
    case when first_active_month = date_month then true else false end as is_first_month,
    case when last_active_month = date_month then true else false end as is_last_month,

    from(
        select
            date_month,
            customer_id,
            mrr,
            case when mrr > 0 then true else false end as is_active,

            -- calculate first and last months
            min(case when mrr > 0 then date_month end) over (
                partition by customer_id
            ) as first_active_month,

            max(case when mrr > 0 then date_month end) over (
                partition by customer_id
            ) as last_active_month
        from joined
    )
)

select * from final;


[0m18:32:14.785761 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:f69f5cef-316a-4898-9525-b25f143839df&page=queryresults
[0m18:32:15.511057 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (execute): 18:32:14.214562 => 18:32:15.510753
[0m18:32:15.512291 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33350c33-a736-4c7d-b60b-6c89752a530c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d8fd90>]}
[0m18:32:15.513063 [info ] [Thread-1 (]: 2 of 4 OK created sql view model general_explorations.customer_revenue_by_month  [[32mCREATE VIEW (0 processed)[0m in 1.30s]
[0m18:32:15.513885 [debug] [Thread-1 (]: Finished running node model.acme.customer_revenue_by_month
[0m18:32:15.515268 [debug] [Thread-1 (]: Began running node model.acme.customer_churn_month
[0m18:32:15.516261 [info ] [Thread-1 (]: 3 of 4 START sql view model general_explorations.customer_churn_month .......... [RUN]
[0m18:32:15.517320 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.customer_revenue_by_month, now model.acme.customer_churn_month)
[0m18:32:15.517865 [debug] [Thread-1 (]: Began compiling node model.acme.customer_churn_month
[0m18:32:15.524019 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.customer_churn_month"
[0m18:32:15.526348 [debug] [Thread-1 (]: Timing info for model.acme.customer_churn_month (compile): 18:32:15.518208 => 18:32:15.525787
[0m18:32:15.526936 [debug] [Thread-1 (]: Began executing node model.acme.customer_churn_month
[0m18:32:15.531334 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.customer_churn_month"
[0m18:32:15.532059 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:32:15.532495 [debug] [Thread-1 (]: On model.acme.customer_churn_month: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.customer_churn_month"} */


  create or replace view `production-environment-306717`.`general_explorations`.`customer_churn_month`
  OPTIONS()
  as with mrr as (

    select * from `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`

),

-- row for month *after* last month of activity
joined as (

    select
        date_add(date_month, interval 1 month) as date_month,
        customer_id,
        0 as mrr,
        false as is_active,
        first_active_month,
        last_active_month,
        false as is_first_month,
        false as is_last_month

    from mrr

    where is_last_month = true

)

select * from joined;


[0m18:32:16.265120 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:b203dd8c-a4b9-41a6-b88f-dfd8d30fc65c&page=queryresults
[0m18:32:16.815674 [debug] [Thread-1 (]: Timing info for model.acme.customer_churn_month (execute): 18:32:15.527211 => 18:32:16.815299
[0m18:32:16.817862 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33350c33-a736-4c7d-b60b-6c89752a530c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d8fc50>]}
[0m18:32:16.819113 [info ] [Thread-1 (]: 3 of 4 OK created sql view model general_explorations.customer_churn_month ..... [[32mCREATE VIEW (0 processed)[0m in 1.30s]
[0m18:32:16.819945 [debug] [Thread-1 (]: Finished running node model.acme.customer_churn_month
[0m18:32:16.820990 [debug] [Thread-1 (]: Began running node model.acme.mrr
[0m18:32:16.821712 [info ] [Thread-1 (]: 4 of 4 START sql view model general_explorations.mrr ........................... [RUN]
[0m18:32:16.822644 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.customer_churn_month, now model.acme.mrr)
[0m18:32:16.823084 [debug] [Thread-1 (]: Began compiling node model.acme.mrr
[0m18:32:16.837866 [warn ] [Thread-1 (]: 
Warning: the `surrogate_key` macro now takes a single list argument instead of multiple string arguments. Support for multiple string arguments will be deprecated in a future release of dbt-utils. The acme.mrr model triggered this warning. 
[0m18:32:16.846056 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.mrr"
[0m18:32:16.846918 [debug] [Thread-1 (]: Timing info for model.acme.mrr (compile): 18:32:16.823394 => 18:32:16.846732
[0m18:32:16.847272 [debug] [Thread-1 (]: Began executing node model.acme.mrr
[0m18:32:16.850929 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.mrr"
[0m18:32:16.851530 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:32:16.851961 [debug] [Thread-1 (]: On model.acme.mrr: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.mrr"} */


  create or replace view `production-environment-306717`.`general_explorations`.`mrr`
  OPTIONS()
  as with unioned as (

    select * from `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`

    union all

    select * from `production-environment-306717`.`general_explorations`.`customer_churn_month`

),

-- get prior month MRR and calculate MRR change
mrr_with_changes as (

    select
        *,

        coalesce(
            lag(is_active) over (partition by customer_id order by date_month),
            false
        ) as previous_month_is_active,

        coalesce(
            lag(mrr) over (partition by customer_id order by date_month),
            0
        ) as previous_month_mrr,

        mrr - previous_month_mrr as mrr_change

    from unioned

),

-- classify months as new, churn, reactivation, upgrade, downgrade (or null)
-- also add an ID column
final as (

    select
        to_hex(md5(cast(coalesce(cast(date_month as 
    string
), '') || '-' || coalesce(cast(customer_id as 
    string
), '') as 
    string
))) as id,

        *,

        case
            when is_first_month
                then 'new'
            when not(is_active) and previous_month_is_active
                then 'churn'
            when is_active and not(previous_month_is_active)
                then 'reactivation'
            when mrr_change > 0 then 'upgrade'
            when mrr_change < 0 then 'downgrade'
        end as change_category,

        least(mrr, previous_month_mrr) as renewal_amount

    from mrr_with_changes

)

select * from final;


[0m18:32:17.428343 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:f224de0b-3a8a-4678-b4ef-b4977f0f8d96&page=queryresults
[0m18:32:17.985087 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: previous_month_mrr at [32:15]')
[0m18:32:19.094075 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:e51ec43b-8af9-4a9c-a489-3b48d10168f7&page=queryresults
[0m18:32:19.708366 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:e51ec43b-8af9-4a9c-a489-3b48d10168f7&page=queryresults
[0m18:32:19.710499 [debug] [Thread-1 (]: Timing info for model.acme.mrr (execute): 18:32:16.847497 => 18:32:19.709554
[0m18:32:19.729773 [debug] [Thread-1 (]: Database Error in model mrr (models/mrr.sql)
  Unrecognized name: previous_month_mrr at [32:15]
  compiled Code at target/run/acme/models/mrr.sql
[0m18:32:19.730441 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33350c33-a736-4c7d-b60b-6c89752a530c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105da1450>]}
[0m18:32:19.731096 [error] [Thread-1 (]: 4 of 4 ERROR creating sql view model general_explorations.mrr .................. [[31mERROR[0m in 2.91s]
[0m18:32:19.731721 [debug] [Thread-1 (]: Finished running node model.acme.mrr
[0m18:32:19.733651 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:32:19.734037 [debug] [MainThread]: Connection 'model.acme.mrr' was properly closed.
[0m18:32:19.734477 [info ] [MainThread]: 
[0m18:32:19.734921 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 9.86 seconds (9.86s).
[0m18:32:19.736039 [debug] [MainThread]: Command end result
[0m18:32:19.750708 [info ] [MainThread]: 
[0m18:32:19.751086 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:32:19.751317 [info ] [MainThread]: 
[0m18:32:19.751533 [error] [MainThread]:   Database Error in model mrr (models/mrr.sql)
  Unrecognized name: previous_month_mrr at [32:15]
  compiled Code at target/run/acme/models/mrr.sql
[0m18:32:19.751766 [info ] [MainThread]: 
[0m18:32:19.752015 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m18:32:19.752529 [debug] [MainThread]: Command `dbt run` failed at 18:32:19.752456 after 10.27 seconds
[0m18:32:19.752854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d57090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100855950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d40ad0>]}
[0m18:32:19.753129 [debug] [MainThread]: Flushing usage events
[0m18:35:05.695950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10598ff90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105997710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105997d90>]}


============================== 18:35:05.698868 | fe100711-b37a-457d-8244-c92bd56656a9 ==============================
[0m18:35:05.698868 [info ] [MainThread]: Running with dbt=1.6.7
[0m18:35:05.699181 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'version_check': 'True', 'profiles_dir': '/Users/olaisaac/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m18:35:05.914453 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:35:05.914749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'fe100711-b37a-457d-8244-c92bd56656a9', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067523d0>]}
[0m18:35:05.914984 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:35:05.915161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'fe100711-b37a-457d-8244-c92bd56656a9', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106732790>]}
[0m18:35:05.934613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fe100711-b37a-457d-8244-c92bd56656a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a83f50>]}
[0m18:35:05.941536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fe100711-b37a-457d-8244-c92bd56656a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1036dfed0>]}
[0m18:35:05.942048 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m18:35:05.956009 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m18:35:05.998255 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:35:05.998706 [debug] [MainThread]: Partial parsing: updated file: acme://models/mrr.sql
[0m18:35:06.044941 [warn ] [MainThread]: 
Warning: the `surrogate_key` macro now takes a single list argument instead of multiple string arguments. Support for multiple string arguments will be deprecated in a future release of dbt-utils. The acme.mrr model triggered this warning. 
[0m18:35:06.096774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fe100711-b37a-457d-8244-c92bd56656a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d66690>]}
[0m18:35:06.106373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fe100711-b37a-457d-8244-c92bd56656a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c14390>]}
[0m18:35:06.106625 [info ] [MainThread]: Found 1 seed, 21 tests, 4 models, 0 sources, 0 exposures, 0 metrics, 582 macros, 0 groups, 0 semantic models
[0m18:35:06.106782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fe100711-b37a-457d-8244-c92bd56656a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d81250>]}
[0m18:35:06.107714 [info ] [MainThread]: 
[0m18:35:06.108070 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:35:06.108597 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_production-environment-306717'
[0m18:35:06.108770 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:35:07.862042 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_production-environment-306717, now list_production-environment-306717_general_explorations)
[0m18:35:07.863321 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:35:08.298189 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fe100711-b37a-457d-8244-c92bd56656a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ae3410>]}
[0m18:35:08.299347 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:35:08.299732 [info ] [MainThread]: 
[0m18:35:08.303587 [debug] [Thread-1 (]: Began running node model.acme.util_months
[0m18:35:08.304204 [info ] [Thread-1 (]: 1 of 4 START sql view model general_explorations.util_months ................... [RUN]
[0m18:35:08.304940 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_production-environment-306717_general_explorations, now model.acme.util_months)
[0m18:35:08.305303 [debug] [Thread-1 (]: Began compiling node model.acme.util_months
[0m18:35:08.328465 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:35:08.328928 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


        select 

    datetime_diff(
        cast(date_trunc(current_date, month) as datetime),
        cast('2018-01-01' as datetime),
        month
    )


[0m18:35:08.870248 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:eaf8919a-9e75-4750-ab28-6ad240e9b2ea&page=queryresults
[0m18:35:10.022438 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.util_months"
[0m18:35:10.025448 [debug] [Thread-1 (]: Timing info for model.acme.util_months (compile): 18:35:08.305542 => 18:35:10.025187
[0m18:35:10.025905 [debug] [Thread-1 (]: Began executing node model.acme.util_months
[0m18:35:10.052529 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.util_months"
[0m18:35:10.053309 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


  create or replace view `production-environment-306717`.`general_explorations`.`util_months`
  OPTIONS()
  as 

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
    
    

    )

    select *
    from unioned
    where generated_number <= 70
    order by generated_number



),

all_periods as (

    select (
        

        datetime_add(
            cast( '2018-01-01' as datetime),
        interval row_number() over (order by 1) - 1 month
        )


    ) as date_month
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_month <= date_trunc(current_date, month)

)

select * from filtered

;


[0m18:35:10.516131 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:a351d720-6aa1-4f5a-b1dc-f86a32e7245c&page=queryresults
[0m18:35:11.254914 [debug] [Thread-1 (]: Timing info for model.acme.util_months (execute): 18:35:10.026172 => 18:35:11.254665
[0m18:35:11.255933 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fe100711-b37a-457d-8244-c92bd56656a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d3b1d0>]}
[0m18:35:11.256635 [info ] [Thread-1 (]: 1 of 4 OK created sql view model general_explorations.util_months .............. [[32mCREATE VIEW (0 processed)[0m in 2.95s]
[0m18:35:11.257289 [debug] [Thread-1 (]: Finished running node model.acme.util_months
[0m18:35:11.258094 [debug] [Thread-1 (]: Began running node model.acme.customer_revenue_by_month
[0m18:35:11.258813 [info ] [Thread-1 (]: 2 of 4 START sql view model general_explorations.customer_revenue_by_month ..... [RUN]
[0m18:35:11.259759 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.util_months, now model.acme.customer_revenue_by_month)
[0m18:35:11.260203 [debug] [Thread-1 (]: Began compiling node model.acme.customer_revenue_by_month
[0m18:35:11.264028 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.customer_revenue_by_month"
[0m18:35:11.265831 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (compile): 18:35:11.260444 => 18:35:11.265646
[0m18:35:11.266194 [debug] [Thread-1 (]: Began executing node model.acme.customer_revenue_by_month
[0m18:35:11.270233 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.customer_revenue_by_month"
[0m18:35:11.271039 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:35:11.271563 [debug] [Thread-1 (]: On model.acme.customer_revenue_by_month: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.customer_revenue_by_month"} */


  create or replace view `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`
  OPTIONS()
  as with subscription_periods as (

    select * from `production-environment-306717`.`general_explorations`.`subscription_periods`

),

months as (

    select * from `production-environment-306717`.`general_explorations`.`util_months`

),

-- determine when a given account had its first and last (or most recent) month
customers as (

    select
        customer_id,
        date_trunc(min(start_date), month) as date_month_start,
        date_trunc(max(end_date), month) as date_month_end

    from subscription_periods

    group by 1

),

-- create one record per month between a customer's first and last month
-- (example of a date spine)
customer_months as (

    select
        customers.customer_id,
        months.date_month

    from customers

    inner join months
        -- all months after start date
        on  months.date_month >= customers.date_month_start
        -- and before end date
        and months.date_month < customers.date_month_end

),

-- join the account-month spine to MRR base model, pulling through most recent dates
-- and plan info for month rows that have no invoices (i.e. churns)
joined as (

    select
        customer_months.date_month,
        customer_months.customer_id,
        coalesce(subscription_periods.monthly_amount, 0) as mrr

    from customer_months

    left join subscription_periods
        on customer_months.customer_id = subscription_periods.customer_id
        -- month is after a subscription start date
        and customer_months.date_month >= subscription_periods.start_date
        -- month is before a subscription end date (and handle null case)
        and (customer_months.date_month < subscription_periods.end_date
                or subscription_periods.end_date is null)

),

final as (
    select *,
    case when first_active_month = date_month then true else false end as is_first_month,
    case when last_active_month = date_month then true else false end as is_last_month,

    from(
        select
            date_month,
            customer_id,
            mrr,
            case when mrr > 0 then true else false end as is_active,

            -- calculate first and last months
            min(case when mrr > 0 then date_month end) over (
                partition by customer_id
            ) as first_active_month,

            max(case when mrr > 0 then date_month end) over (
                partition by customer_id
            ) as last_active_month
        from joined
    )
)

select * from final;


[0m18:35:11.948684 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:0f52e3fa-2134-45a6-a12a-c1292a8cb72a&page=queryresults
[0m18:35:12.568357 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (execute): 18:35:11.266416 => 18:35:12.568006
[0m18:35:12.569924 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fe100711-b37a-457d-8244-c92bd56656a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c48dd0>]}
[0m18:35:12.571254 [info ] [Thread-1 (]: 2 of 4 OK created sql view model general_explorations.customer_revenue_by_month  [[32mCREATE VIEW (0 processed)[0m in 1.31s]
[0m18:35:12.572123 [debug] [Thread-1 (]: Finished running node model.acme.customer_revenue_by_month
[0m18:35:12.573109 [debug] [Thread-1 (]: Began running node model.acme.customer_churn_month
[0m18:35:12.573803 [info ] [Thread-1 (]: 3 of 4 START sql view model general_explorations.customer_churn_month .......... [RUN]
[0m18:35:12.574820 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.customer_revenue_by_month, now model.acme.customer_churn_month)
[0m18:35:12.575342 [debug] [Thread-1 (]: Began compiling node model.acme.customer_churn_month
[0m18:35:12.581173 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.customer_churn_month"
[0m18:35:12.582420 [debug] [Thread-1 (]: Timing info for model.acme.customer_churn_month (compile): 18:35:12.575665 => 18:35:12.582190
[0m18:35:12.582829 [debug] [Thread-1 (]: Began executing node model.acme.customer_churn_month
[0m18:35:12.587555 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.customer_churn_month"
[0m18:35:12.588407 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:35:12.588910 [debug] [Thread-1 (]: On model.acme.customer_churn_month: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.customer_churn_month"} */


  create or replace view `production-environment-306717`.`general_explorations`.`customer_churn_month`
  OPTIONS()
  as with mrr as (

    select * from `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`

),

-- row for month *after* last month of activity
joined as (

    select
        date_add(date_month, interval 1 month) as date_month,
        customer_id,
        0 as mrr,
        false as is_active,
        first_active_month,
        last_active_month,
        false as is_first_month,
        false as is_last_month

    from mrr

    where is_last_month = true

)

select * from joined;


[0m18:35:13.168316 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:3b88fe7c-9065-4d38-8d04-4919ba0ce925&page=queryresults
[0m18:35:13.744685 [debug] [Thread-1 (]: Timing info for model.acme.customer_churn_month (execute): 18:35:12.583088 => 18:35:13.744250
[0m18:35:13.746539 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fe100711-b37a-457d-8244-c92bd56656a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ae9a50>]}
[0m18:35:13.747548 [info ] [Thread-1 (]: 3 of 4 OK created sql view model general_explorations.customer_churn_month ..... [[32mCREATE VIEW (0 processed)[0m in 1.17s]
[0m18:35:13.748313 [debug] [Thread-1 (]: Finished running node model.acme.customer_churn_month
[0m18:35:13.749252 [debug] [Thread-1 (]: Began running node model.acme.mrr
[0m18:35:13.749916 [info ] [Thread-1 (]: 4 of 4 START sql view model general_explorations.mrr ........................... [RUN]
[0m18:35:13.750917 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.customer_churn_month, now model.acme.mrr)
[0m18:35:13.751395 [debug] [Thread-1 (]: Began compiling node model.acme.mrr
[0m18:35:13.758559 [warn ] [Thread-1 (]: 
Warning: the `surrogate_key` macro now takes a single list argument instead of multiple string arguments. Support for multiple string arguments will be deprecated in a future release of dbt-utils. The acme.mrr model triggered this warning. 
[0m18:35:13.760640 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.mrr"
[0m18:35:13.762437 [debug] [Thread-1 (]: Timing info for model.acme.mrr (compile): 18:35:13.751715 => 18:35:13.762185
[0m18:35:13.762871 [debug] [Thread-1 (]: Began executing node model.acme.mrr
[0m18:35:13.770029 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.mrr"
[0m18:35:13.770719 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:35:13.771224 [debug] [Thread-1 (]: On model.acme.mrr: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.mrr"} */


  create or replace view `production-environment-306717`.`general_explorations`.`mrr`
  OPTIONS()
  as with unioned as (

    select * from `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`

    union all

    select * from `production-environment-306717`.`general_explorations`.`customer_churn_month`

),

-- get prior month MRR and calculate MRR change
mrr_with_changes as (

    select
        *,
        mrr - previous_month_mrr as mrr_change
    from(
        select *,
        coalesce(
            lag(is_active) over (partition by customer_id order by date_month),
            false
        ) as previous_month_is_active,

        coalesce(
            lag(mrr) over (partition by customer_id order by date_month),
            0
        ) as previous_month_mrr,

        from unioned
    )

),

-- classify months as new, churn, reactivation, upgrade, downgrade (or null)
-- also add an ID column
final as (

    select
        to_hex(md5(cast(coalesce(cast(date_month as 
    string
), '') || '-' || coalesce(cast(customer_id as 
    string
), '') as 
    string
))) as id,

        *,

        case
            when is_first_month
                then 'new'
            when not(is_active) and previous_month_is_active
                then 'churn'
            when is_active and not(previous_month_is_active)
                then 'reactivation'
            when mrr_change > 0 then 'upgrade'
            when mrr_change < 0 then 'downgrade'
        end as change_category,

        least(mrr, previous_month_mrr) as renewal_amount

    from mrr_with_changes

)

select * from final;


[0m18:35:14.364163 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:91ef1116-8d61-42ab-b700-3af7382f5647&page=queryresults
[0m18:35:15.030157 [debug] [Thread-1 (]: Timing info for model.acme.mrr (execute): 18:35:13.763147 => 18:35:15.029770
[0m18:35:15.031826 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fe100711-b37a-457d-8244-c92bd56656a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e86750>]}
[0m18:35:15.032733 [info ] [Thread-1 (]: 4 of 4 OK created sql view model general_explorations.mrr ...................... [[32mCREATE VIEW (0 processed)[0m in 1.28s]
[0m18:35:15.034271 [debug] [Thread-1 (]: Finished running node model.acme.mrr
[0m18:35:15.036655 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:35:15.037145 [debug] [MainThread]: Connection 'model.acme.mrr' was properly closed.
[0m18:35:15.037589 [info ] [MainThread]: 
[0m18:35:15.038025 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 8.93 seconds (8.93s).
[0m18:35:15.039364 [debug] [MainThread]: Command end result
[0m18:35:15.056983 [info ] [MainThread]: 
[0m18:35:15.057445 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:35:15.057725 [info ] [MainThread]: 
[0m18:35:15.058036 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m18:35:15.058623 [debug] [MainThread]: Command `dbt run` succeeded at 18:35:15.058536 after 9.38 seconds
[0m18:35:15.058988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105997b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100976950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10079f510>]}
[0m18:35:15.059329 [debug] [MainThread]: Flushing usage events
[0m18:40:32.994956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093ea850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109400250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109400950>]}


============================== 18:40:32.998068 | 3380a845-5b1c-404f-9429-fa2a2f5747ec ==============================
[0m18:40:32.998068 [info ] [MainThread]: Running with dbt=1.6.7
[0m18:40:32.998385 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt docs generate', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m18:40:33.211107 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:40:33.211409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '3380a845-5b1c-404f-9429-fa2a2f5747ec', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096d75d0>]}
[0m18:40:33.211652 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:40:33.211829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '3380a845-5b1c-404f-9429-fa2a2f5747ec', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093f7f10>]}
[0m18:40:33.231371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3380a845-5b1c-404f-9429-fa2a2f5747ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0d9890>]}
[0m18:40:33.238314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3380a845-5b1c-404f-9429-fa2a2f5747ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0fcad0>]}
[0m18:40:33.238839 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m18:40:33.253037 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m18:40:33.296290 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:40:33.296505 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:40:33.299885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3380a845-5b1c-404f-9429-fa2a2f5747ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0fcc90>]}
[0m18:40:33.303018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3380a845-5b1c-404f-9429-fa2a2f5747ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a26bdd0>]}
[0m18:40:33.303237 [info ] [MainThread]: Found 1 seed, 21 tests, 4 models, 0 sources, 0 exposures, 0 metrics, 582 macros, 0 groups, 0 semantic models
[0m18:40:33.303399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3380a845-5b1c-404f-9429-fa2a2f5747ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106598d50>]}
[0m18:40:33.304603 [info ] [MainThread]: 
[0m18:40:33.304983 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:40:33.305577 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_production-environment-306717_general_explorations'
[0m18:40:33.305775 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:40:34.819870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3380a845-5b1c-404f-9429-fa2a2f5747ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0fa850>]}
[0m18:40:34.820992 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:40:34.821357 [info ] [MainThread]: 
[0m18:40:34.824869 [debug] [Thread-1 (]: Began running node model.acme.util_months
[0m18:40:34.825550 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_production-environment-306717_general_explorations, now model.acme.util_months)
[0m18:40:34.825892 [debug] [Thread-1 (]: Began compiling node model.acme.util_months
[0m18:40:34.846726 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:40:34.847387 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


        select 

    datetime_diff(
        cast(date_trunc(current_date, month) as datetime),
        cast('2018-01-01' as datetime),
        month
    )


[0m18:40:35.543542 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:e29e4f5b-9183-4482-9912-a5b16e301c92&page=queryresults
[0m18:40:36.615817 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.util_months"
[0m18:40:36.618554 [debug] [Thread-1 (]: Timing info for model.acme.util_months (compile): 18:40:34.826116 => 18:40:36.618312
[0m18:40:36.619000 [debug] [Thread-1 (]: Began executing node model.acme.util_months
[0m18:40:36.619463 [debug] [Thread-1 (]: Timing info for model.acme.util_months (execute): 18:40:36.619265 => 18:40:36.619286
[0m18:40:36.620475 [debug] [Thread-1 (]: Finished running node model.acme.util_months
[0m18:40:36.620930 [debug] [Thread-1 (]: Began running node seed.acme.subscription_periods
[0m18:40:36.621780 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.util_months, now seed.acme.subscription_periods)
[0m18:40:36.622231 [debug] [Thread-1 (]: Began compiling node seed.acme.subscription_periods
[0m18:40:36.624984 [debug] [Thread-1 (]: Timing info for seed.acme.subscription_periods (compile): 18:40:36.622504 => 18:40:36.624772
[0m18:40:36.625390 [debug] [Thread-1 (]: Began executing node seed.acme.subscription_periods
[0m18:40:36.625801 [debug] [Thread-1 (]: Timing info for seed.acme.subscription_periods (execute): 18:40:36.625645 => 18:40:36.625653
[0m18:40:36.626579 [debug] [Thread-1 (]: Finished running node seed.acme.subscription_periods
[0m18:40:36.627346 [debug] [Thread-1 (]: Began running node model.acme.customer_revenue_by_month
[0m18:40:36.627930 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.acme.subscription_periods, now model.acme.customer_revenue_by_month)
[0m18:40:36.628246 [debug] [Thread-1 (]: Began compiling node model.acme.customer_revenue_by_month
[0m18:40:36.631605 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.customer_revenue_by_month"
[0m18:40:36.633792 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (compile): 18:40:36.628456 => 18:40:36.633622
[0m18:40:36.634107 [debug] [Thread-1 (]: Began executing node model.acme.customer_revenue_by_month
[0m18:40:36.634463 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (execute): 18:40:36.634319 => 18:40:36.634326
[0m18:40:36.635214 [debug] [Thread-1 (]: Finished running node model.acme.customer_revenue_by_month
[0m18:40:36.635575 [debug] [Thread-1 (]: Began running node test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670
[0m18:40:36.636099 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.customer_revenue_by_month, now test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670)
[0m18:40:36.636443 [debug] [Thread-1 (]: Began compiling node test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670
[0m18:40:36.646549 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670"
[0m18:40:36.647353 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670 (compile): 18:40:36.636622 => 18:40:36.647213
[0m18:40:36.647612 [debug] [Thread-1 (]: Began executing node test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670
[0m18:40:36.647905 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670 (execute): 18:40:36.647777 => 18:40:36.647784
[0m18:40:36.648506 [debug] [Thread-1 (]: Finished running node test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670
[0m18:40:36.648786 [debug] [Thread-1 (]: Began running node test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd
[0m18:40:36.649237 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670, now test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd)
[0m18:40:36.649482 [debug] [Thread-1 (]: Began compiling node test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd
[0m18:40:36.653117 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd"
[0m18:40:36.653675 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd (compile): 18:40:36.649639 => 18:40:36.653545
[0m18:40:36.653922 [debug] [Thread-1 (]: Began executing node test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd
[0m18:40:36.654200 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd (execute): 18:40:36.654078 => 18:40:36.654082
[0m18:40:36.654778 [debug] [Thread-1 (]: Finished running node test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd
[0m18:40:36.655046 [debug] [Thread-1 (]: Began running node test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa
[0m18:40:36.655486 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd, now test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa)
[0m18:40:36.655710 [debug] [Thread-1 (]: Began compiling node test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa
[0m18:40:36.666306 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa"
[0m18:40:36.666793 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa (compile): 18:40:36.655849 => 18:40:36.666684
[0m18:40:36.667004 [debug] [Thread-1 (]: Began executing node test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa
[0m18:40:36.667231 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa (execute): 18:40:36.667133 => 18:40:36.667138
[0m18:40:36.667709 [debug] [Thread-1 (]: Finished running node test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa
[0m18:40:36.667928 [debug] [Thread-1 (]: Began running node model.acme.customer_churn_month
[0m18:40:36.668285 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa, now model.acme.customer_churn_month)
[0m18:40:36.668472 [debug] [Thread-1 (]: Began compiling node model.acme.customer_churn_month
[0m18:40:36.670226 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.customer_churn_month"
[0m18:40:36.670994 [debug] [Thread-1 (]: Timing info for model.acme.customer_churn_month (compile): 18:40:36.668595 => 18:40:36.670887
[0m18:40:36.671192 [debug] [Thread-1 (]: Began executing node model.acme.customer_churn_month
[0m18:40:36.671394 [debug] [Thread-1 (]: Timing info for model.acme.customer_churn_month (execute): 18:40:36.671310 => 18:40:36.671313
[0m18:40:36.671824 [debug] [Thread-1 (]: Finished running node model.acme.customer_churn_month
[0m18:40:36.672031 [debug] [Thread-1 (]: Began running node test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716
[0m18:40:36.672424 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.customer_churn_month, now test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716)
[0m18:40:36.672599 [debug] [Thread-1 (]: Began compiling node test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716
[0m18:40:36.677808 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716"
[0m18:40:36.678256 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716 (compile): 18:40:36.672716 => 18:40:36.678157
[0m18:40:36.678442 [debug] [Thread-1 (]: Began executing node test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716
[0m18:40:36.678646 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716 (execute): 18:40:36.678559 => 18:40:36.678563
[0m18:40:36.679064 [debug] [Thread-1 (]: Finished running node test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716
[0m18:40:36.679250 [debug] [Thread-1 (]: Began running node model.acme.mrr
[0m18:40:36.679565 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716, now model.acme.mrr)
[0m18:40:36.679725 [debug] [Thread-1 (]: Began compiling node model.acme.mrr
[0m18:40:36.684894 [warn ] [Thread-1 (]: 
Warning: the `surrogate_key` macro now takes a single list argument instead of multiple string arguments. Support for multiple string arguments will be deprecated in a future release of dbt-utils. The acme.mrr model triggered this warning. 
[0m18:40:36.688780 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.mrr"
[0m18:40:36.689369 [debug] [Thread-1 (]: Timing info for model.acme.mrr (compile): 18:40:36.679832 => 18:40:36.689280
[0m18:40:36.689542 [debug] [Thread-1 (]: Began executing node model.acme.mrr
[0m18:40:36.689723 [debug] [Thread-1 (]: Timing info for model.acme.mrr (execute): 18:40:36.689647 => 18:40:36.689651
[0m18:40:36.690119 [debug] [Thread-1 (]: Finished running node model.acme.mrr
[0m18:40:36.690335 [debug] [Thread-1 (]: Began running node test.acme.not_null_customer_churn_month_customer_id.99e28f508c
[0m18:40:36.690788 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.mrr, now test.acme.not_null_customer_churn_month_customer_id.99e28f508c)
[0m18:40:36.690952 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_customer_churn_month_customer_id.99e28f508c
[0m18:40:36.695543 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_customer_churn_month_customer_id.99e28f508c"
[0m18:40:36.696026 [debug] [Thread-1 (]: Timing info for test.acme.not_null_customer_churn_month_customer_id.99e28f508c (compile): 18:40:36.691054 => 18:40:36.695936
[0m18:40:36.696194 [debug] [Thread-1 (]: Began executing node test.acme.not_null_customer_churn_month_customer_id.99e28f508c
[0m18:40:36.696376 [debug] [Thread-1 (]: Timing info for test.acme.not_null_customer_churn_month_customer_id.99e28f508c (execute): 18:40:36.696298 => 18:40:36.696302
[0m18:40:36.696767 [debug] [Thread-1 (]: Finished running node test.acme.not_null_customer_churn_month_customer_id.99e28f508c
[0m18:40:36.696949 [debug] [Thread-1 (]: Began running node test.acme.unique_customer_churn_month_customer_id.a402b7af3f
[0m18:40:36.697255 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_customer_churn_month_customer_id.99e28f508c, now test.acme.unique_customer_churn_month_customer_id.a402b7af3f)
[0m18:40:36.697407 [debug] [Thread-1 (]: Began compiling node test.acme.unique_customer_churn_month_customer_id.a402b7af3f
[0m18:40:36.700420 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.unique_customer_churn_month_customer_id.a402b7af3f"
[0m18:40:36.700772 [debug] [Thread-1 (]: Timing info for test.acme.unique_customer_churn_month_customer_id.a402b7af3f (compile): 18:40:36.697511 => 18:40:36.700689
[0m18:40:36.700933 [debug] [Thread-1 (]: Began executing node test.acme.unique_customer_churn_month_customer_id.a402b7af3f
[0m18:40:36.701108 [debug] [Thread-1 (]: Timing info for test.acme.unique_customer_churn_month_customer_id.a402b7af3f (execute): 18:40:36.701036 => 18:40:36.701038
[0m18:40:36.701463 [debug] [Thread-1 (]: Finished running node test.acme.unique_customer_churn_month_customer_id.a402b7af3f
[0m18:40:36.701633 [debug] [Thread-1 (]: Began running node test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6
[0m18:40:36.701910 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.unique_customer_churn_month_customer_id.a402b7af3f, now test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6)
[0m18:40:36.702058 [debug] [Thread-1 (]: Began compiling node test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6
[0m18:40:36.704403 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6"
[0m18:40:36.704939 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6 (compile): 18:40:36.702158 => 18:40:36.704856
[0m18:40:36.705102 [debug] [Thread-1 (]: Began executing node test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6
[0m18:40:36.705283 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6 (execute): 18:40:36.705207 => 18:40:36.705210
[0m18:40:36.705640 [debug] [Thread-1 (]: Finished running node test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6
[0m18:40:36.705811 [debug] [Thread-1 (]: Began running node test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb
[0m18:40:36.706089 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6, now test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb)
[0m18:40:36.706238 [debug] [Thread-1 (]: Began compiling node test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb
[0m18:40:36.708229 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb"
[0m18:40:36.708566 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb (compile): 18:40:36.706337 => 18:40:36.708481
[0m18:40:36.708731 [debug] [Thread-1 (]: Began executing node test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb
[0m18:40:36.708911 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb (execute): 18:40:36.708835 => 18:40:36.708837
[0m18:40:36.709281 [debug] [Thread-1 (]: Finished running node test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb
[0m18:40:36.709453 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_customer_id.adf44c0fb5
[0m18:40:36.709745 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb, now test.acme.not_null_mrr_customer_id.adf44c0fb5)
[0m18:40:36.709893 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_customer_id.adf44c0fb5
[0m18:40:36.712898 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_customer_id.adf44c0fb5"
[0m18:40:36.713537 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_customer_id.adf44c0fb5 (compile): 18:40:36.709990 => 18:40:36.713436
[0m18:40:36.713715 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_customer_id.adf44c0fb5
[0m18:40:36.713888 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_customer_id.adf44c0fb5 (execute): 18:40:36.713815 => 18:40:36.713823
[0m18:40:36.714309 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_customer_id.adf44c0fb5
[0m18:40:36.714496 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_date_month.d7121d9ce6
[0m18:40:36.714809 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_customer_id.adf44c0fb5, now test.acme.not_null_mrr_date_month.d7121d9ce6)
[0m18:40:36.714953 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_date_month.d7121d9ce6
[0m18:40:36.716939 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_date_month.d7121d9ce6"
[0m18:40:36.717242 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_date_month.d7121d9ce6 (compile): 18:40:36.715044 => 18:40:36.717163
[0m18:40:36.717388 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_date_month.d7121d9ce6
[0m18:40:36.717548 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_date_month.d7121d9ce6 (execute): 18:40:36.717483 => 18:40:36.717485
[0m18:40:36.717887 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_date_month.d7121d9ce6
[0m18:40:36.718045 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_first_active_month.a9078832e9
[0m18:40:36.718315 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_date_month.d7121d9ce6, now test.acme.not_null_mrr_first_active_month.a9078832e9)
[0m18:40:36.718455 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_first_active_month.a9078832e9
[0m18:40:36.720350 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_first_active_month.a9078832e9"
[0m18:40:36.720645 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_first_active_month.a9078832e9 (compile): 18:40:36.718546 => 18:40:36.720568
[0m18:40:36.720794 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_first_active_month.a9078832e9
[0m18:40:36.720963 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_first_active_month.a9078832e9 (execute): 18:40:36.720894 => 18:40:36.720896
[0m18:40:36.721311 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_first_active_month.a9078832e9
[0m18:40:36.721470 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_id.45914052fb
[0m18:40:36.721736 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_first_active_month.a9078832e9, now test.acme.not_null_mrr_id.45914052fb)
[0m18:40:36.721874 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_id.45914052fb
[0m18:40:36.723686 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_id.45914052fb"
[0m18:40:36.723992 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_id.45914052fb (compile): 18:40:36.721963 => 18:40:36.723914
[0m18:40:36.724152 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_id.45914052fb
[0m18:40:36.724323 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_id.45914052fb (execute): 18:40:36.724258 => 18:40:36.724260
[0m18:40:36.724672 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_id.45914052fb
[0m18:40:36.724831 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_is_active.66e2203f7d
[0m18:40:36.725100 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_id.45914052fb, now test.acme.not_null_mrr_is_active.66e2203f7d)
[0m18:40:36.725241 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_is_active.66e2203f7d
[0m18:40:36.727109 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_is_active.66e2203f7d"
[0m18:40:36.727424 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_is_active.66e2203f7d (compile): 18:40:36.725338 => 18:40:36.727347
[0m18:40:36.727569 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_is_active.66e2203f7d
[0m18:40:36.727736 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_is_active.66e2203f7d (execute): 18:40:36.727667 => 18:40:36.727669
[0m18:40:36.728079 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_is_active.66e2203f7d
[0m18:40:36.728240 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_is_first_month.97ecc2049e
[0m18:40:36.728505 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_is_active.66e2203f7d, now test.acme.not_null_mrr_is_first_month.97ecc2049e)
[0m18:40:36.728645 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_is_first_month.97ecc2049e
[0m18:40:36.730604 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_is_first_month.97ecc2049e"
[0m18:40:36.730918 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_is_first_month.97ecc2049e (compile): 18:40:36.728737 => 18:40:36.730841
[0m18:40:36.731065 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_is_first_month.97ecc2049e
[0m18:40:36.731234 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_is_first_month.97ecc2049e (execute): 18:40:36.731165 => 18:40:36.731167
[0m18:40:36.731574 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_is_first_month.97ecc2049e
[0m18:40:36.731734 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_is_last_month.a91990c0de
[0m18:40:36.732001 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_is_first_month.97ecc2049e, now test.acme.not_null_mrr_is_last_month.a91990c0de)
[0m18:40:36.732143 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_is_last_month.a91990c0de
[0m18:40:36.733963 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_is_last_month.a91990c0de"
[0m18:40:36.734256 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_is_last_month.a91990c0de (compile): 18:40:36.732240 => 18:40:36.734178
[0m18:40:36.734404 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_is_last_month.a91990c0de
[0m18:40:36.734573 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_is_last_month.a91990c0de (execute): 18:40:36.734503 => 18:40:36.734505
[0m18:40:36.734921 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_is_last_month.a91990c0de
[0m18:40:36.735079 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_last_active_month.c5f2565121
[0m18:40:36.735358 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_is_last_month.a91990c0de, now test.acme.not_null_mrr_last_active_month.c5f2565121)
[0m18:40:36.735505 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_last_active_month.c5f2565121
[0m18:40:36.737375 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_last_active_month.c5f2565121"
[0m18:40:36.737908 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_last_active_month.c5f2565121 (compile): 18:40:36.735599 => 18:40:36.737808
[0m18:40:36.738084 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_last_active_month.c5f2565121
[0m18:40:36.738263 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_last_active_month.c5f2565121 (execute): 18:40:36.738190 => 18:40:36.738193
[0m18:40:36.738635 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_last_active_month.c5f2565121
[0m18:40:36.738795 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_mrr.7e419847d2
[0m18:40:36.739079 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_last_active_month.c5f2565121, now test.acme.not_null_mrr_mrr.7e419847d2)
[0m18:40:36.739222 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_mrr.7e419847d2
[0m18:40:36.741216 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_mrr.7e419847d2"
[0m18:40:36.741999 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_mrr.7e419847d2 (compile): 18:40:36.739317 => 18:40:36.741913
[0m18:40:36.742167 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_mrr.7e419847d2
[0m18:40:36.742340 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_mrr.7e419847d2 (execute): 18:40:36.742269 => 18:40:36.742274
[0m18:40:36.742753 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_mrr.7e419847d2
[0m18:40:36.742933 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_mrr_change.0329647bd8
[0m18:40:36.743228 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_mrr.7e419847d2, now test.acme.not_null_mrr_mrr_change.0329647bd8)
[0m18:40:36.743378 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_mrr_change.0329647bd8
[0m18:40:36.746399 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_mrr_change.0329647bd8"
[0m18:40:36.746883 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_mrr_change.0329647bd8 (compile): 18:40:36.743484 => 18:40:36.746804
[0m18:40:36.747033 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_mrr_change.0329647bd8
[0m18:40:36.747199 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_mrr_change.0329647bd8 (execute): 18:40:36.747131 => 18:40:36.747133
[0m18:40:36.747547 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_mrr_change.0329647bd8
[0m18:40:36.747708 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_previous_month_is_active.836f1724d2
[0m18:40:36.747980 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_mrr_change.0329647bd8, now test.acme.not_null_mrr_previous_month_is_active.836f1724d2)
[0m18:40:36.748129 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_previous_month_is_active.836f1724d2
[0m18:40:36.749996 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_previous_month_is_active.836f1724d2"
[0m18:40:36.750475 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_previous_month_is_active.836f1724d2 (compile): 18:40:36.748221 => 18:40:36.750397
[0m18:40:36.750627 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_previous_month_is_active.836f1724d2
[0m18:40:36.750795 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_previous_month_is_active.836f1724d2 (execute): 18:40:36.750728 => 18:40:36.750730
[0m18:40:36.751138 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_previous_month_is_active.836f1724d2
[0m18:40:36.751296 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7
[0m18:40:36.751563 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_previous_month_is_active.836f1724d2, now test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7)
[0m18:40:36.751702 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7
[0m18:40:36.753554 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7"
[0m18:40:36.753860 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7 (compile): 18:40:36.751796 => 18:40:36.753782
[0m18:40:36.754009 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7
[0m18:40:36.754177 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7 (execute): 18:40:36.754108 => 18:40:36.754110
[0m18:40:36.754510 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7
[0m18:40:36.754666 [debug] [Thread-1 (]: Began running node test.acme.unique_mrr_id.a14d6c26bd
[0m18:40:36.754935 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7, now test.acme.unique_mrr_id.a14d6c26bd)
[0m18:40:36.755076 [debug] [Thread-1 (]: Began compiling node test.acme.unique_mrr_id.a14d6c26bd
[0m18:40:36.756928 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.unique_mrr_id.a14d6c26bd"
[0m18:40:36.757239 [debug] [Thread-1 (]: Timing info for test.acme.unique_mrr_id.a14d6c26bd (compile): 18:40:36.755172 => 18:40:36.757162
[0m18:40:36.757393 [debug] [Thread-1 (]: Began executing node test.acme.unique_mrr_id.a14d6c26bd
[0m18:40:36.757565 [debug] [Thread-1 (]: Timing info for test.acme.unique_mrr_id.a14d6c26bd (execute): 18:40:36.757495 => 18:40:36.757497
[0m18:40:36.757987 [debug] [Thread-1 (]: Finished running node test.acme.unique_mrr_id.a14d6c26bd
[0m18:40:36.758537 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:40:36.758686 [debug] [MainThread]: Connection 'test.acme.unique_mrr_id.a14d6c26bd' was properly closed.
[0m18:40:36.760137 [debug] [MainThread]: Command end result
[0m18:40:36.770177 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m18:40:36.770382 [info ] [MainThread]: Building catalog
[0m18:40:36.770740 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:40:37.673288 [debug] [ThreadPool]: Acquiring new bigquery connection 'production-environment-306717.information_schema'
[0m18:40:37.689853 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:40:37.690972 [debug] [ThreadPool]: On production-environment-306717.information_schema: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "connection_name": "production-environment-306717.information_schema"} */

    with tables as (
        select
            project_id as table_database,
            dataset_id as table_schema,
            table_id as original_table_name,

            concat(project_id, '.', dataset_id, '.', table_id) as relation_id,

            row_count,
            size_bytes as size_bytes,
            case
                when type = 1 then 'table'
                when type = 2 then 'view'
                else 'external'
            end as table_type,

            REGEXP_CONTAINS(table_id, '^.+[0-9]{8}$') and coalesce(type, 0) = 1 as is_date_shard,
            REGEXP_EXTRACT(table_id, '^(.+)[0-9]{8}$') as shard_base_name,
            REGEXP_EXTRACT(table_id, '^.+([0-9]{8})$') as shard_name

        from `production-environment-306717`.`general_explorations`.__TABLES__
        where (upper(dataset_id) = upper('general_explorations'))
    ),

    table_options as (
        select
            concat(table_catalog, '.', table_schema, '.', table_name) as relation_id,
            JSON_VALUE(option_value) as table_comment

        from `production-environment-306717`.`general_explorations`.INFORMATION_SCHEMA.TABLE_OPTIONS
        where option_name = 'description'
    ),
    extracted as (

        select *,
            case
                when is_date_shard then shard_base_name
                else original_table_name
            end as table_name

        from tables

    ),

    unsharded_tables as (

        select
            table_database,
            table_schema,
            table_name,
            coalesce(table_type, 'external') as table_type,
            is_date_shard,

            struct(
                min(shard_name) as shard_min,
                max(shard_name) as shard_max,
                count(*) as shard_count
            ) as table_shards,

            sum(size_bytes) as size_bytes,
            sum(row_count) as row_count,

            max(relation_id) as relation_id

        from extracted
        group by 1,2,3,4,5

    ),

    info_schema_columns as (

        select
            concat(table_catalog, '.', table_schema, '.', table_name) as relation_id,
            table_catalog as table_database,
            table_schema,
            table_name,

            -- use the "real" column name from the paths query below
            column_name as base_column_name,
            ordinal_position as column_index,

            is_partitioning_column,
            clustering_ordinal_position

        from `production-environment-306717`.`general_explorations`.INFORMATION_SCHEMA.COLUMNS
        where ordinal_position is not null

    ),

    info_schema_column_paths as (

        select
            concat(table_catalog, '.', table_schema, '.', table_name) as relation_id,
            field_path as column_name,
            data_type as column_type,
            column_name as base_column_name,
            description as column_comment

        from `production-environment-306717`.`general_explorations`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS

    ),

    columns as (

        select * except (base_column_name)
        from info_schema_columns
        join info_schema_column_paths using (relation_id, base_column_name)

    ),

    column_stats as (

        select
            table_database,
            table_schema,
            table_name,
            max(relation_id) as relation_id,
            max(case when is_partitioning_column = 'YES' then 1 else 0 end) = 1 as is_partitioned,
            max(case when is_partitioning_column = 'YES' then column_name else null end) as partition_column,
            max(case when clustering_ordinal_position is not null then 1 else 0 end) = 1 as is_clustered,
            array_to_string(
                array_agg(
                    case
                        when clustering_ordinal_position is not null then column_name
                        else null
                    end ignore nulls
                    order by clustering_ordinal_position
                ), ', '
            ) as clustering_columns

        from columns
        group by 1,2,3

    )

    select
        unsharded_tables.table_database,
        unsharded_tables.table_schema,
        case
            when is_date_shard then concat(unsharded_tables.table_name, '*')
            else unsharded_tables.table_name
        end as table_name,
        unsharded_tables.table_type,
        table_options.table_comment,

        -- coalesce name and type for External tables - these columns are not
        -- present in the COLUMN_FIELD_PATHS resultset
        coalesce(columns.column_name, '<unknown>') as column_name,
        -- invent a row number to account for nested fields -- BQ does
        -- not treat these nested properties as independent fields
        row_number() over (
            partition by relation_id
            order by columns.column_index, columns.column_name
        ) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        columns.column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_shards.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_shards.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_shards.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        (unsharded_tables.table_type = 'table') as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        (unsharded_tables.table_type = 'table') as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        is_clustered as `stats__clustering_fields__include`

    -- join using relation_id (an actual relation, not a shard prefix) to make
    -- sure that column metadata is picked up through the join. This will only
    -- return the column information for the "max" table in a date-sharded table set
    from unsharded_tables
    left join table_options using (relation_id)
    left join columns using (relation_id)
    left join column_stats using (relation_id)
  
[0m18:40:38.411415 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:c9e15aca-891c-418e-a5bb-955ed3243bbc&page=queryresults
[0m18:40:43.946365 [info ] [MainThread]: Catalog written to /Users/olaisaac/projects/mrr-playbook/target/catalog.json
[0m18:40:43.949580 [debug] [MainThread]: Command `dbt docs generate` succeeded at 18:40:43.949468 after 10.97 seconds
[0m18:40:43.949821 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m18:40:43.949953 [debug] [MainThread]: Connection 'production-environment-306717.information_schema' was properly closed.
[0m18:40:43.950100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109400d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092fcc50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104da7510>]}
[0m18:40:43.950272 [debug] [MainThread]: Flushing usage events
[0m18:42:39.248908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104aed350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b09050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b09750>]}


============================== 18:42:39.251864 | db814ba1-fa57-41c6-b216-81ce6c680baa ==============================
[0m18:42:39.251864 [info ] [MainThread]: Running with dbt=1.6.7
[0m18:42:39.252178 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'profiles_dir': '/Users/olaisaac/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt docs serve', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:42:39.460990 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:42:39.461275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'db814ba1-fa57-41c6-b216-81ce6c680baa', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055b3610>]}
[0m18:42:39.461512 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:42:39.461694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'db814ba1-fa57-41c6-b216-81ce6c680baa', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105593e90>]}
[0m18:42:39.488288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'db814ba1-fa57-41c6-b216-81ce6c680baa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b1a090>]}
[0m18:42:39.495221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'db814ba1-fa57-41c6-b216-81ce6c680baa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b1a090>]}
[0m18:42:39.849803 [error] [MainThread]: Encountered an error:
[Errno 48] Address already in use
[0m18:42:39.855237 [error] [MainThread]: Traceback (most recent call last):
  File "/Users/olaisaac/dbt-env/lib/python3.11/site-packages/dbt/cli/requires.py", line 87, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/olaisaac/dbt-env/lib/python3.11/site-packages/dbt/cli/requires.py", line 72, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/olaisaac/dbt-env/lib/python3.11/site-packages/dbt/cli/requires.py", line 143, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/olaisaac/dbt-env/lib/python3.11/site-packages/dbt/cli/requires.py", line 172, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/olaisaac/dbt-env/lib/python3.11/site-packages/dbt/cli/requires.py", line 219, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/olaisaac/dbt-env/lib/python3.11/site-packages/dbt/cli/main.py", line 320, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/Users/olaisaac/dbt-env/lib/python3.11/site-packages/dbt/task/serve.py", line 23, in run
    with socketserver.TCPServer(("", port), SimpleHTTPRequestHandler) as httpd:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.4/Frameworks/Python.framework/Versions/3.11/lib/python3.11/socketserver.py", line 456, in __init__
    self.server_bind()
  File "/opt/homebrew/Cellar/python@3.11/3.11.4/Frameworks/Python.framework/Versions/3.11/lib/python3.11/socketserver.py", line 472, in server_bind
    self.socket.bind(self.server_address)
OSError: [Errno 48] Address already in use

[0m18:42:39.856164 [debug] [MainThread]: Command `dbt docs serve` failed at 18:42:39.856048 after 0.63 seconds
[0m18:42:39.856475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ae4e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b094d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105801410>]}
[0m18:42:39.856747 [debug] [MainThread]: Flushing usage events
[0m18:43:11.233790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105232850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10523c250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10524cf90>]}


============================== 18:43:11.236363 | b1903716-fe41-4f01-bd35-4a95630297fc ==============================
[0m18:43:11.236363 [info ] [MainThread]: Running with dbt=1.6.7
[0m18:43:11.236669 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/olaisaac/projects/mrr-playbook/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt docs serve', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m18:43:11.430333 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:43:11.430626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'b1903716-fe41-4f01-bd35-4a95630297fc', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b52290>]}
[0m18:43:11.430869 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m18:43:11.431046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'b1903716-fe41-4f01-bd35-4a95630297fc', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079be690>]}
[0m18:43:11.450377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b1903716-fe41-4f01-bd35-4a95630297fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105231650>]}
[0m18:43:11.456934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b1903716-fe41-4f01-bd35-4a95630297fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10799f4d0>]}
[0m09:20:52.671691 [error] [MainThread]: Encountered an error:

[0m09:20:52.732031 [error] [MainThread]: Traceback (most recent call last):
  File "/Users/olaisaac/dbt-env/lib/python3.11/site-packages/dbt/cli/requires.py", line 87, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/olaisaac/dbt-env/lib/python3.11/site-packages/dbt/cli/requires.py", line 72, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/olaisaac/dbt-env/lib/python3.11/site-packages/dbt/cli/requires.py", line 143, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/olaisaac/dbt-env/lib/python3.11/site-packages/dbt/cli/requires.py", line 172, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/olaisaac/dbt-env/lib/python3.11/site-packages/dbt/cli/requires.py", line 219, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/olaisaac/dbt-env/lib/python3.11/site-packages/dbt/cli/main.py", line 320, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/Users/olaisaac/dbt-env/lib/python3.11/site-packages/dbt/task/serve.py", line 28, in run
    httpd.serve_forever()
  File "/opt/homebrew/Cellar/python@3.11/3.11.4/Frameworks/Python.framework/Versions/3.11/lib/python3.11/socketserver.py", line 233, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.4/Frameworks/Python.framework/Versions/3.11/lib/python3.11/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m09:20:52.738269 [debug] [MainThread]: Command `dbt docs serve` failed at 09:20:52.737706 after 3139.72 seconds
[0m09:20:52.741582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10524cd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052250d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10521f8d0>]}
[0m09:20:52.746334 [debug] [MainThread]: Flushing usage events
[0m09:22:05.895479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104762850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102fe8990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10476fb50>]}


============================== 09:22:05.903499 | a3872e0d-30cd-4cdd-9591-65e6121324f3 ==============================
[0m09:22:05.903499 [info ] [MainThread]: Running with dbt=1.6.7
[0m09:22:05.903853 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/olaisaac/projects/dbt-test-playbook/logs', 'version_check': 'True', 'profiles_dir': '/Users/olaisaac/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt deps', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:22:05.907802 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m09:22:05.908055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'a3872e0d-30cd-4cdd-9591-65e6121324f3', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104763750>]}
[0m09:22:05.908281 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m09:22:05.908453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'a3872e0d-30cd-4cdd-9591-65e6121324f3', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10478b7d0>]}
[0m09:22:05.936782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a3872e0d-30cd-4cdd-9591-65e6121324f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104787c50>]}
[0m09:22:05.938347 [debug] [MainThread]: Set downloads directory='/var/folders/5k/gd4vyqv53w170k5mm228ct9w0000gn/T/dbt-downloads-hg_o1jbm'
[0m09:22:05.938622 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m09:22:06.283307 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m09:22:06.286856 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m09:22:06.388709 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m09:22:06.402090 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m09:22:06.866623 [info ] [MainThread]: Installed from version 0.8.0
[0m09:22:06.866974 [info ] [MainThread]: Updated version available: 1.1.1
[0m09:22:06.867267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'a3872e0d-30cd-4cdd-9591-65e6121324f3', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10474da90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10476eb50>]}
[0m09:22:06.867497 [info ] [MainThread]: 
[0m09:22:06.867650 [info ] [MainThread]: Updates available for packages: ['dbt-labs/dbt_utils']                 
Update your versions in packages.yml, then run dbt deps
[0m09:22:06.868518 [debug] [MainThread]: Command `dbt deps` succeeded at 09:22:06.868447 after 1.02 seconds
[0m09:22:06.868711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10011f510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1002f6850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10305ffd0>]}
[0m09:22:06.868911 [debug] [MainThread]: Flushing usage events
[0m09:27:26.743255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cce850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ccf510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105564990>]}


============================== 09:27:26.746320 | d4c5e92e-aa4e-4832-ad14-e300ada27452 ==============================
[0m09:27:26.746320 [info ] [MainThread]: Running with dbt=1.6.7
[0m09:27:26.746634 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/olaisaac/projects/dbt-test-playbook/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:27:27.023556 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m09:27:27.023845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'd4c5e92e-aa4e-4832-ad14-e300ada27452', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076d1e90>]}
[0m09:27:27.024084 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m09:27:27.024263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'd4c5e92e-aa4e-4832-ad14-e300ada27452', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10772a250>]}
[0m09:27:27.057448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd4c5e92e-aa4e-4832-ad14-e300ada27452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10775ba10>]}
[0m09:27:27.064299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd4c5e92e-aa4e-4832-ad14-e300ada27452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077929d0>]}
[0m09:27:27.064889 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m09:27:27.078535 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m09:27:27.142286 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:27:27.142511 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:27:27.145873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd4c5e92e-aa4e-4832-ad14-e300ada27452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107312090>]}
[0m09:27:27.186423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd4c5e92e-aa4e-4832-ad14-e300ada27452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a47fd0>]}
[0m09:27:27.186694 [info ] [MainThread]: Found 1 seed, 21 tests, 4 models, 0 sources, 0 exposures, 0 metrics, 582 macros, 0 groups, 0 semantic models
[0m09:27:27.186855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd4c5e92e-aa4e-4832-ad14-e300ada27452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103e7c810>]}
[0m09:27:27.187838 [info ] [MainThread]: 
[0m09:27:27.188234 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m09:27:27.188813 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_production-environment-306717'
[0m09:27:27.188997 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:27:29.209238 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_production-environment-306717, now list_production-environment-306717_general_explorations)
[0m09:27:29.210235 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:27:29.676461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd4c5e92e-aa4e-4832-ad14-e300ada27452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075444d0>]}
[0m09:27:29.677716 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:27:29.678063 [info ] [MainThread]: 
[0m09:27:29.681835 [debug] [Thread-1 (]: Began running node model.acme.util_months
[0m09:27:29.682395 [info ] [Thread-1 (]: 1 of 4 START sql view model general_explorations.util_months ................... [RUN]
[0m09:27:29.683163 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_production-environment-306717_general_explorations, now model.acme.util_months)
[0m09:27:29.683523 [debug] [Thread-1 (]: Began compiling node model.acme.util_months
[0m09:27:29.704478 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:27:29.704943 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


        select 

    datetime_diff(
        cast(date_trunc(current_date, month) as datetime),
        cast('2018-01-01' as datetime),
        month
    )


[0m09:27:31.255003 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:f67de53f-34cb-4027-8dc6-a70b68fb13ff&page=queryresults
[0m09:27:32.617812 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.util_months"
[0m09:27:32.621180 [debug] [Thread-1 (]: Timing info for model.acme.util_months (compile): 09:27:29.683757 => 09:27:32.620959
[0m09:27:32.621576 [debug] [Thread-1 (]: Began executing node model.acme.util_months
[0m09:27:32.646295 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.util_months"
[0m09:27:32.647558 [debug] [Thread-1 (]: On model.acme.util_months: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.util_months"} */


  create or replace view `production-environment-306717`.`general_explorations`.`util_months`
  OPTIONS()
  as 

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
    
    

    )

    select *
    from unioned
    where generated_number <= 70
    order by generated_number



),

all_periods as (

    select (
        

        datetime_add(
            cast( '2018-01-01' as datetime),
        interval row_number() over (order by 1) - 1 month
        )


    ) as date_month
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_month <= date_trunc(current_date, month)

)

select * from filtered

;


[0m09:27:33.028837 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:8bba1115-fcc3-493c-9033-6c5095e995f5&page=queryresults
[0m09:27:33.595688 [debug] [Thread-1 (]: Timing info for model.acme.util_months (execute): 09:27:32.621807 => 09:27:33.595445
[0m09:27:33.596761 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4c5e92e-aa4e-4832-ad14-e300ada27452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077a5a50>]}
[0m09:27:33.597455 [info ] [Thread-1 (]: 1 of 4 OK created sql view model general_explorations.util_months .............. [[32mCREATE VIEW (0 processed)[0m in 3.91s]
[0m09:27:33.598101 [debug] [Thread-1 (]: Finished running node model.acme.util_months
[0m09:27:33.598818 [debug] [Thread-1 (]: Began running node model.acme.customer_revenue_by_month
[0m09:27:33.599299 [info ] [Thread-1 (]: 2 of 4 START sql view model general_explorations.customer_revenue_by_month ..... [RUN]
[0m09:27:33.600191 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.util_months, now model.acme.customer_revenue_by_month)
[0m09:27:33.600557 [debug] [Thread-1 (]: Began compiling node model.acme.customer_revenue_by_month
[0m09:27:33.604358 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.customer_revenue_by_month"
[0m09:27:33.606518 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (compile): 09:27:33.600774 => 09:27:33.606329
[0m09:27:33.606867 [debug] [Thread-1 (]: Began executing node model.acme.customer_revenue_by_month
[0m09:27:33.610679 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.customer_revenue_by_month"
[0m09:27:33.612115 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:27:33.612735 [debug] [Thread-1 (]: On model.acme.customer_revenue_by_month: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.customer_revenue_by_month"} */


  create or replace view `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`
  OPTIONS()
  as with subscription_periods as (

    select * from `production-environment-306717`.`general_explorations`.`subscription_periods`

),

months as (

    select * from `production-environment-306717`.`general_explorations`.`util_months`

),

-- determine when a given account had its first and last (or most recent) month
customers as (

    select
        customer_id,
        date_trunc(min(start_date), month) as date_month_start,
        date_trunc(max(end_date), month) as date_month_end

    from subscription_periods

    group by 1

),

-- create one record per month between a customer's first and last month
-- (example of a date spine)
customer_months as (

    select
        customers.customer_id,
        months.date_month

    from customers

    inner join months
        -- all months after start date
        on  months.date_month >= customers.date_month_start
        -- and before end date
        and months.date_month < customers.date_month_end

),

-- join the account-month spine to MRR base model, pulling through most recent dates
-- and plan info for month rows that have no invoices (i.e. churns)
joined as (

    select
        customer_months.date_month,
        customer_months.customer_id,
        coalesce(subscription_periods.monthly_amount, 0) as mrr

    from customer_months

    left join subscription_periods
        on customer_months.customer_id = subscription_periods.customer_id
        -- month is after a subscription start date
        and customer_months.date_month >= subscription_periods.start_date
        -- month is before a subscription end date (and handle null case)
        and (customer_months.date_month < subscription_periods.end_date
                or subscription_periods.end_date is null)

),

final as (
    select *,
    case when first_active_month = date_month then true else false end as is_first_month,
    case when last_active_month = date_month then true else false end as is_last_month,

    from(
        select
            date_month,
            customer_id,
            mrr,
            case when mrr > 0 then true else false end as is_active,

            -- calculate first and last months
            min(case when mrr > 0 then date_month end) over (
                partition by customer_id
            ) as first_active_month,

            max(case when mrr > 0 then date_month end) over (
                partition by customer_id
            ) as last_active_month
        from joined
    )
)

select * from final;


[0m09:27:34.232905 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:14185a08-3647-49f9-bb2e-620b68692e99&page=queryresults
[0m09:27:34.849839 [debug] [Thread-1 (]: Timing info for model.acme.customer_revenue_by_month (execute): 09:27:33.607087 => 09:27:34.849489
[0m09:27:34.851345 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4c5e92e-aa4e-4832-ad14-e300ada27452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b0ffd0>]}
[0m09:27:34.852258 [info ] [Thread-1 (]: 2 of 4 OK created sql view model general_explorations.customer_revenue_by_month  [[32mCREATE VIEW (0 processed)[0m in 1.25s]
[0m09:27:34.853115 [debug] [Thread-1 (]: Finished running node model.acme.customer_revenue_by_month
[0m09:27:34.854446 [debug] [Thread-1 (]: Began running node model.acme.customer_churn_month
[0m09:27:34.855513 [info ] [Thread-1 (]: 3 of 4 START sql view model general_explorations.customer_churn_month .......... [RUN]
[0m09:27:34.856527 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.customer_revenue_by_month, now model.acme.customer_churn_month)
[0m09:27:34.857007 [debug] [Thread-1 (]: Began compiling node model.acme.customer_churn_month
[0m09:27:34.862813 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.customer_churn_month"
[0m09:27:34.864787 [debug] [Thread-1 (]: Timing info for model.acme.customer_churn_month (compile): 09:27:34.857319 => 09:27:34.864506
[0m09:27:34.865287 [debug] [Thread-1 (]: Began executing node model.acme.customer_churn_month
[0m09:27:34.870295 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.customer_churn_month"
[0m09:27:34.871434 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:27:34.872014 [debug] [Thread-1 (]: On model.acme.customer_churn_month: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.customer_churn_month"} */


  create or replace view `production-environment-306717`.`general_explorations`.`customer_churn_month`
  OPTIONS()
  as with mrr as (

    select * from `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`

),

-- row for month *after* last month of activity
joined as (

    select
        date_add(date_month, interval 1 month) as date_month,
        customer_id,
        0 as mrr,
        false as is_active,
        first_active_month,
        last_active_month,
        false as is_first_month,
        false as is_last_month

    from mrr

    where is_last_month = true

)

select * from joined;


[0m09:27:35.405827 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:c91a5972-f23b-458b-8cbe-1280d1e964d5&page=queryresults
[0m09:27:35.881873 [debug] [Thread-1 (]: Timing info for model.acme.customer_churn_month (execute): 09:27:34.865581 => 09:27:35.881537
[0m09:27:35.883609 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4c5e92e-aa4e-4832-ad14-e300ada27452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a46b90>]}
[0m09:27:35.884702 [info ] [Thread-1 (]: 3 of 4 OK created sql view model general_explorations.customer_churn_month ..... [[32mCREATE VIEW (0 processed)[0m in 1.03s]
[0m09:27:35.885513 [debug] [Thread-1 (]: Finished running node model.acme.customer_churn_month
[0m09:27:35.886489 [debug] [Thread-1 (]: Began running node model.acme.mrr
[0m09:27:35.887157 [info ] [Thread-1 (]: 4 of 4 START sql view model general_explorations.mrr ........................... [RUN]
[0m09:27:35.888064 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.acme.customer_churn_month, now model.acme.mrr)
[0m09:27:35.888522 [debug] [Thread-1 (]: Began compiling node model.acme.mrr
[0m09:27:35.902940 [warn ] [Thread-1 (]: 
Warning: the `surrogate_key` macro now takes a single list argument instead of multiple string arguments. Support for multiple string arguments will be deprecated in a future release of dbt-utils. The acme.mrr model triggered this warning. 
[0m09:27:35.910847 [debug] [Thread-1 (]: Writing injected SQL for node "model.acme.mrr"
[0m09:27:35.912044 [debug] [Thread-1 (]: Timing info for model.acme.mrr (compile): 09:27:35.888836 => 09:27:35.911839
[0m09:27:35.912411 [debug] [Thread-1 (]: Began executing node model.acme.mrr
[0m09:27:35.917867 [debug] [Thread-1 (]: Writing runtime sql for node "model.acme.mrr"
[0m09:27:35.918901 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:27:35.919320 [debug] [Thread-1 (]: On model.acme.mrr: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "model.acme.mrr"} */


  create or replace view `production-environment-306717`.`general_explorations`.`mrr`
  OPTIONS()
  as with unioned as (

    select * from `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`

    union all

    select * from `production-environment-306717`.`general_explorations`.`customer_churn_month`

),

-- get prior month MRR and calculate MRR change
mrr_with_changes as (

    select
        *,
        mrr - previous_month_mrr as mrr_change
    from(
        select *,
        coalesce(
            lag(is_active) over (partition by customer_id order by date_month),
            false
        ) as previous_month_is_active,

        coalesce(
            lag(mrr) over (partition by customer_id order by date_month),
            0
        ) as previous_month_mrr,

        from unioned
    )

),

-- classify months as new, churn, reactivation, upgrade, downgrade (or null)
-- also add an ID column
final as (

    select
        to_hex(md5(cast(coalesce(cast(date_month as 
    string
), '') || '-' || coalesce(cast(customer_id as 
    string
), '') as 
    string
))) as id,

        *,

        case
            when is_first_month
                then 'new'
            when not(is_active) and previous_month_is_active
                then 'churn'
            when is_active and not(previous_month_is_active)
                then 'reactivation'
            when mrr_change > 0 then 'upgrade'
            when mrr_change < 0 then 'downgrade'
        end as change_category,

        least(mrr, previous_month_mrr) as renewal_amount

    from mrr_with_changes

)

select * from final;


[0m09:27:36.447868 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:28c1c040-0c9c-4876-9415-8ee80c428201&page=queryresults
[0m09:27:37.003586 [debug] [Thread-1 (]: Timing info for model.acme.mrr (execute): 09:27:35.912640 => 09:27:37.003222
[0m09:27:37.005156 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4c5e92e-aa4e-4832-ad14-e300ada27452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cd3f90>]}
[0m09:27:37.006182 [info ] [Thread-1 (]: 4 of 4 OK created sql view model general_explorations.mrr ...................... [[32mCREATE VIEW (0 processed)[0m in 1.12s]
[0m09:27:37.007042 [debug] [Thread-1 (]: Finished running node model.acme.mrr
[0m09:27:37.009115 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:27:37.009493 [debug] [MainThread]: Connection 'model.acme.mrr' was properly closed.
[0m09:27:37.009912 [info ] [MainThread]: 
[0m09:27:37.010317 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 9.82 seconds (9.82s).
[0m09:27:37.011575 [debug] [MainThread]: Command end result
[0m09:27:37.028943 [info ] [MainThread]: 
[0m09:27:37.029373 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:27:37.029657 [info ] [MainThread]: 
[0m09:27:37.029950 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m09:27:37.030528 [debug] [MainThread]: Command `dbt run` succeeded at 09:27:37.030443 after 10.31 seconds
[0m09:27:37.030872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ccdcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102862850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10268b510>]}
[0m09:27:37.031195 [debug] [MainThread]: Flushing usage events
[0m09:28:56.034142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10731a850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10731b6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bb0990>]}


============================== 09:28:56.037788 | 1b38ea3d-3adb-4c97-9a1c-c94ee54c74cb ==============================
[0m09:28:56.037788 [info ] [MainThread]: Running with dbt=1.6.7
[0m09:28:56.038158 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/olaisaac/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/olaisaac/projects/dbt-test-playbook/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt test', 'send_anonymous_usage_stats': 'True'}
[0m09:28:56.322400 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m09:28:56.322687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '1b38ea3d-3adb-4c97-9a1c-c94ee54c74cb', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ddf6d0>]}
[0m09:28:56.322923 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `data-paths` config has been renamed to `seed-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m09:28:56.323099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '1b38ea3d-3adb-4c97-9a1c-c94ee54c74cb', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107606e10>]}
[0m09:28:56.350796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1b38ea3d-3adb-4c97-9a1c-c94ee54c74cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108015650>]}
[0m09:28:56.357546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1b38ea3d-3adb-4c97-9a1c-c94ee54c74cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108023f50>]}
[0m09:28:56.358158 [info ] [MainThread]: Registered adapter: bigquery=1.6.8
[0m09:28:56.371399 [debug] [MainThread]: checksum: a051d2bc88277f3be74306f0393e0e8e6f29724fe11a36c13ebfccd4b87560d8, vars: {}, profile: , target: , version: 1.6.7
[0m09:28:56.437500 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:28:56.437728 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:28:56.441161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1b38ea3d-3adb-4c97-9a1c-c94ee54c74cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10815b0d0>]}
[0m09:28:56.480880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1b38ea3d-3adb-4c97-9a1c-c94ee54c74cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108093d50>]}
[0m09:28:56.481149 [info ] [MainThread]: Found 1 seed, 21 tests, 4 models, 0 sources, 0 exposures, 0 metrics, 582 macros, 0 groups, 0 semantic models
[0m09:28:56.481313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1b38ea3d-3adb-4c97-9a1c-c94ee54c74cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1044c8810>]}
[0m09:28:56.482562 [info ] [MainThread]: 
[0m09:28:56.482941 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m09:28:56.483540 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_production-environment-306717_general_explorations'
[0m09:28:56.483717 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:28:57.724297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1b38ea3d-3adb-4c97-9a1c-c94ee54c74cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d48750>]}
[0m09:28:57.725045 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:28:57.725273 [info ] [MainThread]: 
[0m09:28:57.728105 [debug] [Thread-1 (]: Began running node test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6
[0m09:28:57.728458 [info ] [Thread-1 (]: 1 of 21 START test dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_  [RUN]
[0m09:28:57.729007 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_production-environment-306717_general_explorations, now test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6)
[0m09:28:57.729281 [debug] [Thread-1 (]: Began compiling node test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6
[0m09:28:57.740036 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6"
[0m09:28:57.741769 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6 (compile): 09:28:57.729447 => 09:28:57.741632
[0m09:28:57.742012 [debug] [Thread-1 (]: Began executing node test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6
[0m09:28:57.753877 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6"
[0m09:28:57.754822 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:28:57.755084 [debug] [Thread-1 (]: On test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

with meet_condition as (
    select * from `production-environment-306717`.`general_explorations`.`mrr` where 1=1
)

select
    *
from meet_condition

where not(date_month <= date_trunc('month', current_date))


      
    ) dbt_internal_test
[0m09:29:00.834848 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:11e9a5bd-74c7-4497-bf1c-cc6db7664381&page=queryresults
[0m09:29:00.838186 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Found invalid date part argument function call syntax for `current_date`() at [17:45]')
[0m09:29:04.624616 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:5feea8ba-3352-4b2a-9bec-447a42ec16b9&page=queryresults
[0m09:29:04.629551 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:5feea8ba-3352-4b2a-9bec-447a42ec16b9&page=queryresults
[0m09:29:04.631206 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6 (execute): 09:28:57.742149 => 09:29:04.630772
[0m09:29:04.649749 [debug] [Thread-1 (]: Database Error in test dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_ (models/mrr.yml)
  Found invalid date part argument function call syntax for `current_date`() at [17:45]
  compiled Code at target/run/acme/models/mrr.yml/dbt_utils_expression_is_true_m_b3233a8b427f290f3a2e2761afe6d682.sql
[0m09:29:04.650560 [error] [Thread-1 (]: 1 of 21 ERROR dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_  [[31mERROR[0m in 6.92s]
[0m09:29:04.651226 [debug] [Thread-1 (]: Finished running node test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6
[0m09:29:04.651697 [debug] [Thread-1 (]: Began running node test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670
[0m09:29:04.652318 [info ] [Thread-1 (]: 2 of 21 START test dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date  [RUN]
[0m09:29:04.653089 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_.8e3ee48bc6, now test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670)
[0m09:29:04.653459 [debug] [Thread-1 (]: Began compiling node test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670
[0m09:29:04.658941 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670"
[0m09:29:04.660566 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670 (compile): 09:29:04.653693 => 09:29:04.660375
[0m09:29:04.660915 [debug] [Thread-1 (]: Began executing node test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670
[0m09:29:04.663475 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670"
[0m09:29:04.664409 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:29:04.664792 [debug] [Thread-1 (]: On test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

with meet_condition as (
    select * from `production-environment-306717`.`general_explorations`.`subscription_periods` where 1=1
)

select
    *
from meet_condition

where not(date_trunc('month', end_date) = end_date)


      
    ) dbt_internal_test
[0m09:29:07.806925 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:5c94d788-f4cc-4cbc-bc12-91f21b53f77a&page=queryresults
[0m09:29:07.810187 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('A valid date part name is required but found end_date at [17:31]')
[0m09:29:11.412742 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:8e8f91c3-9859-47e8-90c1-a37caa1ad0b2&page=queryresults
[0m09:29:11.417137 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:8e8f91c3-9859-47e8-90c1-a37caa1ad0b2&page=queryresults
[0m09:29:11.418489 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670 (execute): 09:29:04.661138 => 09:29:11.418053
[0m09:29:11.424697 [debug] [Thread-1 (]: Database Error in test dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date (models/schema.yml)
  A valid date part name is required but found end_date at [17:31]
  compiled Code at target/run/acme/models/schema.yml/dbt_utils_expression_is_true_s_4d81a420147076e873cd54eae2c460ae.sql
[0m09:29:11.425605 [error] [Thread-1 (]: 2 of 21 ERROR dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date  [[31mERROR[0m in 6.77s]
[0m09:29:11.426405 [debug] [Thread-1 (]: Finished running node test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670
[0m09:29:11.426972 [debug] [Thread-1 (]: Began running node test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd
[0m09:29:11.427650 [info ] [Thread-1 (]: 3 of 21 START test dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date  [RUN]
[0m09:29:11.428789 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date.5f773b4670, now test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd)
[0m09:29:11.429338 [debug] [Thread-1 (]: Began compiling node test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd
[0m09:29:11.436719 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd"
[0m09:29:11.438232 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd (compile): 09:29:11.429692 => 09:29:11.437940
[0m09:29:11.438688 [debug] [Thread-1 (]: Began executing node test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd
[0m09:29:11.441847 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd"
[0m09:29:11.442734 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:29:11.443219 [debug] [Thread-1 (]: On test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

with meet_condition as (
    select * from `production-environment-306717`.`general_explorations`.`subscription_periods` where 1=1
)

select
    *
from meet_condition

where not(date_trunc('month', start_date) = start_date)


      
    ) dbt_internal_test
[0m09:29:14.262750 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:bf36758c-29a7-4cf6-bad6-da4f29a7ad0e&page=queryresults
[0m09:29:14.266943 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('A valid date part name is required but found start_date at [17:31]')
[0m09:29:18.323722 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:f8a40c50-5ef5-40e2-b337-529d375d38fd&page=queryresults
[0m09:29:18.326848 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:f8a40c50-5ef5-40e2-b337-529d375d38fd&page=queryresults
[0m09:29:18.328243 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd (execute): 09:29:11.438959 => 09:29:18.327533
[0m09:29:18.334385 [debug] [Thread-1 (]: Database Error in test dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date (models/schema.yml)
  A valid date part name is required but found start_date at [17:31]
  compiled Code at target/run/acme/models/schema.yml/dbt_utils_expression_is_true_s_55d02e8a711fb54a4345c8b27cf573f2.sql
[0m09:29:18.335208 [error] [Thread-1 (]: 3 of 21 ERROR dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date  [[31mERROR[0m in 6.91s]
[0m09:29:18.335981 [debug] [Thread-1 (]: Finished running node test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd
[0m09:29:18.336562 [debug] [Thread-1 (]: Began running node test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa
[0m09:29:18.337259 [info ] [Thread-1 (]: 4 of 21 START test dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date  [RUN]
[0m09:29:18.338345 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date.abd2cf4dfd, now test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa)
[0m09:29:18.338873 [debug] [Thread-1 (]: Began compiling node test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa
[0m09:29:18.356789 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa"
[0m09:29:18.359250 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa (compile): 09:29:18.339210 => 09:29:18.359012
[0m09:29:18.359663 [debug] [Thread-1 (]: Began executing node test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa
[0m09:29:18.362277 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa"
[0m09:29:18.363093 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:29:18.363551 [debug] [Thread-1 (]: On test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

    
    


    
    




with window_functions as (

    select
        
        customer_id as partition_by_col,
        
        start_date as lower_bound,
        end_date as upper_bound,

        lead(start_date) over (
            partition by customer_id
            order by start_date
        ) as next_lower_bound,

        row_number() over (
            partition by customer_id
            order by start_date desc
        ) = 1 as is_last_record

    from `production-environment-306717`.`general_explorations`.`subscription_periods`

),

calc as (
    -- We want to return records where one of our assumptions fails, so we'll use
    -- the `not` function with `and` statements so we can write our assumptions nore cleanly
    select
        *,

        -- For each record: lower_bound should be < upper_bound.
        -- Coalesce it to return an error on the null case (implicit assumption
        -- these columns are not_null)
        coalesce(
            lower_bound < upper_bound,
            false
        ) as lower_bound_less_than_upper_bound,

        -- For each record: upper_bound <= the next lower_bound.
        -- Coalesce it to handle null cases for the last record.
        coalesce(
            upper_bound <= next_lower_bound,
            is_last_record,
            false
        ) as upper_bound_less_than_or_equal_to_next_lower_bound

    from window_functions

),

validation_errors as (

    select
        *
    from calc

    where not(
        -- THE FOLLOWING SHOULD BE TRUE --
        lower_bound_less_than_upper_bound
        and upper_bound_less_than_or_equal_to_next_lower_bound
    )
)

select * from validation_errors

      
    ) dbt_internal_test
[0m09:29:19.046420 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:e3d77915-e444-4b1e-9afa-5f91821c0ab0&page=queryresults
[0m09:29:20.020705 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa (execute): 09:29:18.359903 => 09:29:20.019462
[0m09:29:20.022958 [info ] [Thread-1 (]: 4 of 21 PASS dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date  [[32mPASS[0m in 1.68s]
[0m09:29:20.023764 [debug] [Thread-1 (]: Finished running node test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa
[0m09:29:20.024297 [debug] [Thread-1 (]: Began running node test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716
[0m09:29:20.024903 [info ] [Thread-1 (]: 5 of 21 START test dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month  [RUN]
[0m09:29:20.025775 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.dbt_utils_mutually_exclusive_ranges_subscription_periods_start_date__customer_id__end_date.a4c8bc64fa, now test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716)
[0m09:29:20.026206 [debug] [Thread-1 (]: Began compiling node test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716
[0m09:29:20.043022 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716"
[0m09:29:20.044136 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716 (compile): 09:29:20.026478 => 09:29:20.043963
[0m09:29:20.044453 [debug] [Thread-1 (]: Began executing node test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716
[0m09:29:20.046735 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716"
[0m09:29:20.047464 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:29:20.047859 [debug] [Thread-1 (]: On test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      





with validation_errors as (

    select
        customer_id, date_month
    from `production-environment-306717`.`general_explorations`.`customer_revenue_by_month`
    group by customer_id, date_month
    having count(*) > 1

)

select *
from validation_errors



      
    ) dbt_internal_test
[0m09:29:21.674025 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:a73d2f5d-5272-4e18-9336-e68f9604d06d&page=queryresults
[0m09:29:22.882681 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716 (execute): 09:29:20.044642 => 09:29:22.881837
[0m09:29:22.884787 [info ] [Thread-1 (]: 5 of 21 PASS dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month  [[32mPASS[0m in 2.86s]
[0m09:29:22.886243 [debug] [Thread-1 (]: Finished running node test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716
[0m09:29:22.887019 [debug] [Thread-1 (]: Began running node test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb
[0m09:29:22.887813 [info ] [Thread-1 (]: 6 of 21 START test dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month  [RUN]
[0m09:29:22.889070 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.dbt_utils_unique_combination_of_columns_customer_revenue_by_month_customer_id__date_month.e8886ba716, now test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb)
[0m09:29:22.889584 [debug] [Thread-1 (]: Began compiling node test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb
[0m09:29:22.898060 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb"
[0m09:29:22.900491 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb (compile): 09:29:22.889915 => 09:29:22.900256
[0m09:29:22.900914 [debug] [Thread-1 (]: Began executing node test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb
[0m09:29:22.904190 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb"
[0m09:29:22.905575 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:29:22.906114 [debug] [Thread-1 (]: On test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      





with validation_errors as (

    select
        customer_id, date_month
    from `production-environment-306717`.`general_explorations`.`mrr`
    group by customer_id, date_month
    having count(*) > 1

)

select *
from validation_errors



      
    ) dbt_internal_test
[0m09:29:24.828197 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:1a56e651-ab6d-4ff7-baf4-49ead3a788a1&page=queryresults
[0m09:29:26.160416 [debug] [Thread-1 (]: Timing info for test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb (execute): 09:29:22.901161 => 09:29:26.159676
[0m09:29:26.162415 [info ] [Thread-1 (]: 6 of 21 PASS dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month  [[32mPASS[0m in 3.27s]
[0m09:29:26.163492 [debug] [Thread-1 (]: Finished running node test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb
[0m09:29:26.164646 [debug] [Thread-1 (]: Began running node test.acme.not_null_customer_churn_month_customer_id.99e28f508c
[0m09:29:26.165617 [info ] [Thread-1 (]: 7 of 21 START test not_null_customer_churn_month_customer_id ................... [RUN]
[0m09:29:26.166833 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.dbt_utils_unique_combination_of_columns_mrr_customer_id__date_month.7a5b0199cb, now test.acme.not_null_customer_churn_month_customer_id.99e28f508c)
[0m09:29:26.167427 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_customer_churn_month_customer_id.99e28f508c
[0m09:29:26.177906 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_customer_churn_month_customer_id.99e28f508c"
[0m09:29:26.179441 [debug] [Thread-1 (]: Timing info for test.acme.not_null_customer_churn_month_customer_id.99e28f508c (compile): 09:29:26.167779 => 09:29:26.179195
[0m09:29:26.179898 [debug] [Thread-1 (]: Began executing node test.acme.not_null_customer_churn_month_customer_id.99e28f508c
[0m09:29:26.183787 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.not_null_customer_churn_month_customer_id.99e28f508c"
[0m09:29:26.185097 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:29:26.185686 [debug] [Thread-1 (]: On test.acme.not_null_customer_churn_month_customer_id.99e28f508c: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.not_null_customer_churn_month_customer_id.99e28f508c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select customer_id
from `production-environment-306717`.`general_explorations`.`customer_churn_month`
where customer_id is null



      
    ) dbt_internal_test
[0m09:29:28.043845 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:f0aee0f9-6e69-40bc-aec9-c122001a9ec4&page=queryresults
[0m09:29:29.198088 [debug] [Thread-1 (]: Timing info for test.acme.not_null_customer_churn_month_customer_id.99e28f508c (execute): 09:29:26.180176 => 09:29:29.197591
[0m09:29:29.199588 [info ] [Thread-1 (]: 7 of 21 PASS not_null_customer_churn_month_customer_id ......................... [[32mPASS[0m in 3.03s]
[0m09:29:29.200531 [debug] [Thread-1 (]: Finished running node test.acme.not_null_customer_churn_month_customer_id.99e28f508c
[0m09:29:29.203311 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_customer_id.adf44c0fb5
[0m09:29:29.207749 [info ] [Thread-1 (]: 8 of 21 START test not_null_mrr_customer_id .................................... [RUN]
[0m09:29:29.209189 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_customer_churn_month_customer_id.99e28f508c, now test.acme.not_null_mrr_customer_id.adf44c0fb5)
[0m09:29:29.209708 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_customer_id.adf44c0fb5
[0m09:29:29.216204 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_customer_id.adf44c0fb5"
[0m09:29:29.217806 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_customer_id.adf44c0fb5 (compile): 09:29:29.210029 => 09:29:29.217558
[0m09:29:29.218238 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_customer_id.adf44c0fb5
[0m09:29:29.221392 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.not_null_mrr_customer_id.adf44c0fb5"
[0m09:29:29.222373 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:29:29.222903 [debug] [Thread-1 (]: On test.acme.not_null_mrr_customer_id.adf44c0fb5: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.not_null_mrr_customer_id.adf44c0fb5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select customer_id
from `production-environment-306717`.`general_explorations`.`mrr`
where customer_id is null



      
    ) dbt_internal_test
[0m09:29:30.949180 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:3414136f-8701-4fed-9619-2dd761c20234&page=queryresults
[0m09:29:32.292933 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_customer_id.adf44c0fb5 (execute): 09:29:29.218510 => 09:29:32.292250
[0m09:29:32.294686 [info ] [Thread-1 (]: 8 of 21 PASS not_null_mrr_customer_id .......................................... [[32mPASS[0m in 3.09s]
[0m09:29:32.295696 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_customer_id.adf44c0fb5
[0m09:29:32.296386 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_date_month.d7121d9ce6
[0m09:29:32.297022 [info ] [Thread-1 (]: 9 of 21 START test not_null_mrr_date_month ..................................... [RUN]
[0m09:29:32.298037 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_customer_id.adf44c0fb5, now test.acme.not_null_mrr_date_month.d7121d9ce6)
[0m09:29:32.298524 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_date_month.d7121d9ce6
[0m09:29:32.310197 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_date_month.d7121d9ce6"
[0m09:29:32.311564 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_date_month.d7121d9ce6 (compile): 09:29:32.298833 => 09:29:32.311337
[0m09:29:32.311974 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_date_month.d7121d9ce6
[0m09:29:32.315073 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.not_null_mrr_date_month.d7121d9ce6"
[0m09:29:32.316090 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:29:32.316566 [debug] [Thread-1 (]: On test.acme.not_null_mrr_date_month.d7121d9ce6: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.not_null_mrr_date_month.d7121d9ce6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date_month
from `production-environment-306717`.`general_explorations`.`mrr`
where date_month is null



      
    ) dbt_internal_test
[0m09:29:34.148104 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:fef216e7-348a-47bb-903f-996f19ea5d12&page=queryresults
[0m09:29:35.556445 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_date_month.d7121d9ce6 (execute): 09:29:32.312230 => 09:29:35.556049
[0m09:29:35.557787 [info ] [Thread-1 (]: 9 of 21 PASS not_null_mrr_date_month ........................................... [[32mPASS[0m in 3.26s]
[0m09:29:35.558521 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_date_month.d7121d9ce6
[0m09:29:35.559201 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_first_active_month.a9078832e9
[0m09:29:35.559869 [info ] [Thread-1 (]: 10 of 21 START test not_null_mrr_first_active_month ............................ [RUN]
[0m09:29:35.560958 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_date_month.d7121d9ce6, now test.acme.not_null_mrr_first_active_month.a9078832e9)
[0m09:29:35.561660 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_first_active_month.a9078832e9
[0m09:29:35.574788 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_first_active_month.a9078832e9"
[0m09:29:35.578870 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_first_active_month.a9078832e9 (compile): 09:29:35.562748 => 09:29:35.578369
[0m09:29:35.580261 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_first_active_month.a9078832e9
[0m09:29:35.584931 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.not_null_mrr_first_active_month.a9078832e9"
[0m09:29:35.588352 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:29:35.589077 [debug] [Thread-1 (]: On test.acme.not_null_mrr_first_active_month.a9078832e9: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.not_null_mrr_first_active_month.a9078832e9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select first_active_month
from `production-environment-306717`.`general_explorations`.`mrr`
where first_active_month is null



      
    ) dbt_internal_test
[0m09:29:37.300006 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:3064de8d-0d73-48d9-8708-c1ad01c682d2&page=queryresults
[0m09:29:38.537389 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_first_active_month.a9078832e9 (execute): 09:29:35.580685 => 09:29:38.536553
[0m09:29:38.540258 [info ] [Thread-1 (]: 10 of 21 PASS not_null_mrr_first_active_month .................................. [[32mPASS[0m in 2.98s]
[0m09:29:38.542165 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_first_active_month.a9078832e9
[0m09:29:38.543388 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_id.45914052fb
[0m09:29:38.544689 [info ] [Thread-1 (]: 11 of 21 START test not_null_mrr_id ............................................ [RUN]
[0m09:29:38.547201 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_first_active_month.a9078832e9, now test.acme.not_null_mrr_id.45914052fb)
[0m09:29:38.548394 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_id.45914052fb
[0m09:29:38.560765 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_id.45914052fb"
[0m09:29:38.563731 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_id.45914052fb (compile): 09:29:38.548974 => 09:29:38.563392
[0m09:29:38.564277 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_id.45914052fb
[0m09:29:38.568434 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.not_null_mrr_id.45914052fb"
[0m09:29:38.569623 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:29:38.570234 [debug] [Thread-1 (]: On test.acme.not_null_mrr_id.45914052fb: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.not_null_mrr_id.45914052fb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from `production-environment-306717`.`general_explorations`.`mrr`
where id is null



      
    ) dbt_internal_test
[0m09:29:40.393685 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:3976d18d-4b8a-4188-b98c-406af4b81eff&page=queryresults
[0m09:29:41.523865 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_id.45914052fb (execute): 09:29:38.564609 => 09:29:41.522897
[0m09:29:41.527339 [info ] [Thread-1 (]: 11 of 21 PASS not_null_mrr_id .................................................. [[32mPASS[0m in 2.98s]
[0m09:29:41.528902 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_id.45914052fb
[0m09:29:41.530120 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_is_active.66e2203f7d
[0m09:29:41.531487 [info ] [Thread-1 (]: 12 of 21 START test not_null_mrr_is_active ..................................... [RUN]
[0m09:29:41.533601 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_id.45914052fb, now test.acme.not_null_mrr_is_active.66e2203f7d)
[0m09:29:41.534712 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_is_active.66e2203f7d
[0m09:29:41.547979 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_is_active.66e2203f7d"
[0m09:29:41.551091 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_is_active.66e2203f7d (compile): 09:29:41.535372 => 09:29:41.550743
[0m09:29:41.551912 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_is_active.66e2203f7d
[0m09:29:41.555693 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.not_null_mrr_is_active.66e2203f7d"
[0m09:29:41.556934 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:29:41.557547 [debug] [Thread-1 (]: On test.acme.not_null_mrr_is_active.66e2203f7d: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.not_null_mrr_is_active.66e2203f7d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select is_active
from `production-environment-306717`.`general_explorations`.`mrr`
where is_active is null



      
    ) dbt_internal_test
[0m09:29:43.057643 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:094b8b22-f0d2-43ae-802e-66b729488aa0&page=queryresults
[0m09:29:44.182660 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_is_active.66e2203f7d (execute): 09:29:41.552271 => 09:29:44.182241
[0m09:29:44.184780 [info ] [Thread-1 (]: 12 of 21 PASS not_null_mrr_is_active ........................................... [[32mPASS[0m in 2.65s]
[0m09:29:44.186360 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_is_active.66e2203f7d
[0m09:29:44.187586 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_is_first_month.97ecc2049e
[0m09:29:44.188925 [info ] [Thread-1 (]: 13 of 21 START test not_null_mrr_is_first_month ................................ [RUN]
[0m09:29:44.191176 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_is_active.66e2203f7d, now test.acme.not_null_mrr_is_first_month.97ecc2049e)
[0m09:29:44.192021 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_is_first_month.97ecc2049e
[0m09:29:44.211050 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_is_first_month.97ecc2049e"
[0m09:29:44.213480 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_is_first_month.97ecc2049e (compile): 09:29:44.192516 => 09:29:44.213206
[0m09:29:44.213982 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_is_first_month.97ecc2049e
[0m09:29:44.217612 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.not_null_mrr_is_first_month.97ecc2049e"
[0m09:29:44.218793 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:29:44.219390 [debug] [Thread-1 (]: On test.acme.not_null_mrr_is_first_month.97ecc2049e: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.not_null_mrr_is_first_month.97ecc2049e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select is_first_month
from `production-environment-306717`.`general_explorations`.`mrr`
where is_first_month is null



      
    ) dbt_internal_test
[0m09:29:46.488318 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:c3b8d947-2d46-47f7-b47e-b2df44e0ad44&page=queryresults
[0m09:29:49.106795 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_is_first_month.97ecc2049e (execute): 09:29:44.214324 => 09:29:49.105863
[0m09:29:49.110513 [info ] [Thread-1 (]: 13 of 21 PASS not_null_mrr_is_first_month ...................................... [[32mPASS[0m in 4.92s]
[0m09:29:49.112640 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_is_first_month.97ecc2049e
[0m09:29:49.113975 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_is_last_month.a91990c0de
[0m09:29:49.115303 [info ] [Thread-1 (]: 14 of 21 START test not_null_mrr_is_last_month ................................. [RUN]
[0m09:29:49.117431 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_is_first_month.97ecc2049e, now test.acme.not_null_mrr_is_last_month.a91990c0de)
[0m09:29:49.118564 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_is_last_month.a91990c0de
[0m09:29:49.131755 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_is_last_month.a91990c0de"
[0m09:29:49.134709 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_is_last_month.a91990c0de (compile): 09:29:49.119363 => 09:29:49.134224
[0m09:29:49.135454 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_is_last_month.a91990c0de
[0m09:29:49.139534 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.not_null_mrr_is_last_month.a91990c0de"
[0m09:29:49.140628 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:29:49.141215 [debug] [Thread-1 (]: On test.acme.not_null_mrr_is_last_month.a91990c0de: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.not_null_mrr_is_last_month.a91990c0de"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select is_last_month
from `production-environment-306717`.`general_explorations`.`mrr`
where is_last_month is null



      
    ) dbt_internal_test
[0m09:29:50.839916 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:4477fa1e-f0ec-46d5-9d41-58dd6c629fc8&page=queryresults
[0m09:29:51.983829 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_is_last_month.a91990c0de (execute): 09:29:49.135884 => 09:29:51.982945
[0m09:29:51.986598 [info ] [Thread-1 (]: 14 of 21 PASS not_null_mrr_is_last_month ....................................... [[32mPASS[0m in 2.87s]
[0m09:29:51.988121 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_is_last_month.a91990c0de
[0m09:29:51.989142 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_last_active_month.c5f2565121
[0m09:29:51.990146 [info ] [Thread-1 (]: 15 of 21 START test not_null_mrr_last_active_month ............................. [RUN]
[0m09:29:51.991782 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_is_last_month.a91990c0de, now test.acme.not_null_mrr_last_active_month.c5f2565121)
[0m09:29:51.992725 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_last_active_month.c5f2565121
[0m09:29:52.005410 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_last_active_month.c5f2565121"
[0m09:29:52.007752 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_last_active_month.c5f2565121 (compile): 09:29:51.993368 => 09:29:52.007443
[0m09:29:52.008253 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_last_active_month.c5f2565121
[0m09:29:52.012903 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.not_null_mrr_last_active_month.c5f2565121"
[0m09:29:52.014241 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:29:52.014851 [debug] [Thread-1 (]: On test.acme.not_null_mrr_last_active_month.c5f2565121: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.not_null_mrr_last_active_month.c5f2565121"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_active_month
from `production-environment-306717`.`general_explorations`.`mrr`
where last_active_month is null



      
    ) dbt_internal_test
[0m09:29:53.655640 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:1185a32c-6a31-4092-b417-821015bea0a4&page=queryresults
[0m09:29:55.184289 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_last_active_month.c5f2565121 (execute): 09:29:52.008563 => 09:29:55.183298
[0m09:29:55.188112 [info ] [Thread-1 (]: 15 of 21 PASS not_null_mrr_last_active_month ................................... [[32mPASS[0m in 3.20s]
[0m09:29:55.190034 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_last_active_month.c5f2565121
[0m09:29:55.190870 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_mrr.7e419847d2
[0m09:29:55.191880 [info ] [Thread-1 (]: 16 of 21 START test not_null_mrr_mrr ........................................... [RUN]
[0m09:29:55.193426 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_last_active_month.c5f2565121, now test.acme.not_null_mrr_mrr.7e419847d2)
[0m09:29:55.194299 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_mrr.7e419847d2
[0m09:29:55.201821 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_mrr.7e419847d2"
[0m09:29:55.203867 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_mrr.7e419847d2 (compile): 09:29:55.194850 => 09:29:55.203575
[0m09:29:55.204345 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_mrr.7e419847d2
[0m09:29:55.208702 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.not_null_mrr_mrr.7e419847d2"
[0m09:29:55.210149 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:29:55.210739 [debug] [Thread-1 (]: On test.acme.not_null_mrr_mrr.7e419847d2: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.not_null_mrr_mrr.7e419847d2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select mrr
from `production-environment-306717`.`general_explorations`.`mrr`
where mrr is null



      
    ) dbt_internal_test
[0m09:29:55.899462 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:28e43417-421d-44ec-be04-1d8f987640b2&page=queryresults
[0m09:29:56.850652 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_mrr.7e419847d2 (execute): 09:29:55.204649 => 09:29:56.849682
[0m09:29:56.853757 [info ] [Thread-1 (]: 16 of 21 PASS not_null_mrr_mrr ................................................. [[32mPASS[0m in 1.66s]
[0m09:29:56.855332 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_mrr.7e419847d2
[0m09:29:56.856721 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_mrr_change.0329647bd8
[0m09:29:56.858172 [info ] [Thread-1 (]: 17 of 21 START test not_null_mrr_mrr_change .................................... [RUN]
[0m09:29:56.860524 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_mrr.7e419847d2, now test.acme.not_null_mrr_mrr_change.0329647bd8)
[0m09:29:56.861589 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_mrr_change.0329647bd8
[0m09:29:56.881202 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_mrr_change.0329647bd8"
[0m09:29:56.883596 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_mrr_change.0329647bd8 (compile): 09:29:56.862285 => 09:29:56.883103
[0m09:29:56.884186 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_mrr_change.0329647bd8
[0m09:29:56.887946 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.not_null_mrr_mrr_change.0329647bd8"
[0m09:29:56.889275 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:29:56.889904 [debug] [Thread-1 (]: On test.acme.not_null_mrr_mrr_change.0329647bd8: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.not_null_mrr_mrr_change.0329647bd8"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select mrr_change
from `production-environment-306717`.`general_explorations`.`mrr`
where mrr_change is null



      
    ) dbt_internal_test
[0m09:29:58.726382 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:d017ddcd-6568-49d0-8e80-5c12e527a37d&page=queryresults
[0m09:30:00.697333 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_mrr_change.0329647bd8 (execute): 09:29:56.884539 => 09:30:00.696143
[0m09:30:00.700834 [info ] [Thread-1 (]: 17 of 21 PASS not_null_mrr_mrr_change .......................................... [[32mPASS[0m in 3.84s]
[0m09:30:00.702417 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_mrr_change.0329647bd8
[0m09:30:00.703815 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_previous_month_is_active.836f1724d2
[0m09:30:00.705168 [info ] [Thread-1 (]: 18 of 21 START test not_null_mrr_previous_month_is_active ...................... [RUN]
[0m09:30:00.707027 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_mrr_change.0329647bd8, now test.acme.not_null_mrr_previous_month_is_active.836f1724d2)
[0m09:30:00.707946 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_previous_month_is_active.836f1724d2
[0m09:30:00.718689 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_previous_month_is_active.836f1724d2"
[0m09:30:00.721282 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_previous_month_is_active.836f1724d2 (compile): 09:30:00.708876 => 09:30:00.720955
[0m09:30:00.721840 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_previous_month_is_active.836f1724d2
[0m09:30:00.726947 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.not_null_mrr_previous_month_is_active.836f1724d2"
[0m09:30:00.728414 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:30:00.729158 [debug] [Thread-1 (]: On test.acme.not_null_mrr_previous_month_is_active.836f1724d2: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.not_null_mrr_previous_month_is_active.836f1724d2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select previous_month_is_active
from `production-environment-306717`.`general_explorations`.`mrr`
where previous_month_is_active is null



      
    ) dbt_internal_test
[0m09:30:02.542489 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:c801d9fb-bc67-454b-a859-de18925a2828&page=queryresults
[0m09:30:04.256201 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_previous_month_is_active.836f1724d2 (execute): 09:30:00.722153 => 09:30:04.255110
[0m09:30:04.260716 [info ] [Thread-1 (]: 18 of 21 PASS not_null_mrr_previous_month_is_active ............................ [[32mPASS[0m in 3.55s]
[0m09:30:04.262512 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_previous_month_is_active.836f1724d2
[0m09:30:04.263916 [debug] [Thread-1 (]: Began running node test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7
[0m09:30:04.265439 [info ] [Thread-1 (]: 19 of 21 START test not_null_mrr_previous_month_mrr ............................ [RUN]
[0m09:30:04.267476 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_previous_month_is_active.836f1724d2, now test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7)
[0m09:30:04.268499 [debug] [Thread-1 (]: Began compiling node test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7
[0m09:30:04.280228 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7"
[0m09:30:04.282878 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7 (compile): 09:30:04.269256 => 09:30:04.282525
[0m09:30:04.283413 [debug] [Thread-1 (]: Began executing node test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7
[0m09:30:04.287438 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7"
[0m09:30:04.288589 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:30:04.289213 [debug] [Thread-1 (]: On test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select previous_month_mrr
from `production-environment-306717`.`general_explorations`.`mrr`
where previous_month_mrr is null



      
    ) dbt_internal_test
[0m09:30:06.200424 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:822b0431-e069-41ce-b4b9-40a471f8fcf9&page=queryresults
[0m09:30:08.249693 [debug] [Thread-1 (]: Timing info for test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7 (execute): 09:30:04.283740 => 09:30:08.248626
[0m09:30:08.252551 [info ] [Thread-1 (]: 19 of 21 PASS not_null_mrr_previous_month_mrr .................................. [[32mPASS[0m in 3.99s]
[0m09:30:08.254087 [debug] [Thread-1 (]: Finished running node test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7
[0m09:30:08.255338 [debug] [Thread-1 (]: Began running node test.acme.unique_customer_churn_month_customer_id.a402b7af3f
[0m09:30:08.256660 [info ] [Thread-1 (]: 20 of 21 START test unique_customer_churn_month_customer_id .................... [RUN]
[0m09:30:08.258745 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.not_null_mrr_previous_month_mrr.9a7dfac4d7, now test.acme.unique_customer_churn_month_customer_id.a402b7af3f)
[0m09:30:08.260005 [debug] [Thread-1 (]: Began compiling node test.acme.unique_customer_churn_month_customer_id.a402b7af3f
[0m09:30:08.273799 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.unique_customer_churn_month_customer_id.a402b7af3f"
[0m09:30:08.277066 [debug] [Thread-1 (]: Timing info for test.acme.unique_customer_churn_month_customer_id.a402b7af3f (compile): 09:30:08.260890 => 09:30:08.276581
[0m09:30:08.277802 [debug] [Thread-1 (]: Began executing node test.acme.unique_customer_churn_month_customer_id.a402b7af3f
[0m09:30:08.282048 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.unique_customer_churn_month_customer_id.a402b7af3f"
[0m09:30:08.283323 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:30:08.284006 [debug] [Thread-1 (]: On test.acme.unique_customer_churn_month_customer_id.a402b7af3f: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.unique_customer_churn_month_customer_id.a402b7af3f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select customer_id as unique_field
  from `production-environment-306717`.`general_explorations`.`customer_churn_month`
  where customer_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m09:30:10.089058 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:3cffe693-605b-452f-8014-4899c8aaeb12&page=queryresults
[0m09:30:11.637506 [debug] [Thread-1 (]: Timing info for test.acme.unique_customer_churn_month_customer_id.a402b7af3f (execute): 09:30:08.278251 => 09:30:11.636831
[0m09:30:11.640491 [info ] [Thread-1 (]: 20 of 21 PASS unique_customer_churn_month_customer_id .......................... [[32mPASS[0m in 3.38s]
[0m09:30:11.642164 [debug] [Thread-1 (]: Finished running node test.acme.unique_customer_churn_month_customer_id.a402b7af3f
[0m09:30:11.643421 [debug] [Thread-1 (]: Began running node test.acme.unique_mrr_id.a14d6c26bd
[0m09:30:11.644750 [info ] [Thread-1 (]: 21 of 21 START test unique_mrr_id .............................................. [RUN]
[0m09:30:11.646856 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.acme.unique_customer_churn_month_customer_id.a402b7af3f, now test.acme.unique_mrr_id.a14d6c26bd)
[0m09:30:11.648071 [debug] [Thread-1 (]: Began compiling node test.acme.unique_mrr_id.a14d6c26bd
[0m09:30:11.658865 [debug] [Thread-1 (]: Writing injected SQL for node "test.acme.unique_mrr_id.a14d6c26bd"
[0m09:30:11.661654 [debug] [Thread-1 (]: Timing info for test.acme.unique_mrr_id.a14d6c26bd (compile): 09:30:11.648879 => 09:30:11.661321
[0m09:30:11.662483 [debug] [Thread-1 (]: Began executing node test.acme.unique_mrr_id.a14d6c26bd
[0m09:30:11.667618 [debug] [Thread-1 (]: Writing runtime sql for node "test.acme.unique_mrr_id.a14d6c26bd"
[0m09:30:11.668961 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:30:11.669558 [debug] [Thread-1 (]: On test.acme.unique_mrr_id.a14d6c26bd: /* {"app": "dbt", "dbt_version": "1.6.7", "profile_name": "teste_dbt", "target_name": "dev", "node_id": "test.acme.unique_mrr_id.a14d6c26bd"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select id as unique_field
  from `production-environment-306717`.`general_explorations`.`mrr`
  where id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m09:30:13.678238 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=production-environment-306717&j=bq:US:629f7a03-56d0-47c9-880b-4070adb5e6fa&page=queryresults
[0m09:30:15.616825 [debug] [Thread-1 (]: Timing info for test.acme.unique_mrr_id.a14d6c26bd (execute): 09:30:11.662821 => 09:30:15.615828
[0m09:30:15.619771 [info ] [Thread-1 (]: 21 of 21 PASS unique_mrr_id .................................................... [[32mPASS[0m in 3.97s]
[0m09:30:15.621319 [debug] [Thread-1 (]: Finished running node test.acme.unique_mrr_id.a14d6c26bd
[0m09:30:15.627492 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:30:15.628725 [debug] [MainThread]: Connection 'test.acme.unique_mrr_id.a14d6c26bd' was properly closed.
[0m09:30:15.629881 [info ] [MainThread]: 
[0m09:30:15.630854 [info ] [MainThread]: Finished running 21 tests in 0 hours 1 minutes and 19.15 seconds (79.15s).
[0m09:30:15.637727 [debug] [MainThread]: Command end result
[0m09:30:15.662780 [info ] [MainThread]: 
[0m09:30:15.663371 [info ] [MainThread]: [31mCompleted with 3 errors and 0 warnings:[0m
[0m09:30:15.663709 [info ] [MainThread]: 
[0m09:30:15.664028 [error] [MainThread]:   Database Error in test dbt_utils_expression_is_true_mrr_date_month_date_trunc_month_current_date_ (models/mrr.yml)
  Found invalid date part argument function call syntax for `current_date`() at [17:45]
  compiled Code at target/run/acme/models/mrr.yml/dbt_utils_expression_is_true_m_b3233a8b427f290f3a2e2761afe6d682.sql
[0m09:30:15.664356 [info ] [MainThread]: 
[0m09:30:15.664653 [error] [MainThread]:   Database Error in test dbt_utils_expression_is_true_subscription_periods_date_trunc_month_end_date_end_date (models/schema.yml)
  A valid date part name is required but found end_date at [17:31]
  compiled Code at target/run/acme/models/schema.yml/dbt_utils_expression_is_true_s_4d81a420147076e873cd54eae2c460ae.sql
[0m09:30:15.664954 [info ] [MainThread]: 
[0m09:30:15.665244 [error] [MainThread]:   Database Error in test dbt_utils_expression_is_true_subscription_periods_date_trunc_month_start_date_start_date (models/schema.yml)
  A valid date part name is required but found start_date at [17:31]
  compiled Code at target/run/acme/models/schema.yml/dbt_utils_expression_is_true_s_55d02e8a711fb54a4345c8b27cf573f2.sql
[0m09:30:15.665570 [info ] [MainThread]: 
[0m09:30:15.665919 [info ] [MainThread]: Done. PASS=18 WARN=0 ERROR=3 SKIP=0 TOTAL=21
[0m09:30:15.666872 [debug] [MainThread]: Command `dbt test` failed at 09:30:15.666781 after 79.69 seconds
[0m09:30:15.667343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107323c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102eae850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108631610>]}
[0m09:30:15.667753 [debug] [MainThread]: Flushing usage events
